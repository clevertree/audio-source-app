(this["webpackJsonpaudio-source-web"]=this["webpackJsonpaudio-source-web"]||[]).push([[0],[,function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(0),c=n.n(u),l=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e=this.props.children;return"function"===typeof e&&(e=e(this)),c.a.createElement("div",this.props,e)}}]),t}(c.a.Component),f=(n(124),function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).call(this,e,{}))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e="asui-icon";return this.props.source&&(e+=" "+this.props.source),c.a.createElement("div",{className:e})}}]),t}(c.a.Component)),h=n(26),d=n.n(h),p=n(22),m=n(40),g=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).cb={onMouseInput:function(e){return n.onMouseInput(e)},onKeyDown:function(e){return n.onKeyDown(e)}},n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getOverlay",value:function(){return this.context.overlay}},{key:"render",value:function(){var e="asui-menu-item";return this.props.className&&(e+=" "+this.props.className),this.props.disabled&&(e+=" disabled"),this.props.selected&&(e+=" selected"),c.a.createElement("div",{title:this.props.title,className:e,onClick:this.cb.onMouseInput,onKeyDown:this.cb.onKeyDown,tabIndex:0},this.props.children)}},{key:"doAction",value:function(e){if(this.props.disabled)console.warn(this.constructor.name+" is disabled.",this);else{if(!this.props.onAction)throw new Error("Button does not contain props 'onAction'");!1!==this.props.onAction(e,this)&&this.closeAllDropDownMenus()}}}]),t}(m.a);g.contextType=p.a,g.defaultProps={},g.propTypes={onAction:d.a.func.isRequired,disabled:d.a.bool};var v=n(27),y=(n(127),n(2)),k=n.n(y),b=n(6),w=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).state={open:!1,stick:!1},n.divRef=c.a.createRef(),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getOverlay",value:function(){return this.context.overlay}},{key:"componentDidUpdate",value:function(e,t,n){this.getOverlay()&&(this.state.open?this.getOverlay().addCloseMenuCallback(this,this.closeMenu.bind(this)):this.getOverlay().removeCloseMenuCallback(this)),this.updateScreenPosition()}},{key:"componentWillUnmount",value:function(){this.getOverlay()&&this.getOverlay().removeCloseMenuCallback(this)}},{key:"render",value:function(){if(!this.state.open)return null;var e="asui-menu-dropdown";if(this.props.vertical&&(e+=" vertical"),this.state.stick&&(e+=" stick"),this.props.disabled)return"Disabled";var t=this.state.options;return c.a.createElement(p.a.Provider,{value:{overlay:this.getOverlay(),parentDropDown:this}},c.a.createElement("div",{className:e,children:t,ref:this.divRef}))}},{key:"hoverMenu",value:function(){!0!==this.state.open&&this.getOverlay()&&this.getOverlay().isHoverEnabled()&&this.openMenu()}},{key:"toggleMenu",value:function(){this.state.open?this.state.stick?this.closeMenu():this.stickMenu():this.openMenu()}},{key:"openMenu",value:function(){var e=Object(b.a)(k.a.mark((function e(){var t,n=this;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.props.disabled){e.next=2;break}return e.abrupt("return",console.error("Menu is disabled"));case 2:if(!this.state.open){e.next=4;break}throw new Error("Menu was already open");case 4:if(!this.getOverlay()){e.next=8;break}if(!1===this.getOverlay().openMenu(this.props.options)){e.next=8;break}return e.abrupt("return");case 8:if("function"===typeof(t=this.props.options)&&(t=t(this)),!(t instanceof Promise)){e.next=14;break}return e.next=13,t;case 13:t=e.sent;case 14:t||console.warn("Empty options returned by ",this),this.setState({open:!0,options:t}),setTimeout((function(){n.getOverlay().closeMenus(n.getAncestorMenus())}),100);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stickMenu",value:function(){if(!this.state.open)throw new Error("Unable to stick. Menu was not yet open");this.getAncestorMenus().forEach((function(e){e.setState({stick:!0})}))}},{key:"closeMenu",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state.stick&&!0===e||this.setState({open:!1,stick:!1,options:null})}},{key:"getAncestorMenus",value:function(){for(var e=[],t=this;t;)e.push(t),t=t.context.parentDropDown;return e}},{key:"closeAllDropDownMenus",value:function(){this.getOverlay()&&this.getOverlay().closeAllMenus()}},{key:"updateScreenPosition",value:function(){if(this.state.open&&this.divRef.current){var e=this.divRef.current,t=e.getBoundingClientRect();t.right>window.innerWidth&&e.classList.add("overflow-right"),t.bottom>window.innerHeight&&e.classList.add("overflow-bottom")}}}]),t}(c.a.Component);w.contextType=p.a,w.defaultProps={vertical:!1};var E=w,_=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).dropdown=c.a.createRef(),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"renderChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=!0===this.props.arrow?this.props.vertical?"\u25bc":"\u25ba":this.props.arrow;return[Object(v.a)(Object(i.a)(t.prototype),"renderChildren",this).call(this,e),n?c.a.createElement("div",{className:"arrow"},n):null,c.a.createElement(E,{ref:this.dropdown,disabled:this.props.disabled,options:this.props.options,vertical:this.props.vertical})]}},{key:"toggleMenu",value:function(){return this.dropdown.current.toggleMenu()}},{key:"hoverMenu",value:function(){return this.dropdown.current.hoverMenu()}},{key:"doAction",value:function(e){this.toggleMenu()}}]),t}(m.a);_.defaultProps={arrow:!0,vertical:!0},_.propTypes={options:d.a.any.isRequired};var S=n(9),P=(n(128),function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e="asui-form";this.props.className&&(e+=" "+this.props.className);var t=this.props.children;return"function"===typeof t&&(t=t(this)),c.a.createElement("div",{className:e},this.props.header?c.a.createElement("div",{className:"header"},this.props.header):null,c.a.createElement("div",{className:"container"},t))}}]),t}(c.a.Component));P.defaultProps={};var x=P,O=(n(129),function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){var e="asui-panel";this.props.className&&(e+=" "+this.props.className);var t=this.props.children;return"function"===typeof t&&(t=t(this)),c.a.createElement("div",Object.assign({},this.props,{className:e}),this.props.header?c.a.createElement("div",{className:"header"},this.props.header):null,t)}}]),t}(c.a.Component));O.defaultProps={};var D=O,I=(n(130),function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(r.a)(this,t),(e=Object(o.a)(this,Object(i.a)(t).call(this,n))).cb={onChange:function(t){return e.onChange(t)},onClick:function(t){return e.onClick(t)}},e}return Object(s.a)(t,e),Object(a.a)(t,[{key:"onClick",value:function(e){e.preventDefault();var t=parseFloat(e.target.value);this.props.onChange(e,t)}},{key:"onChange",value:function(e){e.preventDefault();var t=parseFloat(e.target.value);this.props.onChange(e,t)}},{key:"render",value:function(){var e="asui-input-range";return this.props.className&&(e+=" "+this.props.className),c.a.createElement("input",{className:e,type:"range",value:this.props.value,onChange:this.cb.onChange,onClick:this.cb.onClick,min:this.props.min,max:this.props.max,step:this.props.step,name:this.props.name,title:this.props.title})}}]),t}(c.a.Component));I.defaultProps={};var C=I;n.d(t,"c",(function(){return l})),n.d(t,"e",(function(){return f})),n.d(t,"d",(function(){return x})),n.d(t,"k",(function(){return D})),n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return _})),n.d(t,"g",(function(){return S.b})),n.d(t,"h",(function(){return S.c})),n.d(t,"i",(function(){return S.d})),n.d(t,"j",(function(){return S.e})),n.d(t,"f",(function(){return C}))},,,,,,,,function(e,t,n){"use strict";var r=n(58),a=n(3),o=n(4),i=n(7),s=n(5),u=n(8),c=n(0),l=n.n(c),f=(n(68),n(37)),h=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(i.a)(this,Object(s.a)(t).call(this,e))).cb={onKeyDown:function(e){return n.onKeyDown(e)},onMouseInput:function(e){return n.onMouseInput(e)}},n.dropdown=l.a.createRef(),n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"getClassName",value:function(){return"asui-menu-item"}},{key:"render",value:function(){var e=this.getClassName();this.props.className&&(e+=" "+this.props.className),this.props.disabled&&(e+=" disabled"),this.props.selected&&(e+=" selected");var t=!0===this.props.arrow?this.props.vertical?"\u25bc":"\u25ba":this.props.arrow;return l.a.createElement("div",{title:this.props.title,className:e,onMouseEnter:this.cb.onMouseInput,onClick:this.cb.onMouseInput,onKeyDown:this.cb.onKeyDown,tabIndex:0},this.props.children,t?l.a.createElement("div",{className:"arrow"},t):null,l.a.createElement(f.a,{ref:this.dropdown,disabled:this.props.disabled,options:this.props.options,vertical:this.props.vertical}))}},{key:"toggleMenu",value:function(){return this.dropdown.current.toggleMenu()}},{key:"hoverMenu",value:function(){return this.dropdown.current.hoverMenu()}},{key:"onMouseInput",value:function(e){if(!e.defaultPrevented)switch(e.preventDefault(),e.type){case"click":if(this.props.onClick&&!1===this.props.onClick(e))return;this.toggleMenu();break;case"mouseenter":case"mouseover":this.hoverMenu();break;default:throw new Error("Unknown Mouse event: "+e.type)}}},{key:"onKeyDown",value:function(e){if(!e.isDefaultPrevented())switch(e.key){case" ":case"Enter":this.toggleMenu();break;default:console.info("Unhandled key: ",e.key)}}},{key:"onMouseEnter",value:function(e){this.toggleMenu()}}]),t}(l.a.Component);h.defaultProps={arrow:!0,vertical:!1};var d=n(60),p=n(62);n.d(t,"b",(function(){return r.a})),n.d(t,"c",(function(){return d.a})),n.d(t,"d",(function(){return h})),n.d(t,"a",(function(){return f.a})),n.d(t,"e",(function(){return p.a}))},function(e,t,n){"use strict";var r=n(35),a=n(24),o=n(3),i=n(4),s=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,[{key:"getKeyboardLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;switch(e){default:case"2octave":return{"@":"C#4","#":"D#4","%":"F#4","^":"G#4","&":"A#4","*":"C#3",")":"D#3",Q:"C4",W:"D4",E:"E4",R:"F4",T:"G4",Y:"A4",U:"B4",I:"C3",O:"D3",P:"E3",S:"C#3",D:"D#3",G:"F#3",H:"G#3",J:"A#3",L:"C#4",":":"D#4",Z:"C3",X:"D3",C:"E3",V:"F3",B:"G3",N:"A3",M:"B3","<":"C4",">":"D4","?":"E4",2:"C#2",3:"D#2",5:"F#2",6:"G#2",7:"A#2",9:"C#3",0:"D#3",q:"C2",w:"D2",e:"E2",r:"F2",t:"G2",y:"A2",u:"B2",i:"C3",o:"D3",p:"E3",s:"C#1",d:"D#1",g:"F#1",h:"G#1",j:"A#1",l:"C#2",";":"D#2",z:"C1",x:"D1",c:"E1",v:"F1",b:"G1",n:"A1",m:"B1",",":"C2",".":"D2","/":"E2"};case"4octave":return{Q:"C6",W:"C#6",E:"D6",R:"D#6",T:"E6",Y:"F6",U:"F#6",I:"G6",O:"G#6",P:"A6","{":"A#6","}":"B6",A:"C5",S:"C#5",D:"D5",F:"D#5",G:"E5",H:"F5",J:"F#5",K:"G5",L:"G#5",":":"A5",'"':"A#5",Z:"C4",X:"C#4",C:"D4",V:"D#4",B:"E4",N:"F4",M:"F#4","<":"G4",">":"G#4","?":"A4",q:"C3",w:"C#3",e:"D3",r:"D#3",t:"E3",y:"F3",u:"F#3",i:"G3",o:"G#3",p:"A3","[":"A#3","]":"B3",a:"C2",s:"C#2",d:"D2",f:"D#2",g:"E2",h:"F2",j:"F#2",k:"G2",l:"G#2",";":"A2","'":"A#2",z:"C1",x:"C#1",c:"D1",v:"D#1",b:"E1",n:"F1",m:"F#1",",":"G1",".":"G#1","/":"A1"}}}},{key:"getKeyboardCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!Number.isInteger(t))throw new Error("Octave value must be an integer");var r=this.getKeyboardLayout(n);if("undefined"===typeof r[e])return null;for(var a=r[e],o=6;o>=1;o--)a=a.replace(o,t+o-1);return a}}]),e}(),u=n(61),c=n(15),l=n(57),f=(n(39),n(47),n(38));n.d(t,"f",(function(){return r.a})),n.d(t,"c",(function(){return f.a})),n.d(t,"e",(function(){return u.a})),n.d(t,"a",(function(){return c.a})),n.d(t,"d",(function(){return c.c})),n.d(t,"h",(function(){return a.a})),n.d(t,"b",(function(){return s})),n.d(t,"g",(function(){return l.a}))},function(e,t,n){"use strict";var r=n(2),a=n.n(r),o=n(6),i=n(3),s=n(4),u=n(9),c=n(1),l=n(14),f=n(0),h=n.n(f),d=n(13),p=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"renderMenuSelectCommand",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return h.a.createElement(h.a.Fragment,null,h.a.createElement(u.d,{options:function(){return t.renderMenuSelectCommandByFrequency(e,n)}},"By Frequency"),h.a.createElement(u.d,{options:function(){return t.renderMenuSelectCommandByOctave(e,n)}},"By Octave"),h.a.createElement(u.c,null),h.a.createElement(u.d,{disabled:!0,options:function(){return t.renderMenuSelectCommandByNamed(e)}},"By Alias"),h.a.createElement(u.d,{disabled:!0,options:function(){return t.renderMenuSelectCommandByTrack(e)}},"By Group"),h.a.createElement(u.b,{onAction:function(){var t=Object(o.a)(a.a.mark((function t(n){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=e,t.next=3,d.a.openPromptDialog("Insert custom command");case 3:return t.t1=t.sent,t.abrupt("return",(0,t.t0)(t.t1));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},"Custom Command"))}},{key:"renderMenuSelectCommandByNamed",value:function(e){return this.values.getAllNamedFrequencies((function(t,n,r){return h.a.createElement(u.b,{key:t,onAction:function(n){return e(t)},children:t})}))}},{key:"renderMenuSelectCommandByTrack",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return h.a.createElement(h.a.Fragment,null,this.getAllSongGroups((function(n){return n===t.trackName?null:h.a.createElement(u.b,{key:n,disabled:n===t.state.selectedTrack,onAction:function(t){return e("@"+n)}},n)})),h.a.createElement(u.b,{onAction:n,hasBreak:!0},"Create New Track"))}},{key:"renderMenuSelectCommandByFrequency",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.getNoteFrequencies((function(r){return h.a.createElement(u.d,{key:r,options:function(){return t.renderMenuSelectCommandByFrequencyOctave(e,r,n)}},r)}))}},{key:"renderMenuSelectCommandByFrequencyOctave",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return h.a.createElement(h.a.Fragment,null,null!==n?h.a.createElement(u.b,{onAction:function(){return e(t+""+n)}},t+""+n," (Current)"):null,this.getNoteOctaves((function(n){return h.a.createElement(u.b,{key:n,onAction:function(){return e(t+""+n)}},t+""+n)})))}},{key:"renderMenuSelectCommandByOctave",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return h.a.createElement(h.a.Fragment,null,null!==n?h.a.createElement(u.d,{key:n,options:function(){return t.renderMenuSelectCommandByOctaveFrequency(e,n)}},n," (Current)"):null,this.getNoteOctaves((function(n){return h.a.createElement(u.d,{key:n,options:function(){return t.renderMenuSelectCommandByOctaveFrequency(e,n)}},n)})))}},{key:"renderMenuSelectCommandByOctaveFrequency",value:function(e,t){return this.getNoteFrequencies((function(n){return h.a.createElement(u.b,{key:n,onAction:function(){return e(n+""+t)}},n+""+t)}))}},{key:"renderMenuSelectDuration",value:function(e,t,n){return h.a.createElement(h.a.Fragment,null,h.a.createElement(u.d,{disabled:!0,options:function(){return r("recent")}},"Recent"),h.a.createElement(u.c,null),h.a.createElement(u.d,{options:function(){return r("fraction")}},"Fraction"),h.a.createElement(u.d,{options:function(){return r("triplet")}},"Triplet"),h.a.createElement(u.d,{options:function(){return r("dotted")}},"Dotted"),h.a.createElement(u.c,null),h.a.createElement(u.d,{disabled:!0,options:function(){return r("custom")}},"Custom"));function r(t){var r=[];switch(t){case"fraction":for(var a=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"a"),onAction:function(){return e(1/t*n,"1/".concat(t,"B"))}},"1/".concat(t,"B")))},o=64;o>1;o/=2)a(o);for(var i=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"b"),onAction:function(){return e(t*n,t+"B")}},t+"B"))},s=1;s<=16;s++)i(s);break;case"triplet":for(var c=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"a"),onAction:function(){return e(1/(t/1.5)*n,"1/".concat(t,"T"))}},"1/".concat(t,"T")))},l=64;l>1;l/=2)c(l);for(var f=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"b"),onAction:function(){return e(t/1.5*n,t+"T")}},t+"T"))},d=1;d<=16;d++)f(d);break;case"dotted":for(var p=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"a"),onAction:function(){return e(1/(1.5*t)*n,"1/".concat(t,"D"))}},"1/".concat(t,"D")))},m=64;m>1;m/=2)p(m);for(var g=function(t){r.push(h.a.createElement(u.b,{key:"".concat(t,"b"),onAction:function(){return e(1.5*t*n,t+"D")}},t+"D"))},v=1;v<=16;v++)g(v);break;default:throw new Error("Unknown key")}return r}}},{key:"renderMenuSelectVelocity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(){var t=Object(o.a)(a.a.mark((function t(){var n;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d.a.openPromptDialog("Enter custom velocity (1-127)",127);case 2:n=t.sent,e(n);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return h.a.createElement(h.a.Fragment,null,h.a.createElement(u.b,{onAction:function(){},disabled:!0},"Set Velocity"),h.a.createElement(c.f,{min:0,max:127,value:t,onChange:function(t,n){return e(n)}}),h.a.createElement(u.c,null),this.getNoteVelocities((function(t){return h.a.createElement(u.b,{key:t,onAction:function(){return e(t)}},t)})),h.a.createElement(u.b,{onAction:n,hasBreak:!0},"Custom"))}},{key:"renderMenuSelectAvailableProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return h.a.createElement(h.a.Fragment,null,t?h.a.createElement(h.a.Fragment,null,h.a.createElement(u.b,{disabled:!0,onAction:function(){}},t),h.a.createElement(u.c,null)):null,l.a.getRegisteredPrograms().map((function(t,n){return h.a.createElement(u.b,{key:n,onAction:function(){return e(t.className)}},t.title)})))}},{key:"generateUUID",value:function(){var e=(new Date).getTime();return"undefined"!==typeof performance&&"function"===typeof performance.now&&(e+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))}},{key:"getNoteFrequencies",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=[],n=this.noteList(),r=0;r<n.length;r++){var a=n[r],o=e(a);if(!m(t,o))return t}return t}},{key:"getNoteOctaves",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=[],n=1;n<=8;n++){var r=e(n);if(!m(t,r))return t}return t}},{key:"getOctaveNoteFrequencies",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=[],n=this.noteList(),r=1;r<=8;r++)for(var a=0;a<n.length;a++){var o=n[a]+r,i=e(o);if(!m(t,i))return t}return t}},{key:"getNoteVelocities",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=[],n=100;n>=0;n-=10){var r=e(n);if(!m(t,r))return t}return t}},{key:"getBeatsPerMeasure",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]},t=[],n=1;n<=12;n++){var r=e(n,n+" beat".concat(n>1?"s":""," per measure"));if(!m(t,r))return t}return t}},{key:"getBeatsPerMinute",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]},t=[],n=40;n<=300;n+=10){var r=e(n,n+" beat".concat(n>1?"s":""," per minute"));if(!m(t,r))return t}return t}},{key:"getTrackerSegmentLengthInRows",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]},t=[];return[4,5,6,7,8,10,12,16,24,32,48,64,96,128].forEach((function(n){var r=e(n,n+" Rows");if(!m(t,r))return t})),t}},{key:"formatVelocity",value:function(e){return"number"!==typeof e?"N/A":100===e?"Max":e+""}},{key:"formatProgramID",value:function(e){return"number"!==typeof e?"N/A":e<10?"0"+e:""+e}},{key:"formatCommand",value:function(e){return e}},{key:"formatPlaybackPosition",value:function(e){var t=Math.floor(e/60);e%=60;var n=Math.round(1e3*(e-Math.floor(e)));return e=Math.floor(e),t=(t+"").padStart(2,"0"),e=(e+"").padStart(2,"0"),n=(n+"").padStart(3,"0"),"".concat(t,":").concat(e,":").concat(n)}},{key:"parsePlaybackPosition",value:function(e){var t=e.toString().split(":");return 60*parseInt(t[0],10)+parseInt(t[1],10)+parseInt(t[2],10)/1e3}},{key:"parseFrequencyString",value:function(e){if("string"!==typeof e)throw new Error("Frequency is not a string");if(!e)throw new Error("Frequency is null");var t=this.noteQuarterToneList(),n=e.slice(0,-1),r=parseInt(e.slice(-1));if(isNaN(r))throw new Error("Invalid octave value: "+e);if("undefined"===typeof t[n])throw new Error("Unrecognized Note: "+n);var a=t[n];return a=a<6?a+24+24*(r-1)+2:a+24*(r-1)+2,440*Math.pow(2,(a-98)/24)}},{key:"parseDurationAsTicks",value:function(e,t){if(!t)throw new Error("Invalid timeDivision");if("string"!==typeof e)return e;var n=e.substr(e.length-1),r=e.substr(0,e.length-1);if(-1!==r.indexOf("/")){var a=r.split("/");r=parseInt(a[0],10)/parseInt(a[1],10)}switch(n){case"t":return parseInt(r);case"B":return t*parseFloat(r);case"D":return 1.5*t*parseFloat(r);case"T":return t/1.5*parseFloat(r);default:throw new Error("Invalid Duration: "+e)}}},{key:"formatDuration",value:function(e,t){var n;if(this.getNoteDurations((function(t,r){if(e===t||e===r)return n=r,!1}),t),n)return n;var r=e/t;return r===Math.round(r)?r+"B":(e=parseFloat(e).toFixed(2)).replace(".00","t")}},{key:"getNoteDurations",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]},t=arguments.length>1?arguments[1]:void 0,n=[],r=64;r>1;r/=2){var a=e(1/r*t,"1/".concat(r,"B"));if(!m(n,a))return n}for(var o=64;o>1;o/=2){var i=e(1/o/1.5*t,"1/".concat(o,"T"));if(!m(n,i))return n}for(var s=64;s>1;s/=2){var u=e(1/s*1.5*t,"1/".concat(s,"D"));if(!m(n,u))return n}for(var c=1;c<=16;c++){var l=e(c*t,"".concat(c,"B"));if(!m(n,l))return n}for(var f=1;f<=16;f++){var h=e(f/1.5*t,"".concat(f,"T"));if(!m(n,h))return n}for(var d=1;d<=16;d++){var p=e(1.5*d*t,"".concat(d,"D"));if(!m(n,p))return n}return n}},{key:"noteList",value:function(){return["A","A#","Bb","B","C","C#","Db","D","D#","Eb","E","E#","F","F#","Gb","G","G#","Ab"]}},{key:"noteQuarterToneList",value:function(){return{A:0,Aq:1,"A#":2,"A#q":3,Bb:2,Bbq:3,B:4,Bq:5,C:6,Cq:7,"C#":8,"C#q":9,Db:8,Dbq:9,D:10,Dq:11,"D#":12,"D#q":13,Eb:12,Ebq:13,E:14,Eq:15,"E#":16,"E#q":17,F:16,Fq:17,"F#":18,"F#q":19,Gb:18,Gbq:19,G:20,Gq:21,"G#":22,"G#q":23,Ab:22,Abq:23}}}]),e}();function m(e,t){return null!==t&&"undefined"!==typeof t&&e.push(t),!1!==t||t}t.a=p},,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(2),a=n.n(r),o=n(6),i=n(3),s=n(4),u=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"openPromptDialog",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"",e.abrupt("return",window.prompt(t,n));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"openConfirmDialog",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.confirm(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}()},function(e,t,n){"use strict";var r=n(12),a=n(3),o=n(4),i=n(0),s=n.n(i),u=function(){function e(t){Object(a.a)(this,e),this.song=t}return Object(o.a)(e,[{key:"loadInstanceFromDestination",value:function(e,t){return this.loadInstanceFromID(e)}},{key:"getData",value:function(e){if(!this.song.data.programs[e])throw new Error("Invalid program ID: "+e);return this.song.data.programs[e]}},{key:"getClassName",value:function(e){var t=this.getData(e);return Object(r.a)(t,1)[0]}},{key:"getConfig",value:function(e){var t=this.getData(e);return Object(r.a)(t,2)[1]}},{key:"getClass",value:function(t){var n=this.getClassName(t);return e.getProgramClassInfo(n).classProgram}},{key:"loadInstanceFromID",value:function(t){var n=this.getData(t),a=Object(r.a)(n,2),o=a[0],i=a[1];return e.loadInstance(o,i)}},{key:"programLoadRenderer",value:function(t){var n=this.getData(t),a=Object(r.a)(n,2),o=a[0],i=a[1],u=e.getProgramClassInfo(o).classRenderer;return s.a.createElement(u,{programID:t,config:i})}},{key:"stopProgramPlayback",value:function(t){var n=e.registeredProgramClasses[t].classProgram;n.stopPlayback&&n.stopPlayback()}},{key:"stopAllPlayback",value:function(){for(var t=e.registeredProgramClasses,n=0;n<t.length;n++)this.stopProgramPlayback(n)}},{key:"unloadAllPrograms",value:function(){for(var t=e.registeredProgramClasses,n=0;n<t.length;n++){var r=t[n].classProgram;r.unloadAll&&r.unloadAll()}}}],[{key:"loadInstance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getProgramClassInfo(e),r=n.classProgram;return new r(t)}},{key:"getProgramClassInfo",value:function(t){for(var n=e.registeredProgramClasses,r=0;r<n.length;r++){var a=n[r];if(a.className===t)return a}throw new Error("Program class ".concat(t," was not found"))}},{key:"addProgramClass",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=e.registeredProgramClasses;a=a||n.name,o.push({classProgram:n,classRenderer:r,className:t,title:a})}},{key:"getRegisteredPrograms",value:function(){return e.registeredProgramClasses}}]),e}();u.registeredProgramClasses=[],t.a=u},function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(21),i=function(){function e(t,n,a){Object(r.a)(this,e),this.instructions=t,this.beatsPerMinute=a,this.timeDivision=n,this.currentIndex=-1,this.positionTicks=0,this.endPositionTicks=0,this.positionSeconds=0,this.endPositionSeconds=0,this.lastInstructionPositionInTicks=0,this.lastInstructionPositionInSeconds=0,this.rowCount=0,this.cursorPosition=0}return Object(a.a)(e,[{key:"hasReachedEnd",value:function(){return this.currentIndex>=this.instructions.length-1}},{key:"incrementPositionByInstruction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=e.deltaDurationTicks;this.positionTicks=this.lastInstructionPositionInTicks+n,this.lastInstructionPositionInTicks=this.positionTicks;var r=n/this.timeDivision/(this.beatsPerMinute/60);this.positionSeconds=this.lastInstructionPositionInSeconds+r,this.lastInstructionPositionInSeconds=this.positionSeconds;var a=e.durationTicks||0;if(a){var o=this.positionTicks+a;o>this.endPositionTicks&&(this.endPositionTicks=o);var i=this.positionSeconds+a/this.timeDivision/(this.beatsPerMinute/60);i>this.endPositionSeconds&&(this.endPositionSeconds=i)}t&&t(e),this.cursorPosition++}},{key:"getInstruction",value:function(e){var t=this.instructions[e];return o.a.getInstruction(t)}},{key:"currentInstruction",value:function(){if(-1===this.currentIndex)throw new Error("Iterator has not been started");return this.getInstruction(this.currentIndex)}},{key:"nextInstruction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.hasReachedEnd())return null;this.currentIndex++;var t=this.currentInstruction();return this.incrementPositionByInstruction(t,e),t}},{key:"nextInstructionRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.hasReachedEnd())return null;for(var n=[];;){var r=this.nextInstruction(t);if(n.push(r),this.hasReachedEnd())break;var a=this.getInstruction(this.currentIndex+1);if(a.deltaDurationTicks>0)break}return e&&e(n),this.rowCount++,this.cursorPosition++,n}},{key:"seekToIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Number.isInteger(e))throw new Error("Invalid seek index");for(;!this.hasReachedEnd()&&!(e<=this.currentIndex)&&this.nextInstruction(t););}},{key:"seekToEnd",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!this.hasReachedEnd();)this.nextInstruction(e)}},{key:"seekToPosition",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!this.hasReachedEnd();){var n=this.getInstruction(this.currentIndex+1),r=n.deltaDurationTicks/this.timeDivision/(this.beatsPerMinute/60);if(this.positionSeconds+r>=e)break;this.nextInstruction(t)}}},{key:"seekToPositionTicks",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!this.hasReachedEnd()&&this.positionTicks<=e;){var n=this.getInstruction(this.currentIndex+1);if(this.positionTicks+n.deltaDurationTicks>e)break;this.nextInstruction(t)}}}]),e}(),s=n(7),u=n(5),c=n(8),l=function(e){function t(e,n,a,o){var i;if(Object(r.a)(this,t),i=Object(s.a)(this,Object(u.a)(t).call(this,e,a,o)),!n)throw new Error("Invalid quantizationTicks");return i.quantizationTicks=n,i.nextQuantizationBreakInTicks=0,i}return Object(c.a)(t,e),Object(a.a)(t,[{key:"getNextInstructionPositionInTicks",value:function(){return this.hasReachedEnd()?null:this.getInstruction(this.currentIndex+1).deltaDurationTicks+this.lastInstructionPositionInTicks}},{key:"updateNextQuantizationBreakInTicks",value:function(){var e=this.getNextInstructionPositionInTicks();for(e<this.positionTicks&&(e=this.positionTicks);this.nextQuantizationBreakInTicks<=e;)this.nextQuantizationBreakInTicks+=this.quantizationTicks}},{key:"getNextRowPositionTicks",value:function(){var e=this.nextQuantizationBreakInTicks;if(this.hasReachedEnd())return e;var t=this.getInstruction(this.currentIndex+1).deltaDurationTicks+this.lastInstructionPositionInTicks;return t<e?t:e}},{key:"nextQuantizedInstructionRow",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.nextQuantizationBreakInTicks,a=function(){var n=(r-e.positionTicks)/e.timeDivision/(e.beatsPerMinute/60);e.positionSeconds+=n,e.positionTicks=r,e.nextQuantizationBreakInTicks+=e.quantizationTicks;var a=[];return t&&t(a),e.rowCount++,e.cursorPosition++,a};if(!this.hasReachedEnd()){var o=this.getNextInstructionPositionInTicks();return r<o?a():(this.updateNextQuantizationBreakInTicks(),this.nextInstructionRow(t,n))}return a()}},{key:"seekToIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Number.isInteger(e))throw new Error("Invalid seek index");for(;e!==this.currentIndex&&(this.nextInstruction(t),this.nextQuantizedInstructionRow(null,t)););}},{key:"seekToEnd",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!this.hasReachedEnd();)this.nextQuantizedInstructionRow(null,e)}},{key:"seekToPosition",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.positionSeconds<e;)this.nextQuantizedInstructionRow(null,t)}},{key:"seekToPositionTicks",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.positionTicks<e;)this.nextQuantizedInstructionRow(null,t)}}]),t}(i),f=(n(34),n(71));n.d(t,"a",(function(){return o.a})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return l})),n.d(t,"c",(function(){return f.default}))},,,,,,function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(11),i=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0];Object(r.a)(this,e),this.data=t}return Object(a.a)(e,[{key:"getDurationString",value:function(e){var t=this.durationTicks;return null===t?"N/A":o.a.formatDuration(t,e)}},{key:"command",get:function(){return this.data[1]},set:function(e){this.data[1]=e}},{key:"deltaDurationTicks",get:function(){return this.data[0]},set:function(e){this.data[0]=e}},{key:"durationTicks",set:function(e){throw new Error("TODO: Implement for "+this.constructor.name)},get:function(){throw new Error("TODO: Implement for "+this.constructor.name)}},{key:"clone",get:function(){throw new Error("TODO: Implement for "+this.constructor.name)}},{key:"velocity",set:function(e){throw new Error("TODO: Implement for "+this.constructor.name)},get:function(){throw new Error("TODO: Implement for "+this.constructor.name)}}],[{key:"processInstructionTracks",value:function(e){var t=this;Object.keys(e).forEach((function(n,r){return t.processInstructionTrack(e[n])}))}},{key:"processInstructionTrack",value:function(e){if(!Array.isArray(e))throw new Error("Invalid ASCTrack instruction array");for(var t=0;t<e.length;t++){var n=this.parseInstruction(e[t]);e[t]=n.data}}},{key:"parseInstruction",value:function(t){if(t instanceof e)return t;if("number"===typeof t&&(t=[t]),"string"===typeof t&&(t=[0,t]),!Array.isArray(t))throw new Error("Invalid instruction data");return"string"===typeof t[0]&&t.unshift(0),this.getInstruction(t)}},{key:"getInstruction",value:function(e){if(!e)throw new Error("Invalid Instruction data");var t=e[1];if("string"===typeof t)switch(t[0]){case"@":return new(n(34).default)(e);case"!":return new(n(72).default)(e);default:return new(n(71).default)(e)}else if("number"===typeof t)return new(n(137).default)(e);throw new Error("Unknown Instruction")}}]),e}();t.a=i},function(e,t,n){"use strict";var r=n(0),a=function(){throw new Error("MenuContext Object is unimplemented")},o=n.n(r).a.createContext({openMenu:function(e){return a},closeMenus:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return a},closeAllMenus:function(){return a},isHoverEnabled:function(){return a},removeDropDownMenu:function(e){return a},addDropDownMenu:function(e){return a}});t.a=o},,function(e,t,n){"use strict";var r=n(2),a=n.n(r),o=n(6),i=n(3),s=n(4),u=n(73),c=n.n(u),l=n(11),f=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"setItem",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",localStorage.setItem(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItem",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",localStorage.getItem(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),h=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,[{key:"getRecentSongList",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this,e.next=3,f.getItem("song-recent-list");case 3:if(e.t1=e.sent,e.t1){e.next=6;break}e.t1="[]";case 6:return e.t2=e.t1,e.abrupt("return",e.t0.decodeForStorage.call(e.t0,e.t2));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"encodeForStorage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=JSON.stringify(e,t,n);return c.a.compress(r)}},{key:"decodeForStorage",value:function(e){return e?(e=c.a.decompress(e)||e,JSON.parse(e)):null}},{key:"saveState",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:"audio-source-state",e.next=3,f.setItem(n,JSON.stringify(t));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadState",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t,n,r=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"audio-source-state",e.next=3,f.getItem(t);case 3:return(n=e.sent)&&(n=JSON.parse(n)),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"saveSongToMemory",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uuid||(t.uuid=l.a.generateUUID()),r=[],e.prev=2,e.t0=this,e.next=6,f.getItem("song-recent-list");case 6:if(e.t1=e.sent,e.t1){e.next=9;break}e.t1="[]";case 9:e.t2=e.t1,r=e.t0.decodeForStorage.call(e.t0,e.t2),e.next=16;break;case 13:e.prev=13,e.t3=e.catch(2),console.error(e.t3);case 16:return(r=r.filter((function(e){return e.uuid!==t.uuid}))).unshift({uuid:t.uuid,title:t.title}),e.next=20,f.setItem("song-recent-list",this.encodeForStorage(r));case 20:return e.next=22,f.setItem("song:"+t.uuid,this.encodeForStorage(t));case 22:return e.next=24,f.setItem("song-history:"+t.uuid,this.encodeForStorage(n));case 24:console.info("Song saved to memory: "+t.uuid,t);case 25:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveSongToFile",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="/** INSTRUCTIONS-"+l.a.generateUUID()+" **/",r=JSON.stringify(e.tracks),a=JSON.stringify(Object.assign({},e,{tracks:n}),null,"\t");a=a.replace('"'+n+'"',r);var o="data:text/json;charset=utf-8,"+encodeURIComponent(a),i=document.createElement("a");i.setAttribute("href",o);var s=(e.title||"untitled").replace(/\s+/g,"_")+".json";if(t&&(s=window.prompt("Download as file?",s)),!s)return console.warn("Download canceled");i.setAttribute("download",s),document.body.appendChild(i),i.click(),i.remove()}},{key:"loadSongFromMemory",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getItem("song:"+t);case 2:if(n=e.sent){e.next=5;break}throw new Error("Song Data not found for uuid: "+t);case 5:if(r=this.decodeForStorage(n)){e.next=8;break}throw new Error("Invalid Song Data: "+n);case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSongHistoryFromMemory",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getItem("song-history:"+t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",null);case 5:return e.abrupt("return",this.decodeForStorage(n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBatchRecentCommands",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getItem("batch-recent-commands");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:return t=JSON.parse(t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"addBatchRecentCommands",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return-1===(n=this.getBatchRecentCommands()).indexOf(t)&&n.unshift(t),e.next=4,f.setItem("batch-recent-commands",JSON.stringify(n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getBatchRecentSearches",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.getItem("batch-recent-searches");case 2:if(t=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:return t=JSON.parse(t),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"addBatchRecentSearches",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return-1===(n=this.getBatchRecentSearches()).indexOf(t)&&n.unshift(t),e.next=4,f.setItem("batch-recent-searches",JSON.stringify(n));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();t.a=h},,,,,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTrackName",value:function(){return"string"===typeof this.data[1]?this.data[1].substr(1):void 0}},{key:"setTrackName",value:function(e){this.data[1]="@".concat(e)}},{key:"clone",value:function(){return new t(this.data.slice())}},{key:"instruction",get:function(){return this.data[2]},set:function(e){this.data[2]=e}},{key:"durationTicks",get:function(){return this.data[3]||void 0},set:function(e){if(e=parseFloat(e),Number.isNaN(e))throw new Error("Invalid Duration");this.data[3]=e}},{key:"velocity",get:function(){}}]),t}(n(21).a);t.default=u},function(e,t,n){"use strict";var r=n(2),a=n.n(r),o=n(6),i=n(12),s=n(3),u=n(4),c=n(14),l=n(57),f=n(24),h=n(103),d=n(7),p=n(5),m=n(28),g=n(8),v=function(){function e(t,n,r,a){Object(s.a)(this,e),this._outerAudioProcess=this._outerAudioProcess.bind(this),this.paused=!0,this.fileExtensions=[],this.metadata={},this.audioCtx=t,this.destinationNode=n,this.onPlayerStateUpdate=a,this.bufferSize=2048,this._innerAudioProcess=null,this.audioNode=this.audioCtx.createScriptProcessor(this.bufferSize,2,2),this.audioNode.onaudioprocess=this._outerAudioProcess,this.debug=-1!==window.location.search.indexOf("debug=true"),this.timeCount=0,this.renderTime=0,this.perfLoggingInterval=100}return Object(u.a)(e,[{key:"togglePause",value:function(){return this.paused=!this.paused,this.paused}},{key:"isPaused",value:function(){return this.paused}},{key:"resume",value:function(){this.paused=!1}},{key:"canPlay",value:function(e){return-1!==this.fileExtensions.indexOf(e.toLowerCase())}},{key:"loadData",value:function(e,t){throw Error("Player.loadData() must be implemented.")}},{key:"stop",value:function(){throw Error("Player.stop() must be implemented.")}},{key:"isPlaying",value:function(){throw Error("Player.isPlaying() must be implemented.")}},{key:"setTempo",value:function(){console.warn("Player.setTempo() not implemented for this player.")}},{key:"setVoices",value:function(){console.warn("Player.setVoices() not implemented for this player.")}},{key:"setFadeout",value:function(e){console.warn("Player.setFadeout() not implemented for this player.")}},{key:"getVoiceName",value:function(e){console.warn("Player.getVoiceName() not implemented for this player.")}},{key:"getNumVoices",value:function(){return 0}},{key:"getNumSubtunes",value:function(){return 1}},{key:"getSubtune",value:function(){return 0}},{key:"getMetadata",value:function(){return{title:null,author:null}}},{key:"getParamDefs",value:function(){return[]}},{key:"connect",value:function(){if(!this._innerAudioProcess)throw Error("Player.setAudioProcess has not been called.");this.audioNode.connect(this.destinationNode)}},{key:"suspend",value:function(){this.stopped=!0,this.paused=!0}},{key:"setOnPlayerStateUpdate",value:function(e){this.onPlayerStateUpdate=e}},{key:"setAudioProcess",value:function(e){if("function"!==typeof e)throw Error("AudioProcess must be a function.");this._innerAudioProcess=e}},{key:"_outerAudioProcess",value:function(e){var t=performance.now();this._innerAudioProcess(e);var n=performance.now();if(this.debug&&(this.renderTime+=n-t,this.timeCount++,this.timeCount>=this.perfLoggingInterval)){var r=this.renderTime/this.timeCount,a=1e3*this.bufferSize/this.audioCtx.sampleRate;console.log("[%s] %s ms to render %d frames (%s ms) (%s% utilization)",this.constructor.name,r.toFixed(2),this.bufferSize,a.toFixed(1),(100*r/a).toFixed(1)),this.renderTime=0,this.timeCount=0}}},{key:"muteAudioDuringCall",value:function(e,t){if(e&&"running"===e.context.state&&!1===this.paused){var n=e.onaudioprocess;e.onaudioprocess=function(r){for(var a=0;a<r.outputBuffer.numberOfChannels;a++)r.outputBuffer.getChannelData(a).fill(0);t(),e.onaudioprocess=n}}else t()}}],[{key:"metadataFromFilepath",value:function(e){var t=e.split("/"),n={};return n.title=t.pop(),n.system=t.shift(),"Game MIDI"===n.system?n.game=t.shift():n.artist=t.shift(),n}}]),e}(),y=n(55),k=function e(t){Object(s.a)(this,e);var n=new y.CalcCascades,r=n.lowpass({order:5,characteristic:"butterworth",Fs:t,Fc:200,gain:0}),a=n.lowpass({order:3,characteristic:"butterworth",Fs:t,Fc:120,gain:0}),o=n.highpass({order:3,characteristic:"butterworth",Fs:t,Fc:25,gain:0}),i=new y.IirFilter(r),u=new y.IirFilter(a),c=new y.IirFilter(o),l=0,f=0,h=0,d=0,p=Math.exp(-1/(.16*t)),m=0,g=Math.exp(-1/(.016*t));function v(e){return e=function(e){return e-(d=p*d+(1-p)*e)}(e),1.414*(m=g*m+(1-g)*Math.abs(e))}this.process=function(e){var t=i.singleStep(e),n=v(t);f=l,l=t,f<0&&l>=0&&(h=(h+1)%Math.pow(2,1));for(var r=0,a=0;a<1;a++){r+=h&1<<a?1:-1}return c.singleStep(u.singleStep(r))*n}},b=n(99),w=n.n(b),E=null,_=null,S=["nsf","nsfe","spc","gym","vgm","vgz","ay","sgc","kss"],P=function(e){function t(e,n,r,a){var o;return Object(s.a)(this,t),(o=Object(d.a)(this,Object(p.a)(t).call(this,e,n,r,a))).setParameter=o.setParameter.bind(Object(m.a)(o)),o.getParameter=o.getParameter.bind(Object(m.a)(o)),o.getParamDefs=o.getParamDefs.bind(Object(m.a)(o)),_=r,o.paused=!1,o.fileExtensions=S,o.subtune=0,o.tempo=1,o.params={subbass:1},o.buffer=_.allocate(16*o.bufferSize,"i16",_.ALLOC_NORMAL),o.emuPtr=_.allocate(1,"i32",_.ALLOC_NORMAL),o.subBass=new k(e.sampleRate),o.setAudioProcess(o.gmeAudioProcess),o}return Object(g.a)(t,e),Object(u.a)(t,[{key:"gmeAudioProcess",value:function(e){var t,n,r=[];for(n=0;n<e.outputBuffer.numberOfChannels;n++)r[n]=e.outputBuffer.getChannelData(n);if(this.paused)for(n=0;n<r.length;n++)r[n].fill(0);else if(this.getPositionMs()>=this.getDurationMs()&&!1===this.fadingOut&&(console.log("Fading out at %d ms.",this.getPositionMs()),this.setFadeout(this.getPositionMs()),this.fadingOut=!0),1!==_._gme_track_ended(E)){for(_._gme_play(E,2*this.bufferSize,this.buffer),n=0;n<r.length;n++)for(t=0;t<this.bufferSize;t++)r[n][t]=_.getValue(this.buffer+2*t*2+2*n,"i16")/65535;if(this.params.subbass>0)for(t=0;t<this.bufferSize;t++){var a=this.subBass.process(r[0][t])*this.params.subbass;r[0][t]+=a,r[1][t]+=a}}else this.subtune++,(this.subtune>=_._gme_track_count(E)||0!==this.playSubtune(this.subtune))&&(this.suspend(),console.debug("GMEPlayer.gmeAudioProcess(): _gme_track_ended == %s and subtune (%s) > _gme_track_count (%s).",_._gme_track_ended(E),this.subtune,_._gme_track_count(E)),this.onPlayerStateUpdate(!0))}},{key:"playSubtune",value:function(e){return this.fadingOut=!1,this.subtune=e,this.metadata=this._parseMetadata(e),console.debug("GMEPlayer.playSubtune(subtune=%s)",e),this.onPlayerStateUpdate(!1),_._gme_start_track(E,e)}},{key:"loadData",value:function(e,t){this.subtune=0,this.fadingOut=!1,this.filepathMeta=v.metadataFromFilepath(t);var n=t.match(/(\.sgc$|\.kss$|\.nsfe?$|\.ay$|Master System|Game Gear)/i);if(this.params.subbass=n?1:0,0!==_.ccall("gme_open_data","number",["array","number","number","number"],[e,e.length,this.emuPtr,this.audioCtx.sampleRate]))throw console.error("gme_open_data failed."),this.stop(),Error("Unable to load this file: "+t);if(E=_.getValue(this.emuPtr,"i32"),this.connect(),this.resume(),0!==this.playSubtune(this.subtune))throw console.error("gme_start_track failed."),Error("Unable to play this subtune!")}},{key:"_parseMetadata",value:function(e){var t=_.allocate(1,"i32",_.ALLOC_NORMAL);0!==_._gme_track_info(E,t,e)&&console.error("could not load metadata");var n=_.getValue(t,"*"),r=0,a=function(){var e=_.getValue(n+r,"i32");return r+=4,e},o=function(){for(var e=[],t=_.getValue(n+r,"i8*"),a=0;a<255;a++){var o=_.getValue(t+a,"i8");if(0===o)break;e.push(255&o)}return r+=4,w.a.convert(e,{to:"UNICODE",type:"string"})},i={};return i.length=a(),i.intro_length=a(),i.loop_length=a(),i.play_length=a(),r+=48,i.system=o(),i.game=o(),i.title=o()||i.game||this.filepathMeta.title,i.artist=o()||this.filepathMeta.artist,i.copyright=o(),i.comment=o(),i}},{key:"getVoiceName",value:function(e){if(E)return _.UTF8ToString(_._gme_voice_name(E,e))}},{key:"getNumVoices",value:function(){if(E)return _._gme_voice_count(E)}},{key:"getNumSubtunes",value:function(){if(E)return _._gme_track_count(E)}},{key:"getSubtune",value:function(){return this.subtune}},{key:"getPositionMs",value:function(){return E?_._gme_tell_scaled(E):0}},{key:"getDurationMs",value:function(){return E?this.metadata.play_length:0}},{key:"getMetadata",value:function(){return this.metadata}},{key:"getParameter",value:function(e){return this.params[e]}},{key:"getParamDefs",value:function(){return[{id:"subbass",label:"Sub Bass",type:"number",min:0,max:2,step:.01,value:1}]}},{key:"setParameter",value:function(e,t){switch(e){case"subbass":this.params[e]=parseFloat(t);break;default:console.warn('GMEPlayer has no parameter with id "%s".',e)}}},{key:"isPlaying",value:function(){return!this.isPaused()&&1!==_._gme_track_ended(E)}},{key:"setTempo",value:function(e){this.tempo=e,E&&_._gme_set_tempo(E,e)}},{key:"setFadeout",value:function(e){E&&_._gme_set_fade(E,e,4e3)}},{key:"setVoices",value:function(e){var t=0;e.forEach((function(e,n){e||(t+=1<<n)})),E&&_._gme_mute_voices(E,t)}},{key:"seekMs",value:function(e){E&&this.muteAudioDuringCall(this.audioNode,(function(){return _._gme_seek_scaled(E,e)}))}},{key:"stop",value:function(){this.suspend(),E&&_._gme_delete(E),E=null,console.debug("GMEPlayer.stop()"),this.onPlayerStateUpdate(!0)}}]),t}(v),x=(Math.pow(2,16),function(e){var t,n="undefined"!==typeof(e=e||{})?e:{},r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);var a,o,i=[],s="./this.program",u="";document.currentScript&&(u=document.currentScript.src),u=0!==u.indexOf("blob:")?u.substr(0,u.lastIndexOf("/")+1):"",a=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText};var c,l,f=n.print||console.log.bind(console),h=n.printErr||console.warn.bind(console);for(t in r)r.hasOwnProperty(t)&&(n[t]=r[t]);function d(e){var t=_[A>>2],n=t+e+15&-16;return n>me()&&J(),_[A>>2]=n,t}function p(e){switch(e){case"i1":case"i8":return 1;case"i16":return 2;case"i32":return 4;case"i64":return 8;case"float":return 4;case"double":return 8;default:if("*"===e[e.length-1])return 4;if("i"===e[0]){var t=Number(e.substr(1));return y(t%8===0,"getNativeTypeSize invalid bits "+t+", type "+e),t/8}return 0}}function m(e,t,n,r){switch("*"===(n=n||"i8").charAt(n.length-1)&&(n="i32"),n){case"i1":case"i8":b[e>>0]=t;break;case"i16":E[e>>1]=t;break;case"i32":_[e>>2]=t;break;case"i64":ee=[t>>>0,(Z=t,+z(Z)>=1?Z>0?(0|q(+G(Z/4294967296),4294967295))>>>0:~~+V((Z-+(~~Z>>>0))/4294967296)>>>0:0)],_[e>>2]=ee[0],_[e+4>>2]=ee[1];break;case"float":S[e>>2]=t;break;case"double":P[e>>3]=t;break;default:J("invalid type for setValue: "+n)}}r=null,n.arguments&&(i=n.arguments),n.thisProgram&&(s=n.thisProgram),n.quit&&n.quit,n.wasmBinary&&(c=n.wasmBinary),n.noExitRuntime&&n.noExitRuntime,"object"!==typeof WebAssembly&&h("no native wasm support detected");var g=new WebAssembly.Table({initial:915,maximum:915,element:"anyfunc"}),v=!1;function y(e,t){e||J("Assertion failed: "+t)}var k,b,w,E,_,S,P,x="undefined"!==typeof TextDecoder?new TextDecoder("utf8"):void 0;function O(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.subarray&&x)return x.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function D(e,t){return e?O(w,e,t):""}function I(e,t,n,r){if(!(r>0))return 0;for(var a=n,o=n+r-1,i=0;i<e.length;++i){var s=e.charCodeAt(i);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++i)),s<=127){if(n>=o)break;t[n++]=s}else if(s<=2047){if(n+1>=o)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=o)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-a}function C(e,t,n){return I(e,w,t,n)}function M(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}function j(e,t){b.set(e,t)}function T(e){k=e,n.HEAP8=b=new Int8Array(e),n.HEAP16=E=new Int16Array(e),n.HEAP32=_=new Int32Array(e),n.HEAPU8=w=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAPU32=new Uint32Array(e),n.HEAPF32=S=new Float32Array(e),n.HEAPF64=P=new Float64Array(e)}"undefined"!==typeof TextDecoder&&new TextDecoder("utf-16le");var A=5682208,F=n.INITIAL_MEMORY||16777216;function N(e){for(;e.length>0;){var t=e.shift();if("function"!=typeof t){var r=t.func;"number"===typeof r?void 0===t.arg?n.dynCall_v(r):n.dynCall_vi(r,t.arg):r(void 0===t.arg?null:t.arg)}else t()}}(l=n.wasmMemory?n.wasmMemory:new WebAssembly.Memory({initial:F/65536}))&&(k=l.buffer),F=k.byteLength,T(k),_[A>>2]=10925248;var R=[],L=[],B=[],U=[],z=Math.abs,V=Math.ceil,G=Math.floor,q=Math.min,K=0,W=null,H=null;function Q(e){K++,n.monitorRunDependencies&&n.monitorRunDependencies(K)}function Y(e){if(K--,n.monitorRunDependencies&&n.monitorRunDependencies(K),0==K&&(null!==W&&(clearInterval(W),W=null),H)){var t=H;H=null,t()}}function J(e){throw n.onAbort&&n.onAbort(e),f(e+=""),h(e),v=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(e)}function X(e){return String.prototype.startsWith?e.startsWith("data:application/octet-stream;base64,"):0===e.indexOf("data:application/octet-stream;base64,")}n.preloadedImages={},n.preloadedAudios={};var $,Z,ee,te="chip-core.wasm";function ne(){try{if(c)return new Uint8Array(c);if(o)return o(te);throw"both async and sync fetching of the wasm failed"}catch(h){J(h)}}X(te)||($=te,te=n.locateFile?n.locateFile($,u):u+$);var re={161276:function(e){console.log("Error during V2M conversion.",e)},161441:function(e){console.log("Tiny MIDI Player loaded %d bytes.",e)},161499:function(e){console.log("First note appears at %d ms.",e)}};function ae(){var e=function(){var e=new Error;if(!e.stack){try{throw new Error}catch(t){e=t}if(!e.stack)return"(no stack trace available)"}return e.stack.toString()}();return n.extraStackTrace&&(e+="\n"+n.extraStackTrace()),e.replace(/\b_Z[\w\d_]+/g,(function(e){return e===e?e:e+" ["+e+"]"}))}L.push({func:function(){Ce()}});var oe={};function ie(){return ie.uncaught_exceptions>0}function se(e){return n.___errno_location&&(_[n.___errno_location()>>2]=e),e}var ue={splitPath:function(e){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(e).slice(1)},normalizeArray:function(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n;n--)e.unshift("..");return e},normalize:function(e){var t="/"===e.charAt(0),n="/"===e.substr(-1);return(e=ue.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},dirname:function(e){var t=ue.splitPath(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."},basename:function(e){if("/"===e)return"/";var t=e.lastIndexOf("/");return-1===t?e:e.substr(t+1)},extname:function(e){return ue.splitPath(e)[3]},join:function(){var e=Array.prototype.slice.call(arguments,0);return ue.normalize(e.join("/"))},join2:function(e,t){return ue.normalize(e+"/"+t)}},ce={resolve:function(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:he.cwd();if("string"!==typeof r)throw new TypeError("Arguments to path.resolve must be strings");if(!r)return"";e=r+"/"+e,t="/"===r.charAt(0)}return(t?"/":"")+(e=ue.normalizeArray(e.split("/").filter((function(e){return!!e})),!t).join("/"))||"."},relative:function(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=ce.resolve(e).substr(1),t=ce.resolve(t).substr(1);for(var r=n(e.split("/")),a=n(t.split("/")),o=Math.min(r.length,a.length),i=o,s=0;s<o;s++)if(r[s]!==a[s]){i=s;break}var u=[];for(s=i;s<r.length;s++)u.push("..");return(u=u.concat(a.slice(i))).join("/")}},le={ttys:[],init:function(){},shutdown:function(){},register:function(e,t){le.ttys[e]={input:[],output:[],ops:t},he.registerDevice(e,le.stream_ops)},stream_ops:{open:function(e){var t=le.ttys[e.node.rdev];if(!t)throw new he.ErrnoError(43);e.tty=t,e.seekable=!1},close:function(e){e.tty.ops.flush(e.tty)},flush:function(e){e.tty.ops.flush(e.tty)},read:function(e,t,n,r,a){if(!e.tty||!e.tty.ops.get_char)throw new he.ErrnoError(60);for(var o=0,i=0;i<r;i++){var s;try{s=e.tty.ops.get_char(e.tty)}catch(u){throw new he.ErrnoError(29)}if(void 0===s&&0===o)throw new he.ErrnoError(6);if(null===s||void 0===s)break;o++,t[n+i]=s}return o&&(e.node.timestamp=Date.now()),o},write:function(e,t,n,r,a){if(!e.tty||!e.tty.ops.put_char)throw new he.ErrnoError(60);try{for(var o=0;o<r;o++)e.tty.ops.put_char(e.tty,t[n+o])}catch(i){throw new he.ErrnoError(29)}return r&&(e.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(e){if(!e.input.length){var t=null;if("undefined"!=typeof window&&"function"==typeof window.prompt?null!==(t=window.prompt("Input: "))&&(t+="\n"):"function"==typeof readline&&null!==(t=readline())&&(t+="\n"),!t)return null;e.input=xe(t,!0)}return e.input.shift()},put_char:function(e,t){null===t||10===t?(f(O(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(f(O(e.output,0)),e.output=[])}},default_tty1_ops:{put_char:function(e,t){null===t||10===t?(h(O(e.output,0)),e.output=[]):0!=t&&e.output.push(t)},flush:function(e){e.output&&e.output.length>0&&(h(O(e.output,0)),e.output=[])}}},fe={ops_table:null,mount:function(e){return fe.createNode(null,"/",16895,0)},createNode:function(e,t,n,r){if(he.isBlkdev(n)||he.isFIFO(n))throw new he.ErrnoError(63);fe.ops_table||(fe.ops_table={dir:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr,lookup:fe.node_ops.lookup,mknod:fe.node_ops.mknod,rename:fe.node_ops.rename,unlink:fe.node_ops.unlink,rmdir:fe.node_ops.rmdir,readdir:fe.node_ops.readdir,symlink:fe.node_ops.symlink},stream:{llseek:fe.stream_ops.llseek}},file:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr},stream:{llseek:fe.stream_ops.llseek,read:fe.stream_ops.read,write:fe.stream_ops.write,allocate:fe.stream_ops.allocate,mmap:fe.stream_ops.mmap,msync:fe.stream_ops.msync}},link:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr,readlink:fe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr},stream:he.chrdev_stream_ops}});var a=he.createNode(e,t,n,r);return he.isDir(a.mode)?(a.node_ops=fe.ops_table.dir.node,a.stream_ops=fe.ops_table.dir.stream,a.contents={}):he.isFile(a.mode)?(a.node_ops=fe.ops_table.file.node,a.stream_ops=fe.ops_table.file.stream,a.usedBytes=0,a.contents=null):he.isLink(a.mode)?(a.node_ops=fe.ops_table.link.node,a.stream_ops=fe.ops_table.link.stream):he.isChrdev(a.mode)&&(a.node_ops=fe.ops_table.chrdev.node,a.stream_ops=fe.ops_table.chrdev.stream),a.timestamp=Date.now(),e&&(e.contents[t]=a),a},getFileDataAsRegularArray:function(e){if(e.contents&&e.contents.subarray){for(var t=[],n=0;n<e.usedBytes;++n)t.push(e.contents[n]);return t}return e.contents},getFileDataAsTypedArray:function(e){return e.contents?e.contents.subarray?e.contents.subarray(0,e.usedBytes):new Uint8Array(e.contents):new Uint8Array(0)},expandFileStorage:function(e,t){var n=e.contents?e.contents.length:0;if(!(n>=t)){t=Math.max(t,n*(n<1048576?2:1.125)|0),0!=n&&(t=Math.max(t,256));var r=e.contents;e.contents=new Uint8Array(t),e.usedBytes>0&&e.contents.set(r.subarray(0,e.usedBytes),0)}},resizeFileStorage:function(e,t){if(e.usedBytes!=t){if(0==t)return e.contents=null,void(e.usedBytes=0);if(!e.contents||e.contents.subarray){var n=e.contents;return e.contents=new Uint8Array(t),n&&e.contents.set(n.subarray(0,Math.min(t,e.usedBytes))),void(e.usedBytes=t)}if(e.contents||(e.contents=[]),e.contents.length>t)e.contents.length=t;else for(;e.contents.length<t;)e.contents.push(0);e.usedBytes=t}},node_ops:{getattr:function(e){var t={};return t.dev=he.isChrdev(e.mode)?e.id:1,t.ino=e.id,t.mode=e.mode,t.nlink=1,t.uid=0,t.gid=0,t.rdev=e.rdev,he.isDir(e.mode)?t.size=4096:he.isFile(e.mode)?t.size=e.usedBytes:he.isLink(e.mode)?t.size=e.link.length:t.size=0,t.atime=new Date(e.timestamp),t.mtime=new Date(e.timestamp),t.ctime=new Date(e.timestamp),t.blksize=4096,t.blocks=Math.ceil(t.size/t.blksize),t},setattr:function(e,t){void 0!==t.mode&&(e.mode=t.mode),void 0!==t.timestamp&&(e.timestamp=t.timestamp),void 0!==t.size&&fe.resizeFileStorage(e,t.size)},lookup:function(e,t){throw he.genericErrors[44]},mknod:function(e,t,n,r){return fe.createNode(e,t,n,r)},rename:function(e,t,n){if(he.isDir(e.mode)){var r;try{r=he.lookupNode(t,n)}catch(o){}if(r)for(var a in r.contents)throw new he.ErrnoError(55)}delete e.parent.contents[e.name],e.name=n,t.contents[n]=e,e.parent=t},unlink:function(e,t){delete e.contents[t]},rmdir:function(e,t){var n=he.lookupNode(e,t);for(var r in n.contents)throw new he.ErrnoError(55);delete e.contents[t]},readdir:function(e){var t=[".",".."];for(var n in e.contents)e.contents.hasOwnProperty(n)&&t.push(n);return t},symlink:function(e,t,n){var r=fe.createNode(e,t,41471,0);return r.link=n,r},readlink:function(e){if(!he.isLink(e.mode))throw new he.ErrnoError(28);return e.link}},stream_ops:{read:function(e,t,n,r,a){var o=e.node.contents;if(a>=e.node.usedBytes)return 0;var i=Math.min(e.node.usedBytes-a,r);if(i>8&&o.subarray)t.set(o.subarray(a,a+i),n);else for(var s=0;s<i;s++)t[n+s]=o[a+s];return i},write:function(e,t,n,r,a,o){if(t.buffer===b.buffer&&(o=!1),!r)return 0;var i=e.node;if(i.timestamp=Date.now(),t.subarray&&(!i.contents||i.contents.subarray)){if(o)return i.contents=t.subarray(n,n+r),i.usedBytes=r,r;if(0===i.usedBytes&&0===a)return i.contents=t.slice(n,n+r),i.usedBytes=r,r;if(a+r<=i.usedBytes)return i.contents.set(t.subarray(n,n+r),a),r}if(fe.expandFileStorage(i,a+r),i.contents.subarray&&t.subarray)i.contents.set(t.subarray(n,n+r),a);else for(var s=0;s<r;s++)i.contents[a+s]=t[n+s];return i.usedBytes=Math.max(i.usedBytes,a+r),r},llseek:function(e,t,n){var r=t;if(1===n?r+=e.position:2===n&&he.isFile(e.node.mode)&&(r+=e.node.usedBytes),r<0)throw new he.ErrnoError(28);return r},allocate:function(e,t,n){fe.expandFileStorage(e.node,t+n),e.node.usedBytes=Math.max(e.node.usedBytes,t+n)},mmap:function(e,t,n,r,a,o,i){if(!he.isFile(e.node.mode))throw new he.ErrnoError(43);var s,u,c=e.node.contents;if(2&i||c.buffer!==t.buffer){(a>0||a+r<c.length)&&(c=c.subarray?c.subarray(a,a+r):Array.prototype.slice.call(c,a,a+r)),u=!0;var l=t.buffer==b.buffer;if(!(s=je(r)))throw new he.ErrnoError(48);(l?b:t).set(c,s)}else u=!1,s=c.byteOffset;return{ptr:s,allocated:u}},msync:function(e,t,n,r,a){if(!he.isFile(e.node.mode))throw new he.ErrnoError(43);return 2&a?0:(fe.stream_ops.write(e,t,0,r,n,!1),0)}}},he={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,handleFSError:function(e){if(!(e instanceof he.ErrnoError))throw e+" : "+ae();return se(e.errno)},lookupPath:function(e,t){if(t=t||{},!(e=ce.resolve(he.cwd(),e)))return{path:"",node:null};var n={follow_mount:!0,recurse_count:0};for(var r in n)void 0===t[r]&&(t[r]=n[r]);if(t.recurse_count>8)throw new he.ErrnoError(32);for(var a=ue.normalizeArray(e.split("/").filter((function(e){return!!e})),!1),o=he.root,i="/",s=0;s<a.length;s++){var u=s===a.length-1;if(u&&t.parent)break;if(o=he.lookupNode(o,a[s]),i=ue.join2(i,a[s]),he.isMountpoint(o)&&(!u||u&&t.follow_mount)&&(o=o.mounted.root),!u||t.follow)for(var c=0;he.isLink(o.mode);){var l=he.readlink(i);if(i=ce.resolve(ue.dirname(i),l),o=he.lookupPath(i,{recurse_count:t.recurse_count}).node,c++>40)throw new he.ErrnoError(32)}}return{path:i,node:o}},getPath:function(e){for(var t;;){if(he.isRoot(e)){var n=e.mount.mountpoint;return t?"/"!==n[n.length-1]?n+"/"+t:n+t:n}t=t?e.name+"/"+t:e.name,e=e.parent}},hashName:function(e,t){for(var n=0,r=0;r<t.length;r++)n=(n<<5)-n+t.charCodeAt(r)|0;return(e+n>>>0)%he.nameTable.length},hashAddNode:function(e){var t=he.hashName(e.parent.id,e.name);e.name_next=he.nameTable[t],he.nameTable[t]=e},hashRemoveNode:function(e){var t=he.hashName(e.parent.id,e.name);if(he.nameTable[t]===e)he.nameTable[t]=e.name_next;else for(var n=he.nameTable[t];n;){if(n.name_next===e){n.name_next=e.name_next;break}n=n.name_next}},lookupNode:function(e,t){var n=he.mayLookup(e);if(n)throw new he.ErrnoError(n,e);for(var r=he.hashName(e.id,t),a=he.nameTable[r];a;a=a.name_next){var o=a.name;if(a.parent.id===e.id&&o===t)return a}return he.lookup(e,t)},createNode:function(e,t,n,r){var a=new he.FSNode(e,t,n,r);return he.hashAddNode(a),a},destroyNode:function(e){he.hashRemoveNode(e)},isRoot:function(e){return e===e.parent},isMountpoint:function(e){return!!e.mounted},isFile:function(e){return 32768===(61440&e)},isDir:function(e){return 16384===(61440&e)},isLink:function(e){return 40960===(61440&e)},isChrdev:function(e){return 8192===(61440&e)},isBlkdev:function(e){return 24576===(61440&e)},isFIFO:function(e){return 4096===(61440&e)},isSocket:function(e){return 49152===(49152&e)},flagModes:{r:0,rs:1052672,"r+":2,w:577,wx:705,xw:705,"w+":578,"wx+":706,"xw+":706,a:1089,ax:1217,xa:1217,"a+":1090,"ax+":1218,"xa+":1218},modeStringToFlags:function(e){var t=he.flagModes[e];if("undefined"===typeof t)throw new Error("Unknown file open mode: "+e);return t},flagsToPermissionString:function(e){var t=["r","w","rw"][3&e];return 512&e&&(t+="w"),t},nodePermissions:function(e,t){return he.ignorePermissions?0:(-1===t.indexOf("r")||292&e.mode)&&(-1===t.indexOf("w")||146&e.mode)&&(-1===t.indexOf("x")||73&e.mode)?0:2},mayLookup:function(e){var t=he.nodePermissions(e,"x");return t||(e.node_ops.lookup?0:2)},mayCreate:function(e,t){try{return he.lookupNode(e,t),20}catch(n){}return he.nodePermissions(e,"wx")},mayDelete:function(e,t,n){var r;try{r=he.lookupNode(e,t)}catch(o){return o.errno}var a=he.nodePermissions(e,"wx");if(a)return a;if(n){if(!he.isDir(r.mode))return 54;if(he.isRoot(r)||he.getPath(r)===he.cwd())return 10}else if(he.isDir(r.mode))return 31;return 0},mayOpen:function(e,t){return e?he.isLink(e.mode)?32:he.isDir(e.mode)&&("r"!==he.flagsToPermissionString(t)||512&t)?31:he.nodePermissions(e,he.flagsToPermissionString(t)):44},MAX_OPEN_FDS:4096,nextfd:function(e,t){e=e||0,t=t||he.MAX_OPEN_FDS;for(var n=e;n<=t;n++)if(!he.streams[n])return n;throw new he.ErrnoError(33)},getStream:function(e){return he.streams[e]},createStream:function(e,t,n){he.FSStream||(he.FSStream=function(){},he.FSStream.prototype={object:{get:function(){return this.node},set:function(e){this.node=e}},isRead:{get:function(){return 1!==(2097155&this.flags)}},isWrite:{get:function(){return 0!==(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var r=new he.FSStream;for(var a in e)r[a]=e[a];e=r;var o=he.nextfd(t,n);return e.fd=o,he.streams[o]=e,e},closeStream:function(e){he.streams[e]=null},chrdev_stream_ops:{open:function(e){var t=he.getDevice(e.node.rdev);e.stream_ops=t.stream_ops,e.stream_ops.open&&e.stream_ops.open(e)},llseek:function(){throw new he.ErrnoError(70)}},major:function(e){return e>>8},minor:function(e){return 255&e},makedev:function(e,t){return e<<8|t},registerDevice:function(e,t){he.devices[e]={stream_ops:t}},getDevice:function(e){return he.devices[e]},getMounts:function(e){for(var t=[],n=[e];n.length;){var r=n.pop();t.push(r),n.push.apply(n,r.mounts)}return t},syncfs:function(e,t){"function"===typeof e&&(t=e,e=!1),he.syncFSRequests++,he.syncFSRequests>1&&h("warning: "+he.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var n=he.getMounts(he.root.mount),r=0;function a(e){return he.syncFSRequests--,t(e)}function o(e){if(e)return o.errored?void 0:(o.errored=!0,a(e));++r>=n.length&&a(null)}n.forEach((function(t){if(!t.type.syncfs)return o(null);t.type.syncfs(t,e,o)}))},mount:function(e,t,n){var r,a="/"===n,o=!n;if(a&&he.root)throw new he.ErrnoError(10);if(!a&&!o){var i=he.lookupPath(n,{follow_mount:!1});if(n=i.path,r=i.node,he.isMountpoint(r))throw new he.ErrnoError(10);if(!he.isDir(r.mode))throw new he.ErrnoError(54)}var s={type:e,opts:t,mountpoint:n,mounts:[]},u=e.mount(s);return u.mount=s,s.root=u,a?he.root=u:r&&(r.mounted=s,r.mount&&r.mount.mounts.push(s)),u},unmount:function(e){var t=he.lookupPath(e,{follow_mount:!1});if(!he.isMountpoint(t.node))throw new he.ErrnoError(28);var n=t.node,r=n.mounted,a=he.getMounts(r);Object.keys(he.nameTable).forEach((function(e){for(var t=he.nameTable[e];t;){var n=t.name_next;-1!==a.indexOf(t.mount)&&he.destroyNode(t),t=n}})),n.mounted=null;var o=n.mount.mounts.indexOf(r);n.mount.mounts.splice(o,1)},lookup:function(e,t){return e.node_ops.lookup(e,t)},mknod:function(e,t,n){var r=he.lookupPath(e,{parent:!0}).node,a=ue.basename(e);if(!a||"."===a||".."===a)throw new he.ErrnoError(28);var o=he.mayCreate(r,a);if(o)throw new he.ErrnoError(o);if(!r.node_ops.mknod)throw new he.ErrnoError(63);return r.node_ops.mknod(r,a,t,n)},create:function(e,t){return t=void 0!==t?t:438,t&=4095,t|=32768,he.mknod(e,t,0)},mkdir:function(e,t){return t=void 0!==t?t:511,t&=1023,t|=16384,he.mknod(e,t,0)},mkdirTree:function(e,t){for(var n=e.split("/"),r="",a=0;a<n.length;++a)if(n[a]){r+="/"+n[a];try{he.mkdir(r,t)}catch(o){if(20!=o.errno)throw o}}},mkdev:function(e,t,n){return"undefined"===typeof n&&(n=t,t=438),t|=8192,he.mknod(e,t,n)},symlink:function(e,t){if(!ce.resolve(e))throw new he.ErrnoError(44);var n=he.lookupPath(t,{parent:!0}).node;if(!n)throw new he.ErrnoError(44);var r=ue.basename(t),a=he.mayCreate(n,r);if(a)throw new he.ErrnoError(a);if(!n.node_ops.symlink)throw new he.ErrnoError(63);return n.node_ops.symlink(n,r,e)},rename:function(e,t){var n,r,a=ue.dirname(e),o=ue.dirname(t),i=ue.basename(e),s=ue.basename(t);try{n=he.lookupPath(e,{parent:!0}).node,r=he.lookupPath(t,{parent:!0}).node}catch(p){throw new he.ErrnoError(10)}if(!n||!r)throw new he.ErrnoError(44);if(n.mount!==r.mount)throw new he.ErrnoError(75);var u,c=he.lookupNode(n,i),l=ce.relative(e,o);if("."!==l.charAt(0))throw new he.ErrnoError(28);if("."!==(l=ce.relative(t,a)).charAt(0))throw new he.ErrnoError(55);try{u=he.lookupNode(r,s)}catch(p){}if(c!==u){var f=he.isDir(c.mode),d=he.mayDelete(n,i,f);if(d)throw new he.ErrnoError(d);if(d=u?he.mayDelete(r,s,f):he.mayCreate(r,s))throw new he.ErrnoError(d);if(!n.node_ops.rename)throw new he.ErrnoError(63);if(he.isMountpoint(c)||u&&he.isMountpoint(u))throw new he.ErrnoError(10);if(r!==n&&(d=he.nodePermissions(n,"w")))throw new he.ErrnoError(d);try{he.trackingDelegate.willMovePath&&he.trackingDelegate.willMovePath(e,t)}catch(p){h("FS.trackingDelegate['willMovePath']('"+e+"', '"+t+"') threw an exception: "+p.message)}he.hashRemoveNode(c);try{n.node_ops.rename(c,r,s)}catch(p){throw p}finally{he.hashAddNode(c)}try{he.trackingDelegate.onMovePath&&he.trackingDelegate.onMovePath(e,t)}catch(p){h("FS.trackingDelegate['onMovePath']('"+e+"', '"+t+"') threw an exception: "+p.message)}}},rmdir:function(e){var t=he.lookupPath(e,{parent:!0}).node,n=ue.basename(e),r=he.lookupNode(t,n),a=he.mayDelete(t,n,!0);if(a)throw new he.ErrnoError(a);if(!t.node_ops.rmdir)throw new he.ErrnoError(63);if(he.isMountpoint(r))throw new he.ErrnoError(10);try{he.trackingDelegate.willDeletePath&&he.trackingDelegate.willDeletePath(e)}catch(o){h("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+o.message)}t.node_ops.rmdir(t,n),he.destroyNode(r);try{he.trackingDelegate.onDeletePath&&he.trackingDelegate.onDeletePath(e)}catch(o){h("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+o.message)}},readdir:function(e){var t=he.lookupPath(e,{follow:!0}).node;if(!t.node_ops.readdir)throw new he.ErrnoError(54);return t.node_ops.readdir(t)},unlink:function(e){var t=he.lookupPath(e,{parent:!0}).node,n=ue.basename(e),r=he.lookupNode(t,n),a=he.mayDelete(t,n,!1);if(a)throw new he.ErrnoError(a);if(!t.node_ops.unlink)throw new he.ErrnoError(63);if(he.isMountpoint(r))throw new he.ErrnoError(10);try{he.trackingDelegate.willDeletePath&&he.trackingDelegate.willDeletePath(e)}catch(o){h("FS.trackingDelegate['willDeletePath']('"+e+"') threw an exception: "+o.message)}t.node_ops.unlink(t,n),he.destroyNode(r);try{he.trackingDelegate.onDeletePath&&he.trackingDelegate.onDeletePath(e)}catch(o){h("FS.trackingDelegate['onDeletePath']('"+e+"') threw an exception: "+o.message)}},readlink:function(e){var t=he.lookupPath(e).node;if(!t)throw new he.ErrnoError(44);if(!t.node_ops.readlink)throw new he.ErrnoError(28);return ce.resolve(he.getPath(t.parent),t.node_ops.readlink(t))},stat:function(e,t){var n=he.lookupPath(e,{follow:!t}).node;if(!n)throw new he.ErrnoError(44);if(!n.node_ops.getattr)throw new he.ErrnoError(63);return n.node_ops.getattr(n)},lstat:function(e){return he.stat(e,!0)},chmod:function(e,t,n){var r;if(!(r="string"===typeof e?he.lookupPath(e,{follow:!n}).node:e).node_ops.setattr)throw new he.ErrnoError(63);r.node_ops.setattr(r,{mode:4095&t|-4096&r.mode,timestamp:Date.now()})},lchmod:function(e,t){he.chmod(e,t,!0)},fchmod:function(e,t){var n=he.getStream(e);if(!n)throw new he.ErrnoError(8);he.chmod(n.node,t)},chown:function(e,t,n,r){var a;if(!(a="string"===typeof e?he.lookupPath(e,{follow:!r}).node:e).node_ops.setattr)throw new he.ErrnoError(63);a.node_ops.setattr(a,{timestamp:Date.now()})},lchown:function(e,t,n){he.chown(e,t,n,!0)},fchown:function(e,t,n){var r=he.getStream(e);if(!r)throw new he.ErrnoError(8);he.chown(r.node,t,n)},truncate:function(e,t){if(t<0)throw new he.ErrnoError(28);var n;if(!(n="string"===typeof e?he.lookupPath(e,{follow:!0}).node:e).node_ops.setattr)throw new he.ErrnoError(63);if(he.isDir(n.mode))throw new he.ErrnoError(31);if(!he.isFile(n.mode))throw new he.ErrnoError(28);var r=he.nodePermissions(n,"w");if(r)throw new he.ErrnoError(r);n.node_ops.setattr(n,{size:t,timestamp:Date.now()})},ftruncate:function(e,t){var n=he.getStream(e);if(!n)throw new he.ErrnoError(8);if(0===(2097155&n.flags))throw new he.ErrnoError(28);he.truncate(n.node,t)},utime:function(e,t,n){var r=he.lookupPath(e,{follow:!0}).node;r.node_ops.setattr(r,{timestamp:Math.max(t,n)})},open:function(e,t,r,a,o){if(""===e)throw new he.ErrnoError(44);var i;if(r="undefined"===typeof r?438:r,r=64&(t="string"===typeof t?he.modeStringToFlags(t):t)?4095&r|32768:0,"object"===typeof e)i=e;else{e=ue.normalize(e);try{i=he.lookupPath(e,{follow:!(131072&t)}).node}catch(f){}}var s=!1;if(64&t)if(i){if(128&t)throw new he.ErrnoError(20)}else i=he.mknod(e,r,0),s=!0;if(!i)throw new he.ErrnoError(44);if(he.isChrdev(i.mode)&&(t&=-513),65536&t&&!he.isDir(i.mode))throw new he.ErrnoError(54);if(!s){var u=he.mayOpen(i,t);if(u)throw new he.ErrnoError(u)}512&t&&he.truncate(i,0),t&=-641;var c=he.createStream({node:i,path:he.getPath(i),flags:t,seekable:!0,position:0,stream_ops:i.stream_ops,ungotten:[],error:!1},a,o);c.stream_ops.open&&c.stream_ops.open(c),!n.logReadFiles||1&t||(he.readFiles||(he.readFiles={}),e in he.readFiles||(he.readFiles[e]=1,h("FS.trackingDelegate error on read file: "+e)));try{if(he.trackingDelegate.onOpenFile){var l=0;1!==(2097155&t)&&(l|=he.tracking.openFlags.READ),0!==(2097155&t)&&(l|=he.tracking.openFlags.WRITE),he.trackingDelegate.onOpenFile(e,l)}}catch(f){h("FS.trackingDelegate['onOpenFile']('"+e+"', flags) threw an exception: "+f.message)}return c},close:function(e){if(he.isClosed(e))throw new he.ErrnoError(8);e.getdents&&(e.getdents=null);try{e.stream_ops.close&&e.stream_ops.close(e)}catch(t){throw t}finally{he.closeStream(e.fd)}e.fd=null},isClosed:function(e){return null===e.fd},llseek:function(e,t,n){if(he.isClosed(e))throw new he.ErrnoError(8);if(!e.seekable||!e.stream_ops.llseek)throw new he.ErrnoError(70);if(0!=n&&1!=n&&2!=n)throw new he.ErrnoError(28);return e.position=e.stream_ops.llseek(e,t,n),e.ungotten=[],e.position},read:function(e,t,n,r,a){if(r<0||a<0)throw new he.ErrnoError(28);if(he.isClosed(e))throw new he.ErrnoError(8);if(1===(2097155&e.flags))throw new he.ErrnoError(8);if(he.isDir(e.node.mode))throw new he.ErrnoError(31);if(!e.stream_ops.read)throw new he.ErrnoError(28);var o="undefined"!==typeof a;if(o){if(!e.seekable)throw new he.ErrnoError(70)}else a=e.position;var i=e.stream_ops.read(e,t,n,r,a);return o||(e.position+=i),i},write:function(e,t,n,r,a,o){if(r<0||a<0)throw new he.ErrnoError(28);if(he.isClosed(e))throw new he.ErrnoError(8);if(0===(2097155&e.flags))throw new he.ErrnoError(8);if(he.isDir(e.node.mode))throw new he.ErrnoError(31);if(!e.stream_ops.write)throw new he.ErrnoError(28);1024&e.flags&&he.llseek(e,0,2);var i="undefined"!==typeof a;if(i){if(!e.seekable)throw new he.ErrnoError(70)}else a=e.position;var s=e.stream_ops.write(e,t,n,r,a,o);i||(e.position+=s);try{e.path&&he.trackingDelegate.onWriteToFile&&he.trackingDelegate.onWriteToFile(e.path)}catch(u){h("FS.trackingDelegate['onWriteToFile']('"+e.path+"') threw an exception: "+u.message)}return s},allocate:function(e,t,n){if(he.isClosed(e))throw new he.ErrnoError(8);if(t<0||n<=0)throw new he.ErrnoError(28);if(0===(2097155&e.flags))throw new he.ErrnoError(8);if(!he.isFile(e.node.mode)&&!he.isDir(e.node.mode))throw new he.ErrnoError(43);if(!e.stream_ops.allocate)throw new he.ErrnoError(138);e.stream_ops.allocate(e,t,n)},mmap:function(e,t,n,r,a,o,i){if(0!==(2&o)&&0===(2&i)&&2!==(2097155&e.flags))throw new he.ErrnoError(2);if(1===(2097155&e.flags))throw new he.ErrnoError(2);if(!e.stream_ops.mmap)throw new he.ErrnoError(43);return e.stream_ops.mmap(e,t,n,r,a,o,i)},msync:function(e,t,n,r,a){return e&&e.stream_ops.msync?e.stream_ops.msync(e,t,n,r,a):0},munmap:function(e){return 0},ioctl:function(e,t,n){if(!e.stream_ops.ioctl)throw new he.ErrnoError(59);return e.stream_ops.ioctl(e,t,n)},readFile:function(e,t){if((t=t||{}).flags=t.flags||"r",t.encoding=t.encoding||"binary","utf8"!==t.encoding&&"binary"!==t.encoding)throw new Error('Invalid encoding type "'+t.encoding+'"');var n,r=he.open(e,t.flags),a=he.stat(e).size,o=new Uint8Array(a);return he.read(r,o,0,a,0),"utf8"===t.encoding?n=O(o,0):"binary"===t.encoding&&(n=o),he.close(r),n},writeFile:function(e,t,n){(n=n||{}).flags=n.flags||"w";var r=he.open(e,n.flags,n.mode);if("string"===typeof t){var a=new Uint8Array(M(t)+1),o=I(t,a,0,a.length);he.write(r,a,0,o,void 0,n.canOwn)}else{if(!ArrayBuffer.isView(t))throw new Error("Unsupported data type");he.write(r,t,0,t.byteLength,void 0,n.canOwn)}he.close(r)},cwd:function(){return he.currentPath},chdir:function(e){var t=he.lookupPath(e,{follow:!0});if(null===t.node)throw new he.ErrnoError(44);if(!he.isDir(t.node.mode))throw new he.ErrnoError(54);var n=he.nodePermissions(t.node,"x");if(n)throw new he.ErrnoError(n);he.currentPath=t.path},createDefaultDirectories:function(){he.mkdir("/tmp"),he.mkdir("/home"),he.mkdir("/home/web_user")},createDefaultDevices:function(){var e;if(he.mkdir("/dev"),he.registerDevice(he.makedev(1,3),{read:function(){return 0},write:function(e,t,n,r,a){return r}}),he.mkdev("/dev/null",he.makedev(1,3)),le.register(he.makedev(5,0),le.default_tty_ops),le.register(he.makedev(6,0),le.default_tty1_ops),he.mkdev("/dev/tty",he.makedev(5,0)),he.mkdev("/dev/tty1",he.makedev(6,0)),"object"===typeof crypto&&"function"===typeof crypto.getRandomValues){var t=new Uint8Array(1);e=function(){return crypto.getRandomValues(t),t[0]}}e||(e=function(){J("random_device")}),he.createDevice("/dev","random",e),he.createDevice("/dev","urandom",e),he.mkdir("/dev/shm"),he.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){he.mkdir("/proc"),he.mkdir("/proc/self"),he.mkdir("/proc/self/fd"),he.mount({mount:function(){var e=he.createNode("/proc/self","fd",16895,73);return e.node_ops={lookup:function(e,t){var n=+t,r=he.getStream(n);if(!r)throw new he.ErrnoError(8);var a={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return r.path}}};return a.parent=a,a}},e}},{},"/proc/self/fd")},createStandardStreams:function(){n.stdin?he.createDevice("/dev","stdin",n.stdin):he.symlink("/dev/tty","/dev/stdin"),n.stdout?he.createDevice("/dev","stdout",null,n.stdout):he.symlink("/dev/tty","/dev/stdout"),n.stderr?he.createDevice("/dev","stderr",null,n.stderr):he.symlink("/dev/tty1","/dev/stderr"),he.open("/dev/stdin","r"),he.open("/dev/stdout","w"),he.open("/dev/stderr","w")},ensureErrnoError:function(){he.ErrnoError||(he.ErrnoError=function(e,t){this.node=t,this.setErrno=function(e){this.errno=e},this.setErrno(e),this.message="FS error"},he.ErrnoError.prototype=new Error,he.ErrnoError.prototype.constructor=he.ErrnoError,[44].forEach((function(e){he.genericErrors[e]=new he.ErrnoError(e),he.genericErrors[e].stack="<generic error, no stack>"})))},staticInit:function(){he.ensureErrnoError(),he.nameTable=new Array(4096),he.mount(fe,{},"/"),he.createDefaultDirectories(),he.createDefaultDevices(),he.createSpecialDirectories(),he.filesystems={MEMFS:fe}},init:function(e,t,r){he.init.initialized=!0,he.ensureErrnoError(),n.stdin=e||n.stdin,n.stdout=t||n.stdout,n.stderr=r||n.stderr,he.createStandardStreams()},quit:function(){he.init.initialized=!1;var e=n._fflush;e&&e(0);for(var t=0;t<he.streams.length;t++){var r=he.streams[t];r&&he.close(r)}},getMode:function(e,t){var n=0;return e&&(n|=365),t&&(n|=146),n},joinPath:function(e,t){var n=ue.join.apply(null,e);return t&&"/"==n[0]&&(n=n.substr(1)),n},absolutePath:function(e,t){return ce.resolve(t,e)},standardizePath:function(e){return ue.normalize(e)},findObject:function(e,t){var n=he.analyzePath(e,t);return n.exists?n.object:(se(n.error),null)},analyzePath:function(e,t){try{e=(r=he.lookupPath(e,{follow:!t})).path}catch(a){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var r=he.lookupPath(e,{parent:!0});n.parentExists=!0,n.parentPath=r.path,n.parentObject=r.node,n.name=ue.basename(e),r=he.lookupPath(e,{follow:!t}),n.exists=!0,n.path=r.path,n.object=r.node,n.name=r.node.name,n.isRoot="/"===r.path}catch(a){n.error=a.errno}return n},createFolder:function(e,t,n,r){var a=ue.join2("string"===typeof e?e:he.getPath(e),t),o=he.getMode(n,r);return he.mkdir(a,o)},createPath:function(e,t,n,r){e="string"===typeof e?e:he.getPath(e);for(var a=t.split("/").reverse();a.length;){var o=a.pop();if(o){var i=ue.join2(e,o);try{he.mkdir(i)}catch(s){}e=i}}return i},createFile:function(e,t,n,r,a){var o=ue.join2("string"===typeof e?e:he.getPath(e),t),i=he.getMode(r,a);return he.create(o,i)},createDataFile:function(e,t,n,r,a,o){var i=t?ue.join2("string"===typeof e?e:he.getPath(e),t):e,s=he.getMode(r,a),u=he.create(i,s);if(n){if("string"===typeof n){for(var c=new Array(n.length),l=0,f=n.length;l<f;++l)c[l]=n.charCodeAt(l);n=c}he.chmod(u,146|s);var h=he.open(u,"w");he.write(h,n,0,n.length,0,o),he.close(h),he.chmod(u,s)}return u},createDevice:function(e,t,n,r){var a=ue.join2("string"===typeof e?e:he.getPath(e),t),o=he.getMode(!!n,!!r);he.createDevice.major||(he.createDevice.major=64);var i=he.makedev(he.createDevice.major++,0);return he.registerDevice(i,{open:function(e){e.seekable=!1},close:function(e){r&&r.buffer&&r.buffer.length&&r(10)},read:function(e,t,r,a,o){for(var i=0,s=0;s<a;s++){var u;try{u=n()}catch(c){throw new he.ErrnoError(29)}if(void 0===u&&0===i)throw new he.ErrnoError(6);if(null===u||void 0===u)break;i++,t[r+s]=u}return i&&(e.node.timestamp=Date.now()),i},write:function(e,t,n,a,o){for(var i=0;i<a;i++)try{r(t[n+i])}catch(s){throw new he.ErrnoError(29)}return a&&(e.node.timestamp=Date.now()),i}}),he.mkdev(a,o,i)},createLink:function(e,t,n,r,a){var o=ue.join2("string"===typeof e?e:he.getPath(e),t);return he.symlink(n,o)},forceLoadFile:function(e){if(e.isDevice||e.isFolder||e.link||e.contents)return!0;var t=!0;if("undefined"!==typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!a)throw new Error("Cannot load without read() or XMLHttpRequest.");try{e.contents=xe(a(e.url),!0),e.usedBytes=e.contents.length}catch(n){t=!1}return t||se(29),t},createLazyFile:function(e,t,n,r,a){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,n=e/this.chunkSize|0;return this.getter(n)[t]}},o.prototype.setDataGetter=function(e){this.getter=e},o.prototype.cacheLength=function(){var e=new XMLHttpRequest;if(e.open("HEAD",n,!1),e.send(null),!(e.status>=200&&e.status<300||304===e.status))throw new Error("Couldn't load "+n+". Status: "+e.status);var t,r=Number(e.getResponseHeader("Content-length")),a=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,o=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,i=1048576;a||(i=r);var s=this;s.setDataGetter((function(e){var t=e*i,a=(e+1)*i-1;if(a=Math.min(a,r-1),"undefined"===typeof s.chunks[e]&&(s.chunks[e]=function(e,t){if(e>t)throw new Error("invalid range ("+e+", "+t+") or no bytes requested!");if(t>r-1)throw new Error("only "+r+" bytes available! programmer error!");var a=new XMLHttpRequest;if(a.open("GET",n,!1),r!==i&&a.setRequestHeader("Range","bytes="+e+"-"+t),"undefined"!=typeof Uint8Array&&(a.responseType="arraybuffer"),a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined"),a.send(null),!(a.status>=200&&a.status<300||304===a.status))throw new Error("Couldn't load "+n+". Status: "+a.status);return void 0!==a.response?new Uint8Array(a.response||[]):xe(a.responseText||"",!0)}(t,a)),"undefined"===typeof s.chunks[e])throw new Error("doXHR failed!");return s.chunks[e]})),!o&&r||(i=r=1,r=this.getter(0).length,i=r,f("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=r,this._chunkSize=i,this.lengthKnown=!0},"undefined"!==typeof XMLHttpRequest)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var i={isDevice:!1,url:n},s=he.createFile(e,t,i,r,a);i.contents?s.contents=i.contents:i.url&&(s.contents=null,s.url=i.url),Object.defineProperties(s,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(s.stream_ops).forEach((function(e){var t=s.stream_ops[e];u[e]=function(){if(!he.forceLoadFile(s))throw new he.ErrnoError(29);return t.apply(null,arguments)}})),u.read=function(e,t,n,r,a){if(!he.forceLoadFile(s))throw new he.ErrnoError(29);var o=e.node.contents;if(a>=o.length)return 0;var i=Math.min(o.length-a,r);if(o.slice)for(var u=0;u<i;u++)t[n+u]=o[a+u];else for(u=0;u<i;u++)t[n+u]=o.get(a+u);return i},s.stream_ops=u,s},createPreloadedFile:function(e,t,r,a,o,i,s,u,c,l){Browser.init();var f=t?ce.resolve(ue.join2(e,t)):e;function h(r){function h(n){l&&l(),u||he.createDataFile(e,t,n,a,o,c),i&&i(),Y()}var d=!1;n.preloadPlugins.forEach((function(e){d||e.canHandle(f)&&(e.handle(r,f,h,(function(){s&&s(),Y()})),d=!0)})),d||h(r)}Q(),"string"==typeof r?Browser.asyncLoad(r,(function(e){h(e)}),s):h(r)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(e,t,n){t=t||function(){},n=n||function(){};var r=he.indexedDB();try{var a=r.open(he.DB_NAME(),he.DB_VERSION)}catch(o){return n(o)}a.onupgradeneeded=function(){f("creating db"),a.result.createObjectStore(he.DB_STORE_NAME)},a.onsuccess=function(){var r=a.result.transaction([he.DB_STORE_NAME],"readwrite"),o=r.objectStore(he.DB_STORE_NAME),i=0,s=0,u=e.length;function c(){0==s?t():n()}e.forEach((function(e){var t=o.put(he.analyzePath(e).object.contents,e);t.onsuccess=function(){++i+s==u&&c()},t.onerror=function(){s++,i+s==u&&c()}})),r.onerror=n},a.onerror=n},loadFilesFromDB:function(e,t,n){t=t||function(){},n=n||function(){};var r=he.indexedDB();try{var a=r.open(he.DB_NAME(),he.DB_VERSION)}catch(o){return n(o)}a.onupgradeneeded=n,a.onsuccess=function(){var r=a.result;try{var i=r.transaction([he.DB_STORE_NAME],"readonly")}catch(o){return void n(o)}var s=i.objectStore(he.DB_STORE_NAME),u=0,c=0,l=e.length;function f(){0==c?t():n()}e.forEach((function(e){var t=s.get(e);t.onsuccess=function(){he.analyzePath(e).exists&&he.unlink(e),he.createDataFile(ue.dirname(e),ue.basename(e),t.result,!0,!0,!0),++u+c==l&&f()},t.onerror=function(){c++,u+c==l&&f()}})),i.onerror=n},a.onerror=n}},de={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(e,t){if("/"!==t[0]){var n;if(-100===e)n=he.cwd();else{var r=he.getStream(e);if(!r)throw new he.ErrnoError(8);n=r.path}t=ue.join2(n,t)}return t},doStat:function(e,t,n){try{var r=e(t)}catch(a){if(a&&a.node&&ue.normalize(t)!==ue.normalize(he.getPath(a.node)))return-54;throw a}return _[n>>2]=r.dev,_[n+4>>2]=0,_[n+8>>2]=r.ino,_[n+12>>2]=r.mode,_[n+16>>2]=r.nlink,_[n+20>>2]=r.uid,_[n+24>>2]=r.gid,_[n+28>>2]=r.rdev,_[n+32>>2]=0,ee=[r.size>>>0,(Z=r.size,+z(Z)>=1?Z>0?(0|q(+G(Z/4294967296),4294967295))>>>0:~~+V((Z-+(~~Z>>>0))/4294967296)>>>0:0)],_[n+40>>2]=ee[0],_[n+44>>2]=ee[1],_[n+48>>2]=4096,_[n+52>>2]=r.blocks,_[n+56>>2]=r.atime.getTime()/1e3|0,_[n+60>>2]=0,_[n+64>>2]=r.mtime.getTime()/1e3|0,_[n+68>>2]=0,_[n+72>>2]=r.ctime.getTime()/1e3|0,_[n+76>>2]=0,ee=[r.ino>>>0,(Z=r.ino,+z(Z)>=1?Z>0?(0|q(+G(Z/4294967296),4294967295))>>>0:~~+V((Z-+(~~Z>>>0))/4294967296)>>>0:0)],_[n+80>>2]=ee[0],_[n+84>>2]=ee[1],0},doMsync:function(e,t,n,r,a){var o=w.slice(e,e+n);he.msync(t,o,a,n,r)},doMkdir:function(e,t){return"/"===(e=ue.normalize(e))[e.length-1]&&(e=e.substr(0,e.length-1)),he.mkdir(e,t,0),0},doMknod:function(e,t,n){switch(61440&t){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return he.mknod(e,t,n),0},doReadlink:function(e,t,n){if(n<=0)return-28;var r=he.readlink(e),a=Math.min(n,M(r)),o=b[t+a];return C(r,t,n+1),b[t+a]=o,a},doAccess:function(e,t){if(-8&t)return-28;var n;if(!(n=he.lookupPath(e,{follow:!0}).node))return-44;var r="";return 4&t&&(r+="r"),2&t&&(r+="w"),1&t&&(r+="x"),r&&he.nodePermissions(n,r)?-2:0},doDup:function(e,t,n){var r=he.getStream(n);return r&&he.close(r),he.open(e,t,0,n,n).fd},doReadv:function(e,t,n,r){for(var a=0,o=0;o<n;o++){var i=_[t+8*o>>2],s=_[t+(8*o+4)>>2],u=he.read(e,b,i,s,r);if(u<0)return-1;if(a+=u,u<s)break}return a},doWritev:function(e,t,n,r){for(var a=0,o=0;o<n;o++){var i=_[t+8*o>>2],s=_[t+(8*o+4)>>2],u=he.write(e,b,i,s,r);if(u<0)return-1;a+=u}return a},varargs:void 0,get:function(){return de.varargs+=4,_[de.varargs-4>>2]},getStr:function(e){return D(e)},getStreamFromFD:function(e){var t=he.getStream(e);if(!t)throw new he.ErrnoError(8);return t},get64:function(e,t){return e}},pe=z;function me(){return w.length}function ge(e){try{return l.grow(e-k.byteLength+65535>>16),T(l.buffer),1}catch(t){}}var ve={};function ye(){if(!ye.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"===typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:s||"./this.program"};for(var t in ve)e[t]=ve[t];var n=[];for(var t in e)n.push(t+"="+e[t]);ye.strings=n}return ye.strings}function ke(e){return e%4===0&&(e%100!==0||e%400===0)}function be(e,t){for(var n=0,r=0;r<=t;n+=e[r++]);return n}var we=[31,29,31,30,31,30,31,31,30,31,30,31],Ee=[31,28,31,30,31,30,31,31,30,31,30,31];function _e(e,t){for(var n=new Date(e.getTime());t>0;){var r=ke(n.getFullYear()),a=n.getMonth(),o=(r?we:Ee)[a];if(!(t>o-n.getDate()))return n.setDate(n.getDate()+t),n;t-=o-n.getDate()+1,n.setDate(1),a<11?n.setMonth(a+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1))}return n}function Se(e,t){Se.array||(Se.array=[]);var n,r=Se.array;for(r.length=0;n=w[e++];)100===n||102===n?(t=t+7&-8,r.push(P[t>>3]),t+=8):(t=t+3&-4,r.push(_[t>>2]),t+=4);return r}var Pe=function(e,t,n,r){e||(e=this),this.parent=e,this.mount=e.mount,this.mounted=null,this.id=he.nextInode++,this.name=t,this.mode=n,this.node_ops={},this.stream_ops={},this.rdev=r};function xe(e,t,n){var r=n>0?n:M(e)+1,a=new Array(r),o=I(e,a,0,a.length);return t&&(a.length=o),a}Object.defineProperties(Pe.prototype,{read:{get:function(){return 365===(365&this.mode)},set:function(e){e?this.mode|=365:this.mode&=-366}},write:{get:function(){return 146===(146&this.mode)},set:function(e){e?this.mode|=146:this.mode&=-147}},isFolder:{get:function(){return he.isDir(this.mode)}},isDevice:{get:function(){return he.isChrdev(this.mode)}}}),he.FSNode=Pe,he.staticInit();var Oe={a:function(e,t,n,r){J("Assertion failed: "+D(e)+", at: "+[t?D(t):"unknown filename",n,r?D(r):"unknown function"])},e:function(e){return je(e)},d:function(e,t,n){throw oe[e]={ptr:e,adjusted:[e],type:t,destructor:n,refcount:0,caught:!1,rethrown:!1},"uncaught_exception"in ie?ie.uncaught_exceptions++:ie.uncaught_exceptions=1,e},t:function(e,t){return se(63),-1},f:function(e,t,n){de.varargs=n;try{var r=de.getStreamFromFD(e);switch(t){case 0:return(a=de.get())<0?-28:he.open(r.path,r.flags,0,a).fd;case 1:case 2:return 0;case 3:return r.flags;case 4:var a=de.get();return r.flags|=a,0;case 12:return a=de.get(),E[a+0>>1]=2,0;case 13:case 14:return 0;case 16:case 8:return-28;case 9:return se(28),-1;default:return-28}}catch(o){return"undefined"!==typeof he&&o instanceof he.ErrnoError||J(o),-o.errno}},l:function(e,t,n){de.varargs=n;try{var r=de.getStr(e),a=de.get();return he.open(r,t,a).fd}catch(o){return"undefined"!==typeof he&&o instanceof he.ErrnoError||J(o),-o.errno}},k:function(e,t,n){de.varargs=n;try{var r=de.getStreamFromFD(e);switch(t){case 21509:case 21505:return r.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return r.tty?0:-59;case 21519:if(!r.tty)return-59;var a=de.get();return _[a>>2]=0,0;case 21520:return r.tty?-28:-59;case 21531:return a=de.get(),he.ioctl(r,t,a);case 21523:case 21524:return r.tty?0:-59;default:J("bad ioctl syscall "+t)}}catch(o){return"undefined"!==typeof he&&o instanceof he.ErrnoError||J(o),-o.errno}},s:function(e,t){try{return function(e,t){if(-1===e||0===t)return-28;var n=de.mappings[e];if(!n)return 0;if(t===n.len){var r=he.getStream(n.fd);de.doMsync(e,r,t,n.flags,n.offset),he.munmap(r),de.mappings[e]=null,n.allocated&&Me(n.malloc)}return 0}(e,t)}catch(n){return"undefined"!==typeof he&&n instanceof he.ErrnoError||J(n),-n.errno}},i:function(){J()},m:pe,c:function(e,t,n){var r=Se(t,n);return re[e].apply(null,r)},p:function(e,t,n){w.copyWithin(e,t,t+n)},q:function(e){var t=me();if(e>2147418112)return!1;for(var n,r,a=1;a<=4;a*=2){var o=t*(1+.2/a);if(o=Math.min(o,e+100663296),ge(Math.min(2147418112,((n=Math.max(16777216,e,o))%(r=65536)>0&&(n+=r-n%r),n))))return!0}return!1},u:function(e,t){var n=ye(),r=0;return n.forEach((function(n,a){var o=t+r;_[e+4*a>>2]=o,function(e,t,n){for(var r=0;r<e.length;++r)b[t++>>0]=e.charCodeAt(r);n||(b[t>>0]=0)}(n,o),r+=n.length+1})),0},v:function(e,t){var n=ye();_[e>>2]=n.length;var r=0;return n.forEach((function(e){r+=e.length+1})),_[t>>2]=r,0},h:function(e){try{var t=de.getStreamFromFD(e);return he.close(t),0}catch(n){return"undefined"!==typeof he&&n instanceof he.ErrnoError||J(n),n.errno}},j:function(e,t,n,r){try{var a=de.getStreamFromFD(e),o=de.doReadv(a,t,n);return _[r>>2]=o,0}catch(i){return"undefined"!==typeof he&&i instanceof he.ErrnoError||J(i),i.errno}},n:function(e,t,n,r,a){try{var o=de.getStreamFromFD(e),i=4294967296*n+(t>>>0);return i<=-9007199254740992||i>=9007199254740992?-61:(he.llseek(o,i,r),ee=[o.position>>>0,(Z=o.position,+z(Z)>=1?Z>0?(0|q(+G(Z/4294967296),4294967295))>>>0:~~+V((Z-+(~~Z>>>0))/4294967296)>>>0:0)],_[a>>2]=ee[0],_[a+4>>2]=ee[1],o.getdents&&0===i&&0===r&&(o.getdents=null),0)}catch(s){return"undefined"!==typeof he&&s instanceof he.ErrnoError||J(s),s.errno}},g:function(e,t,n,r){try{var a=de.getStreamFromFD(e),o=de.doWritev(a,t,n);return _[r>>2]=o,0}catch(i){return"undefined"!==typeof he&&i instanceof he.ErrnoError||J(i),i.errno}},memory:l,b:function(e){return(e=+e)>=0?+G(e+.5):+V(e-.5)},o:function(e){return(e=+e)>=0?+G(e+.5):+V(e-.5)},r:function(e,t,n,r){return function(e,t,n,r){var a=_[r+40>>2],o={tm_sec:_[r>>2],tm_min:_[r+4>>2],tm_hour:_[r+8>>2],tm_mday:_[r+12>>2],tm_mon:_[r+16>>2],tm_year:_[r+20>>2],tm_wday:_[r+24>>2],tm_yday:_[r+28>>2],tm_isdst:_[r+32>>2],tm_gmtoff:_[r+36>>2],tm_zone:a?D(a):""},i=D(n),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var u in s)i=i.replace(new RegExp(u,"g"),s[u]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function f(e,t,n){for(var r="number"===typeof e?e.toString():e||"";r.length<t;)r=n[0]+r;return r}function h(e,t){return f(e,t,"0")}function d(e,t){function n(e){return e<0?-1:e>0?1:0}var r;return 0===(r=n(e.getFullYear()-t.getFullYear()))&&0===(r=n(e.getMonth()-t.getMonth()))&&(r=n(e.getDate()-t.getDate())),r}function p(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function m(e){var t=_e(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),r=new Date(t.getFullYear()+1,0,4),a=p(n),o=p(r);return d(a,t)<=0?d(o,t)<=0?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var g={"%a":function(e){return c[e.tm_wday].substring(0,3)},"%A":function(e){return c[e.tm_wday]},"%b":function(e){return l[e.tm_mon].substring(0,3)},"%B":function(e){return l[e.tm_mon]},"%C":function(e){return h((e.tm_year+1900)/100|0,2)},"%d":function(e){return h(e.tm_mday,2)},"%e":function(e){return f(e.tm_mday,2," ")},"%g":function(e){return m(e).toString().substring(2)},"%G":function(e){return m(e)},"%H":function(e){return h(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),h(t,2)},"%j":function(e){return h(e.tm_mday+be(ke(e.tm_year+1900)?we:Ee,e.tm_mon-1),3)},"%m":function(e){return h(e.tm_mon+1,2)},"%M":function(e){return h(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return h(e.tm_sec,2)},"%t":function(){return"\t"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),n=0===t.getDay()?t:_e(t,7-t.getDay()),r=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(n,r)<0){var a=be(ke(r.getFullYear())?we:Ee,r.getMonth()-1)-31,o=31-n.getDate()+a+r.getDate();return h(Math.ceil(o/7),2)}return 0===d(n,t)?"01":"00"},"%V":function(e){var t,n=new Date(e.tm_year+1900,0,4),r=new Date(e.tm_year+1901,0,4),a=p(n),o=p(r),i=_e(new Date(e.tm_year+1900,0,1),e.tm_yday);return d(i,a)<0?"53":d(o,i)<=0?"01":(t=a.getFullYear()<e.tm_year+1900?e.tm_yday+32-a.getDate():e.tm_yday+1-a.getDate(),h(Math.ceil(t/7),2))},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),n=1===t.getDay()?t:_e(t,0===t.getDay()?1:7-t.getDay()+1),r=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(d(n,r)<0){var a=be(ke(r.getFullYear())?we:Ee,r.getMonth()-1)-31,o=31-n.getDate()+a+r.getDate();return h(Math.ceil(o/7),2)}return 0===d(n,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff,n=t>=0;return t=(t=Math.abs(t)/60)/60*100+t%60,(n?"+":"-")+String("0000"+t).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var u in g)i.indexOf(u)>=0&&(i=i.replace(new RegExp(u,"g"),g[u](o)));var v=xe(i,!1);return v.length>t?0:(j(v,e),v.length-1)}(e,t,n,r)},table:g},De=function(){var e={a:Oe};function t(e,t){var r=e.exports;n.asm=r,Y()}function r(e){t(e.instance)}function a(t){return(c||"function"!==typeof fetch?new Promise((function(e,t){e(ne())})):fetch(te,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+te+"'";return e.arrayBuffer()})).catch((function(){return ne()}))).then((function(t){return WebAssembly.instantiate(t,e)})).then(t,(function(e){h("failed to asynchronously prepare wasm: "+e),J(e)}))}if(Q(),n.instantiateWasm)try{return n.instantiateWasm(e,t)}catch(o){return h("Module.instantiateWasm callback failed with error: "+o),!1}return function(){if(c||"function"!==typeof WebAssembly.instantiateStreaming||X(te)||"function"!==typeof fetch)return a(r);fetch(te,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(r,(function(e){h("wasm streaming compile failed: "+e),h("falling back to ArrayBuffer instantiation"),a(r)}))}))}(),{}}();n.asm=De;var Ie,Ce=n.___wasm_call_ctors=function(){return(Ce=n.___wasm_call_ctors=n.asm.w).apply(null,arguments)},Me=n._free=function(){return(Me=n._free=n.asm.x).apply(null,arguments)},je=n._malloc=function(){return(je=n._malloc=n.asm.y).apply(null,arguments)},Te=(n._gme_open_data=function(){return(n._gme_open_data=n.asm.z).apply(null,arguments)},n._gme_delete=function(){return(n._gme_delete=n.asm.A).apply(null,arguments)},n._gme_track_count=function(){return(n._gme_track_count=n.asm.B).apply(null,arguments)},n._gme_track_info=function(){return(n._gme_track_info=n.asm.C).apply(null,arguments)},n._gme_start_track=function(){return(n._gme_start_track=n.asm.D).apply(null,arguments)},n._gme_play=function(){return(n._gme_play=n.asm.E).apply(null,arguments)},n._gme_set_fade=function(){return(n._gme_set_fade=n.asm.F).apply(null,arguments)},n._gme_track_ended=function(){return(n._gme_track_ended=n.asm.G).apply(null,arguments)},n._gme_tell_scaled=function(){return(n._gme_tell_scaled=n.asm.H).apply(null,arguments)},n._gme_seek_scaled=function(){return(n._gme_seek_scaled=n.asm.I).apply(null,arguments)},n._gme_voice_count=function(){return(n._gme_voice_count=n.asm.J).apply(null,arguments)},n._gme_ignore_silence=function(){return(n._gme_ignore_silence=n.asm.K).apply(null,arguments)},n._gme_set_tempo=function(){return(n._gme_set_tempo=n.asm.L).apply(null,arguments)},n._gme_mute_voices=function(){return(n._gme_mute_voices=n.asm.M).apply(null,arguments)},n._gme_voice_name=function(){return(n._gme_voice_name=n.asm.N).apply(null,arguments)},n._adl_init=function(){return(n._adl_init=n.asm.O).apply(null,arguments)},n._adl_setNumChips=function(){return(n._adl_setNumChips=n.asm.P).apply(null,arguments)},n._adl_getNumChips=function(){return(n._adl_getNumChips=n.asm.Q).apply(null,arguments)},n._adl_setBank=function(){return(n._adl_setBank=n.asm.R).apply(null,arguments)},n._adl_getBanksCount=function(){return(n._adl_getBanksCount=n.asm.S).apply(null,arguments)},n._adl_getBankNames=function(){return(n._adl_getBankNames=n.asm.T).apply(null,arguments)},n._adl_setSoftPanEnabled=function(){return(n._adl_setSoftPanEnabled=n.asm.U).apply(null,arguments)},n._adl_generate=function(){return(n._adl_generate=n.asm.V).apply(null,arguments)},n._adl_panic=function(){return(n._adl_panic=n.asm.W).apply(null,arguments)},n._adl_rt_resetState=function(){return(n._adl_rt_resetState=n.asm.X).apply(null,arguments)},n._adl_rt_noteOn=function(){return(n._adl_rt_noteOn=n.asm.Y).apply(null,arguments)},n._adl_rt_noteOff=function(){return(n._adl_rt_noteOff=n.asm.Z).apply(null,arguments)},n._adl_rt_channelAfterTouch=function(){return(n._adl_rt_channelAfterTouch=n.asm._).apply(null,arguments)},n._adl_rt_controllerChange=function(){return(n._adl_rt_controllerChange=n.asm.$).apply(null,arguments)},n._adl_rt_patchChange=function(){return(n._adl_rt_patchChange=n.asm.aa).apply(null,arguments)},n._adl_rt_pitchBend=function(){return(n._adl_rt_pitchBend=n.asm.ba).apply(null,arguments)},n._v2m_open=function(){return(n._v2m_open=n.asm.ca).apply(null,arguments)},n._v2m_write_audio=function(){return(n._v2m_write_audio=n.asm.da).apply(null,arguments)},n._v2m_get_position_ms=function(){return(n._v2m_get_position_ms=n.asm.ea).apply(null,arguments)},n._v2m_get_duration_ms=function(){return(n._v2m_get_duration_ms=n.asm.fa).apply(null,arguments)},n._v2m_seek_ms=function(){return(n._v2m_seek_ms=n.asm.ga).apply(null,arguments)},n._v2m_set_speed=function(){return(n._v2m_set_speed=n.asm.ha).apply(null,arguments)},n._v2m_close=function(){return(n._v2m_close=n.asm.ia).apply(null,arguments)},n._xmp_start_player=function(){return(n._xmp_start_player=n.asm.ja).apply(null,arguments)},n._xmp_end_player=function(){return(n._xmp_end_player=n.asm.ka).apply(null,arguments)},n._xmp_play_buffer=function(){return(n._xmp_play_buffer=n.asm.la).apply(null,arguments)},n._xmp_get_frame_info=function(){return(n._xmp_get_frame_info=n.asm.ma).apply(null,arguments)},n._xmp_get_module_info=function(){return(n._xmp_get_module_info=n.asm.na).apply(null,arguments)},n._xmp_create_context=function(){return(n._xmp_create_context=n.asm.oa).apply(null,arguments)},n._xmp_stop_module=function(){return(n._xmp_stop_module=n.asm.pa).apply(null,arguments)},n._xmp_restart_module=function(){return(n._xmp_restart_module=n.asm.qa).apply(null,arguments)},n._xmp_seek_time=function(){return(n._xmp_seek_time=n.asm.ra).apply(null,arguments)},n._xmp_channel_mute=function(){return(n._xmp_channel_mute=n.asm.sa).apply(null,arguments)},n._xmp_get_player=function(){return(n._xmp_get_player=n.asm.ta).apply(null,arguments)},n._xmp_get_format_list=function(){return(n._xmp_get_format_list=n.asm.ua).apply(null,arguments)},n._xmp_inject_event=function(){return(n._xmp_inject_event=n.asm.va).apply(null,arguments)},n._xmp_load_module_from_memory=function(){return(n._xmp_load_module_from_memory=n.asm.wa).apply(null,arguments)},n._new_fluid_settings=function(){return(n._new_fluid_settings=n.asm.xa).apply(null,arguments)},n._fluid_settings_setstr=function(){return(n._fluid_settings_setstr=n.asm.ya).apply(null,arguments)},n._fluid_settings_setnum=function(){return(n._fluid_settings_setnum=n.asm.za).apply(null,arguments)},n._fluid_settings_setint=function(){return(n._fluid_settings_setint=n.asm.Aa).apply(null,arguments)},n._new_fluid_synth=function(){return(n._new_fluid_synth=n.asm.Ba).apply(null,arguments)},n._fluid_synth_set_reverb=function(){return(n._fluid_synth_set_reverb=n.asm.Ca).apply(null,arguments)},n._fluid_synth_noteon=function(){return(n._fluid_synth_noteon=n.asm.Da).apply(null,arguments)},n._fluid_synth_noteoff=function(){return(n._fluid_synth_noteoff=n.asm.Ea).apply(null,arguments)},n._fluid_synth_all_notes_off=function(){return(n._fluid_synth_all_notes_off=n.asm.Fa).apply(null,arguments)},n._fluid_synth_all_sounds_off=function(){return(n._fluid_synth_all_sounds_off=n.asm.Ga).apply(null,arguments)},n._fluid_synth_write_float=function(){return(n._fluid_synth_write_float=n.asm.Ha).apply(null,arguments)},n._fluid_synth_sfload=function(){return(n._fluid_synth_sfload=n.asm.Ia).apply(null,arguments)},n._tp_note_on=function(){return(n._tp_note_on=n.asm.Ja).apply(null,arguments)},n._tp_note_off=function(){return(n._tp_note_off=n.asm.Ka).apply(null,arguments)},n._tp_program_change=function(){return(n._tp_program_change=n.asm.La).apply(null,arguments)},n._tp_pitch_bend=function(){return(n._tp_pitch_bend=n.asm.Ma).apply(null,arguments)},n._tp_control_change=function(){return(n._tp_control_change=n.asm.Na).apply(null,arguments)},n._tp_channel_pressure=function(){return(n._tp_channel_pressure=n.asm.Oa).apply(null,arguments)},n._tp_render=function(){return(n._tp_render=n.asm.Pa).apply(null,arguments)},n._tp_panic=function(){return(n._tp_panic=n.asm.Qa).apply(null,arguments)},n._tp_panic_channel=function(){return(n._tp_panic_channel=n.asm.Ra).apply(null,arguments)},n._tp_reset=function(){return(n._tp_reset=n.asm.Sa).apply(null,arguments)},n._tp_init=function(){return(n._tp_init=n.asm.Ta).apply(null,arguments)},n._tp_write_audio=function(){return(n._tp_write_audio=n.asm.Ua).apply(null,arguments)},n._tp_get_duration_ms=function(){return(n._tp_get_duration_ms=n.asm.Va).apply(null,arguments)},n._tp_seek=function(){return(n._tp_seek=n.asm.Wa).apply(null,arguments)},n._tp_get_position_ms=function(){return(n._tp_get_position_ms=n.asm.Xa).apply(null,arguments)},n._tp_set_speed=function(){return(n._tp_set_speed=n.asm.Ya).apply(null,arguments)},n._tp_stop=function(){return(n._tp_stop=n.asm.Za).apply(null,arguments)},n._tp_open=function(){return(n._tp_open=n.asm._a).apply(null,arguments)},n._tp_unload_soundfont=function(){return(n._tp_unload_soundfont=n.asm.$a).apply(null,arguments)},n._tp_load_soundfont=function(){return(n._tp_load_soundfont=n.asm.ab).apply(null,arguments)},n._tp_add_soundfont=function(){return(n._tp_add_soundfont=n.asm.bb).apply(null,arguments)},n._tp_set_reverb=function(){return(n._tp_set_reverb=n.asm.cb).apply(null,arguments)},n._tp_get_channel_in_use=function(){return(n._tp_get_channel_in_use=n.asm.db).apply(null,arguments)},n._tp_get_channel_program=function(){return(n._tp_get_channel_program=n.asm.eb).apply(null,arguments)},n._tp_set_channel_mute=function(){return(n._tp_set_channel_mute=n.asm.fb).apply(null,arguments)},n._tp_set_bank=function(){return(n._tp_set_bank=n.asm.gb).apply(null,arguments)},n._tp_set_synth_engine=function(){return(n._tp_set_synth_engine=n.asm.hb).apply(null,arguments)},n._cqt_init=function(){return(n._cqt_init=n.asm.ib).apply(null,arguments)},n._cqt_calc=function(){return(n._cqt_calc=n.asm.jb).apply(null,arguments)},n._cqt_render_line=function(){return(n._cqt_render_line=n.asm.kb).apply(null,arguments)},n._cqt_bin_to_freq=function(){return(n._cqt_bin_to_freq=n.asm.lb).apply(null,arguments)},n.___errno_location=function(){return(n.___errno_location=n.asm.mb).apply(null,arguments)},n.stackSave=function(){return(Te=n.stackSave=n.asm.nb).apply(null,arguments)}),Ae=n.stackAlloc=function(){return(Ae=n.stackAlloc=n.asm.ob).apply(null,arguments)},Fe=n.stackRestore=function(){return(Fe=n.stackRestore=n.asm.pb).apply(null,arguments)};function Ne(e){function t(){Ie||(Ie=!0,n.calledRun=!0,v||(n.noFSInit||he.init.initialized||he.init(),le.init(),N(L),he.ignorePermissions=!1,N(B),n.onRuntimeInitialized&&n.onRuntimeInitialized(),function(){if(n.postRun)for("function"==typeof n.postRun&&(n.postRun=[n.postRun]);n.postRun.length;)e=n.postRun.shift(),U.unshift(e);var e;N(U)}()))}e=e||i,K>0||(function(){if(n.preRun)for("function"==typeof n.preRun&&(n.preRun=[n.preRun]);n.preRun.length;)e=n.preRun.shift(),R.unshift(e);var e;N(R)}(),K>0||(n.setStatus?(n.setStatus("Running..."),setTimeout((function(){setTimeout((function(){n.setStatus("")}),1),t()}),1)):t()))}if(n.dynCall_vi=function(){return(n.dynCall_vi=n.asm.qb).apply(null,arguments)},n.dynCall_v=function(){return(n.dynCall_v=n.asm.rb).apply(null,arguments)},n.asm=De,n.ccall=function(e,t,r,a,o){var i={string:function(e){var t=0;if(null!==e&&void 0!==e&&0!==e){var n=1+(e.length<<2);C(e,t=Ae(n),n)}return t},array:function(e){var t=Ae(e.length);return j(e,t),t}},s=function(e){var t=n["_"+e];return y(t,"Cannot call unknown function "+e+", make sure it is exported"),t}(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var f=i[r[l]];f?(0===c&&(c=Te()),u[l]=f(a[l])):u[l]=a[l]}var h=s.apply(null,u);return h=function(e){return"string"===t?D(e):"boolean"===t?Boolean(e):e}(h),0!==c&&Fe(c),h},n.setValue=m,n.getValue=function(e,t,n){switch("*"===(t=t||"i8").charAt(t.length-1)&&(t="i32"),t){case"i1":case"i8":return b[e>>0];case"i16":return E[e>>1];case"i32":case"i64":return _[e>>2];case"float":return S[e>>2];case"double":return P[e>>3];default:J("invalid type for getValue: "+t)}return null},n.allocate=function(e,t,n,r){var a,o;"number"===typeof e?(a=!0,o=e):(a=!1,o=e.length);var i,s="string"===typeof t?t:null;if(i=3==n?r:[je,Ae,d][n](Math.max(o,s?1:t.length)),a){var u;for(r=i,y(0==(3&i)),u=i+(-4&o);r<u;r+=4)_[r>>2]=0;for(u=i+o;r<u;)b[r++>>0]=0;return i}if("i8"===s)return e.subarray||e.slice?w.set(e,i):w.set(new Uint8Array(e),i),i;for(var c,l,f,h=0;h<o;){var g=e[h];0!==(c=s||t[h])?("i64"==c&&(c="i32"),m(i+h,g,c),f!==c&&(l=p(c),f=c),h+=l):h++}return i},n.UTF8ToString=D,n.FS=he,n.ALLOC_NORMAL=0,n.then=function(e){if(Ie)e(n);else{var t=n.onRuntimeInitialized;n.onRuntimeInitialized=function(){t&&t(),e(n)}}return n},H=function e(){Ie||Ne(),Ie||(H=e)},n.run=Ne,n.preInit)for("function"==typeof n.preInit&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Ne(),e}),O=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"init",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){try{t.chipCore=new x({locateFile:function(e,t){return e.endsWith(".wasm")||e.endsWith(".wast")?"".concat(".","/").concat(e):t+e},onRuntimeInitialized:function(t){console.log("onRuntimeInitialized",t),e()}})}catch(r){throw r}}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadPlayerFromBuffer",value:function(e,t,n,r){var a,o=this;a=new Uint8Array(n);var i=new P(e,t,this.chipCore,(function(e){return o.onPlayerStateUpdate(e)}));try{i.loadData(a,r)}catch(u){throw u}var s=i.getNumVoices();return i.setTempo(1),i.setVoices(Object(h.a)(Array(s)).fill(!0)),i.stop(),i}},{key:"onPlayerStateUpdate",value:function(e){console.log(e)}},{key:"loadSongDataFromBuffer",value:function(e,t){var n=new AudioContext,r=this.loadPlayerFromBuffer(n,n.destination,e,t);return this.loadSongDataFromPlayer(r,t)}},{key:"loadSongDataFromPlayer",value:function(e,t){var n=e.metadata;console.log("metadata",n);var r=2*n.length*96;return{title:n.title,game:n.game,system:n.system,artist:n.artist,copyright:n.copyright,version:"auto",created:(new Date).getTime(),timeDivision:96,beatsPerMinute:120,rootGroup:"root",programs:[{className:"GMEPlayerSynthesizer",fileURL:t}],instructions:{root:[["C4",0,r]]}}}},{key:"loadSongDataFromURL",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s,u=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u.length>1&&void 0!==u[1]?u[1]:{},e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.arrayBuffer();case 6:return r=e.sent,o=new AudioContext,i=this.loadPlayerFromBuffer(o,o.destination,r,t),s=this.loadSongDataFromPlayer(i,t),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),D=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"loadSongDataFromFileInput",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.readAsText(t),r.onload=function(t){e(t.target.result)}}));case 2:return n=e.sent,e.abrupt("return",JSON.parse(n));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSongDataFromURL",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,fetch(t);case 3:return n=e.sent,e.next=6,n.json();case 6:return r=e.sent,e.abrupt("return",r);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),I={},C={},M=["udp://explodie.org:6969","udp://track.coppersurfer.tk:6969","udp://track.empire-js.us:1337","udp://track.leechers-paradise.org:6969","udp://track.opentrackr.org:1337","wss://track.fastcast.nz","wss://track.openwebtorrent.com","wss://track.btorrent.xyz"];function j(){return T.apply(this,arguments)}function T(){return(T=Object(o.a)(a.a.mark((function e(){var t,n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=customElements.get("audio-source-loader"),n="node_modules/webtorrent/webtorrent.min.js",(r=t.findScript(n,!1))||(window.exports={},window.module={exports:window.exports},(r=document.createElement("script")).promises=(r.promises||[]).concat(new Promise(function(){var e=Object(o.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.onload=function(e){r.exports=window.module.exports,delete window.module,delete window.exports,t()},document.head.appendChild(r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()))),i=0;case 5:if(!(i<r.promises.length)){e.next=11;break}return e.next=8,r.promises[i];case 8:i++,e.next=5;break;case 11:return e.abrupt("return",r.exports||function(){throw new Error("Script module has no exports: "+n)}());case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"log",value:function(e){console.info(e)}},{key:"loadBufferFromURL",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.toString().startsWith("torrent://")){e.next=7;break}return console.time("getFileBufferFromTorrent"),e.next=4,this.getFileBufferFromTorrent(t);case 4:return n=e.sent,console.timeEnd("getFileBufferFromTorrent"),e.abrupt("return",n);case 7:return e.next=9,fetch(t);case 9:return r=e.sent,e.next=12,r.arrayBuffer();case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMagnetURL",value:function(e){return"magnet:?xt=urn:btih:".concat(e,"&dn=torrent&").concat(M.map((function(e){return"tr="+e})).join("&"))}},{key:"getFileBufferFromTorrent",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,i,s,u,c,l,f,h,d,p;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=function(){return(p=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){t.getBuffer(function(){var t=Object(o.a)(a.a.mark((function t(n,r){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=2;break}throw new Error(n);case 2:e(r);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)},d=function(e){return p.apply(this,arguments)},n=t.match(/^(torrent?:)\/\/(([^:/?#]*)(?::([0-9]+))?)([/]{0,1}[^?#]*)(\?[^#]*|)(#.*|)$/),r=n&&{hostname:n[3],pathname:n[5]},i=r.hostname,s=r.pathname.substr(1),e.next=8,this.getTorrent(i);case 8:u=e.sent,c=0;case 10:if(!(c<u.files.length)){e.next=30;break}if(l=u.files[c],s!==l.path){e.next=16;break}return e.next=15,d(l);case 15:return e.abrupt("return",e.sent);case 16:if(!s.startsWith(l.path)){e.next=27;break}if(f=s.substr(l.path.length),h=void 0,"undefined"!==typeof I[l.path]?h=I[l.path]:(h=d(l),I[l.path]=h),!(h instanceof Promise)){e.next=24;break}return e.next=23,h;case 23:h=e.sent;case 24:return e.next=26,this.getFileBufferFromArchive(h,f);case 26:return e.abrupt("return",e.sent);case 27:c++,e.next=10;break;case 30:throw new Error("Archive file not found: "+s);case 31:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFileBufferFromArchive",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n){var r,o,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decompress7ZipArchive(t);case 2:r=e.sent,o=0;case 4:if(!(o<r.length)){e.next=11;break}if((i=r[o]).path!==n){e.next=8;break}return e.abrupt("return",i.data);case 8:o++,e.next=4;break;case 11:throw new Error("Archive file not found: "+n);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getTorrent",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j();case 2:if(n=e.sent,!C[t]){e.next=8;break}if(!(C[t]instanceof Promise)){e.next=7;break}return e.next=7,C[t];case 7:return e.abrupt("return",C[t]);case 8:return r=this.getMagnetURL(t),o=new n,C[t]=new Promise((function(e,t){s.log("Connecting to cloud url: "+r),o.add(r,(function(t){e(t)}))})),e.next=13,C[t];case 13:return C[t]=e.sent,i=C[t],this.log("Connected to cloud: "+i.infoHash),e.abrupt("return",i);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decompress7ZipArchive",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 268435456,r=!1,"/data","archive.7z",(n=[]).push(new(s=function(e,t,n){this.path=e,this.isdir=t,this.data=n})("/data",!0,null)),o=new Uint8Array(t),n.push(new s("/data/archive.7z",!1,o)),"assets/3rdparty/7zip/js/worker.7z.wrapper.js",i=new Worker("assets/3rdparty/7zip/js/worker.7z.wrapper.js"),e.next=13,new Promise((function(e,t){i.onerror=console.error,i.onmessage=function(t){if(r)return i.terminate(),i=void 0,void(r=!1);1===t.data.type||2===t.data.type||3===t.data.type&&(e(t.data.results),i.terminate())};var a=[n[0],n[1]],o=["x",a[1].path,"-o/result"];i.postMessage({id:1,action:"doit",arguments:o,totalMemory:268435456,FilesDataArray:a})}));case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),F=Symbol("proxy_target"),N=Symbol("proxy_listener"),R=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Object(s.a)(this,e),this.path=n,this.song=t,this.updateTimeout=null,this.changeListeners=[]}return Object(u.a)(e,[{key:"addChangeListener",value:function(e){this.changeListeners(e)}},{key:"removeChangeListener",value:function(e){var t=this.changeListeners.indexOf(e);-1!==t&&this.changeListeners.splice(t)}},{key:"get",value:function(t,n){var r=this;switch(n){case F:return t;case N:return this;case"indexOf":return function(e,n,r){return t.indexOf(e,n,r)};case"splice":return function(e,n){for(var a=arguments.length,o=new Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];return r.splice.apply(r,[t,r.path.concat(e),e,n].concat(o))};default:var a=this.path.concat(n);return"object"===typeof t[n]?new Proxy(t[n],new e(this.song,a)):t[n]}}},{key:"set",value:function(e,t,n){return e[t]=n,this.queueChange("set",this.path.concat(t),n),!0}},{key:"deleteProperty",value:function(e,t){return t in e&&(delete e[t],this.queueChange("delete",this.path.concat(t))),!0}},{key:"queueChange",value:function(e,t){this.song.queueHistoryAction(e,t);for(var n=0;n<this.changeListeners.length;n++)this.changeListeners[n](e,t)}},{key:"splice",value:function(e,t,n,r){if(!Array.isArray(e))throw new Error("Splice may only be used in array objects for path: ".concat(t.join(".")));for(var a=arguments.length,o=new Array(a>4?a-4:0),i=4;i<a;i++)o[i-4]=arguments[i];e.splice.apply(e,[n,r].concat(o)),this.queueChange.apply(this,["splice",t,n,r].concat(o))}}],[{key:"resolveProxiedObject",value:function(e){return e[F]||e}},{key:"addChangeListener",value:function(e,t){e[N].addChangeListener(t)}}]),e}();R.TARGET=F,R.LISTENER=N;var L=n(15),B=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(s.a)(this,e),this.config=t,this.audioContext=n,this.audioBuffer=null,this.loadAudioBuffer()}return Object(u.a)(e,[{key:"loadAudioBuffer",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(this.config.url);case 2:return t=e.sent,e.next=5,t.arrayBuffer();case 5:n=e.sent,this.audioBuffer=this.audioContext.decodeAudioData(n);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playFrequency",value:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=e.context.createGain();i.gain.value=parseFloat(a||127)/127,i.connect(e);var s=(e=i).context.createBufferSource();s.buffer=this.audioBuffer,"undefined"!==typeof this.config.loop&&(s.loop=!!this.config.loop);var u=t/(this.config.root?this.getCommandFrequency(this.config.root):440);return s.playbackRate.value=u,"undefined"!==typeof this.config.detune&&(s.detune.value=this.config.detune),s.connect(e),s.start(n),s.stop(n+r),o&&(s.onended=o),s}}]),e}(),U=n(0),z=n.n(U),V=n(1),G=(n(138),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={open:!1},n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"getSong",value:function(){return this.props.song}},{key:"getSampleID",value:function(){return this.props.sampleID}},{key:"getInstrumentID",value:function(){return this.props.instrumentID}},{key:"getSampleData",value:function(){return this.props.sampleData}},{key:"render",value:function(){var e=this,t=this.getSampleData(),n=t.url.replace(/\.(wav|mp3)$/,""),r="audiobuffer-instrument-renderer";return this.state.open&&(r+=" open"),z.a.createElement(V.c,{className:r},z.a.createElement(V.a,{title:"Change Sample",className:"name",onAction:function(t){return e.toggleOpen(t)}},n||"Unnamed"),this.state.open?z.a.createElement(z.a.Fragment,null,"undefined"===typeof t.mixer?null:z.a.createElement(V.c,{title:"Edit Mixer",className:"mixer"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuChangeMixer(t)},vertical:!0,openOnHover:!1},t.mixer+"%")),"undefined"===typeof t.detune?null:z.a.createElement(V.c,{title:"Detune by ".concat(t.detune," cents"),className:"detune"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuChangeDetune(t)},vertical:!0,openOnHover:!1},t.detune+"c")),"undefined"===typeof t.root?null:z.a.createElement(V.c,{title:"Key Root is ".concat(t.root),className:"root"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuChangeKeyRoot(t)},vertical:!0,openOnHover:!1},t.root)),"undefined"===typeof t.alias?null:z.a.createElement(V.c,{title:"Key Alias is ".concat(t.alias),className:"alias"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuChangeKeyAlias(t)},vertical:!0,openOnHover:!1},t.alias)),"undefined"===typeof t.range?null:z.a.createElement(V.c,{title:"Key Range is ".concat(t.range),className:"range"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuChangeKeyRange(t)},vertical:!0,openOnHover:!1},t.range)),"undefined"===typeof t.loop?null:z.a.createElement(V.c,{title:"Toggle Loop",className:"loop"},z.a.createElement(V.a,{title:"",onAction:function(n){return e.changeLoop(!t.loop)},arrow:!1,vertical:!0,openOnHover:!1},t.loop?"\u221e":"\u21e5"))):null,z.a.createElement(V.c,{title:"Edit Sample '".concat(n,"'"),className:"config"},z.a.createElement(V.a,{onAction:function(t){return e.openMenuRoot(t)},vertical:!0,openOnHover:!1},z.a.createElement(V.e,{source:"config"}))))}},{key:"openMenu",value:function(e,t){if("function"!==typeof this.props.openMenu)throw new Error("Invalid 'openMenu' props");this.props.openMenu(e,t)}},{key:"openMenuRoot",value:function(e){var t=this;this.openMenu(e,z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:function(){},disabled:!0},"Sample ",this.props.sampleID),z.a.createElement(V.h,null),z.a.createElement(V.i,{key:"mixer",onAction:function(e){return t.openMenuChangeMixer(e)}},"Edit Mixer"),z.a.createElement(V.i,{key:"detune",onAction:function(e){return t.openMenuChangeDetune(e)}},"Edit Detune"),z.a.createElement(V.i,{key:"root",onAction:function(e){return t.openMenuChangeKeyRoot(e)}},"Edit Key Root"),z.a.createElement(V.i,{key:"alias",onAction:function(e){return t.openMenuChangeKeyAlias(e)}},"Edit Key Alias"),z.a.createElement(V.i,{key:"range",onAction:function(e){return t.openMenuChangeKeyRange(e)}},"Edit Key Range"),z.a.createElement(V.i,{key:"loop",onAction:function(e){return t.openMenuChangeLoop(e)}},"Toggle Loop"),z.a.createElement(V.h,null),z.a.createElement(V.i,{key:"change",onAction:function(e){return t.openMenuChangeSample(e)}},"Change Sample"),z.a.createElement(V.g,{key:"remove",onAction:function(e){return t.renderMenu("voice-remove")}},"Remove Sample")))}},{key:"openMenuChangeSample",value:function(e){var t=this.getSampleData();this.openMenu(e,z.a.createElement(V.f,{min:0,max:100,value:t.mixer}))}},{key:"openMenuChangeMixer",value:function(e){var t=this,n=this.getSampleData();this.openMenu(e,z.a.createElement(V.f,{min:0,max:100,value:"undefined"!==typeof n.mixer?n.mixer:100,onChange:function(e,n){return t.changeMixer(n)}}))}},{key:"openMenuChangeDetune",value:function(e){var t=this,n=this.getSampleData();this.openMenu(e,z.a.createElement(V.f,{min:-1e3,max:1e3,value:"undefined"!==typeof n.detune?n.detune:100,onChange:function(e,n){return t.changeDetune(n)}}))}},{key:"openMenuChangeKeyRoot",value:function(e){var t=this,n=this.getSong().values;this.openMenu(e,z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Key Root"),z.a.createElement(V.h,null),n.getNoteOctaves((function(e){return z.a.createElement(V.i,{onAction:function(r){return t.openMenu(r,n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return t.changeRoot(n+e)}},n+e)})))}},e)}))))}},{key:"openMenuChangeKeyAlias",value:function(e){var t=this,n=this.getSong().values;this.openMenu(e,z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Key Root"),z.a.createElement(V.h,null),n.getNoteOctaves((function(e){return z.a.createElement(V.i,{onAction:function(r){return t.openMenu(r,n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return t.changeAlias(n+e)}},n+e)})))}},e)}))))}},{key:"openMenuChangeKeyRange",value:function(e){this.openMenu(e)}},{key:"openMenuChangeLoop",value:function(e){this.openMenu(e)}},{key:"renderMenu",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=this.getSong().values;switch(t){case"voice-loop":case"voice-remove":case null:return;case"voice-change":return z.a.createElement(z.a.Fragment,null);case"voice-mixer":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.h,null),z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Mixer"));case"voice-detune":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.h,null),z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Detune"));case"voice-root":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Key Root"),z.a.createElement(V.h,null),n.getNoteOctaves((function(t){return z.a.createElement(V.g,{onAction:function(){return n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return e.changeRoot(n+t)}},n+t)}))}},t)})));case"voice-alias":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Key Alias"),z.a.createElement(V.h,null),n.getNoteOctaves((function(t){return z.a.createElement(V.g,{onAction:function(){return n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return e.changeAlias(n+t)}},n+t)}))}},t)})));case"voice-range":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Edit Key Range"),z.a.createElement(V.h,null),z.a.createElement(V.g,{onAction:function(t){return e.renderMenu("voice-range-start")}},"Set Range Start"),z.a.createElement(V.g,{onAction:function(t){return e.renderMenu("voice-range-end")}},"Set Range End"));case"voice-range-start":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Range Start"),z.a.createElement(V.h,null),n.getNoteOctaves((function(t){return z.a.createElement(V.g,{onAction:function(){return n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return e.changeRange(n+t)}},n+t)}))}},t)})));case"voice-range-end":return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:null,disabled:!0},"Range End"),z.a.createElement(V.h,null),n.getNoteOctaves((function(t){return z.a.createElement(V.g,{onAction:function(){return n.getNoteFrequencies((function(n){return z.a.createElement(V.g,{onAction:function(r){return e.changeRange(null,n+t)}},n+t)}))}},t)})));default:throw new Error("Unknown menu key: "+t)}}},{key:"toggleOpen",value:function(e){this.setState({open:!this.state.open})}},{key:"changeMixer",value:function(e){if(!Number.isInteger(e))throw new Error("Invalid mixer value type: "+typeof e);this.config.samples[this.getSampleID()].mixer=e}},{key:"changeDetune",value:function(e){if(!Number.isInteger(e))throw new Error("Invalid detune value type: "+typeof e);this.config.samples[this.getSampleID()].detune=e}},{key:"changeRoot",value:function(e){this.config.samples[this.getSampleID()].root=e}},{key:"changeAlias",value:function(e){this.config.samples[this.getSampleID()].alias=e}},{key:"changeLoop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=!this.getSampleData().loop),this.config.samples[this.getSampleID()].loop=e?1:0}}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(g.a)(t,e),t}(z.a.Component))),q=function(){function e(t){Object(s.a)(this,e),this.audioContext=t}return Object(u.a)(e,[{key:"isPeriodicWaveAvailable",value:function(t){return!!e.waveURLCache[t]}},{key:"getCachedPeriodicWaveFromURL",value:function(t){return e.waveURLCache[t]}},{key:"loadPeriodicWaveFromURL",value:function(){var t=Object(o.a)(a.a.mark((function t(n){var r,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.waveURLCache[n]){t.next=2;break}return t.abrupt("return",e.waveURLCache[n]);case 2:return t.next=4,fetch(n);case 4:return r=t.sent,t.next=7,r.json();case 7:if((o=t.sent).real){t.next=10;break}throw new Error("Invalid 'real' data for createPeriodicWave");case 10:if(o.imag){t.next=12;break}throw new Error("Invalid 'imag' data for createPeriodicWave");case 12:return t.abrupt("return",e.waveURLCache[n]=this.audioContext.createPeriodicWave(new Float32Array(o.real),new Float32Array(o.imag)));case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),e}();q.waveURLCache={};var K=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.config=t}return Object(u.a)(e,[{key:"useDestination",value:function(e){return null}},{key:"playFrequency",value:function(t,n,r,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=t.context,u=new q(s);if(null!==o){var c=t.context.createGain();c.gain.value=parseFloat(o||127)/127,c.connect(t),t=c}var l=t.context.createOscillator();switch(l.frequency.value=n,"undefined"!==typeof this.config.detune&&(l.detune.value=this.config.detune),this.config.type){default:l.type=this.config.type;break;case"custom":if(!this.config.url)throw new Error("Custom osc requires a url");u.isPeriodicWaveAvailable(this.config.url)?l.setPeriodicWave(u.getCachedPeriodicWaveFromURL(this.config.url)):u.loadPeriodicWaveFromURL(this.config.url).then((function(e){return l.setPeriodicWave(e)}))}l.connect(t),l.start(r),l.stop(r+a),e.playingOSCs.push(l),l.onended=function(){var t=e.playingOSCs.indexOf(l);-1!==t&&e.playingOSCs.splice(t,1),i&&i()}}}],[{key:"stopPlayback",value:function(){for(var e=0;e<this.playingOSCs.length;e++)try{this.playingOSCs[e].stop()}catch(t){console.warn(t)}this.playingOSCs=[]}},{key:"unloadAll",value:function(){this.waveURLCache={}}}]),e}();K.playingOSCs=[],K.waveURLCache={};var W=K,H=(n(139),n(38)),Q=n(11),Y=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t="instrument-renderer-oscillator-node";this.state.open&&(t+=" open");var n=this.getTitle();return z.a.createElement("div",{className:t},z.a.createElement("div",{className:"title",title:"Oscillator: ".concat(n),onClick:this.cb.onClick},n),this.renderParameters(),z.a.createElement(V.i,{arrow:!1,className:"config",options:function(){return e.renderMenuRoot()}},z.a.createElement(V.e,{source:"config"})))}}]),t}(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={open:!1},n.cb={onClick:function(e){return n.toggleOpen()}},n.library=H.a.loadDefault(),n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentDidUpdate",value:function(e,t,n){this.props.config.type||(console.warn("No default oscillator type was set. Setting to 'sawtooth'"),this.props.config.type="sawtooth")}},{key:"getTitle",value:function(){return this.props.config.title||this.props.config.type||"Unknown Osc"}},{key:"renderParameters",value:function(){var e=this;if(!this.state.open)return[];var t=this.props.config;return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.i,{title:"Edit Mixer",className:"mixer",options:function(){return e.renderMenuChangeMixer()},arrow:!1,vertical:!0},"undefined"!==typeof t.mixer?t.mixer+"%":"100%"),z.a.createElement(V.i,{title:"Detune by ".concat(t.detune," cents"),className:"detune",options:function(){return e.renderMenuChangeDetune()},arrow:!1,vertical:!0},"undefined"!==typeof t.detune?t.detune+"c":"0c"),t.root?z.a.createElement(V.i,{title:"Key Root is ".concat(t.root),className:"root",options:function(){return e.renderMenuChangeKeyRoot()},arrow:!1,vertical:!0},t.root?t.root:"-"):null,t.alias?z.a.createElement(V.i,{title:"Key Alias is ".concat(t.alias),className:"alias",options:function(){return e.renderMenuChangeKeyAlias()},arrow:!1,vertical:!0},t.alias?t.alias:"-"):null,t.range?z.a.createElement(V.i,{title:"Key Range is ".concat(t.range),className:"range",options:function(){return e.renderMenuChangeKeyRange()},arrow:!1,vertical:!0},t.range?t.range:"-"):null,z.a.createElement(V.g,{className:"loop",title:"Toggle Loop",onAction:function(n){return e.changeLoop(!t.loop)},arrow:!1,vertical:!0},t.loop?"\u221e":"1"))}},{key:"toggleOpen",value:function(){this.setState({open:!this.state.open})}},{key:"changeMixer",value:function(e){if(!Number.isInteger(e))throw new Error("Invalid mixer value type: "+typeof e);this.props.config.mixer=e}},{key:"changeDetune",value:function(e){if(!Number.isInteger(e))throw new Error("Invalid detune value type: "+typeof e);this.props.config.detune=e}},{key:"changeRoot",value:function(e){this.props.config.root=e}},{key:"changeAlias",value:function(e){this.props.config.alias=e}},{key:"changeOscillator",value:function(e){"custom"===e||(delete this.props.config.url,delete this.props.config.real,delete this.props.config.imag,delete this.props.config.title,this.props.config.type=e)}},{key:"changeLoop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===e&&(e=!this.props.config.loop),this.props.config.loop=e?1:0}},{key:"loadPreset",value:function(e){console.log("Loading preset: ",e),e.type="custom",Object.assign(this.props.config,e)}},{key:"renderMenuRoot",value:function(){var e=this;return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:function(){},disabled:!0},"Oscillator: ",this.getTitle()),z.a.createElement(V.h,null),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeOscillator()}},"Change Oscillator"),z.a.createElement(V.h,null),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeMixer()}},"Edit Mixer"),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeDetune()}},"Edit Detune"),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeKeyRoot()}},"Edit Key Root"),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeKeyAlias()}},"Edit Key Alias"),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeKeyRange()}},"Edit Key Range"),z.a.createElement(V.i,{options:function(){return e.renderMenuChangeLoop()}},"Toggle Loop"),z.a.createElement(V.g,{disabled:!this.props.onRemove,onAction:function(t){return e.props.onRemove(e.props.instrumentID)}},"Remove Oscillator"))}},{key:"renderMenuChangeOscillator",value:function(){var e=this;return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.i,{options:function(){return e.renderMenuChangeOscillatorStandard()}},"Standard"),z.a.createElement(V.h,null),this.library.renderMenuProgramAllPresets((function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];e.loadPreset(r,a)})))}},{key:"renderMenuChangeOscillatorStandard",value:function(){var e=this;return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{onAction:function(t){return e.changeOscillator("sine")}},"Sine"),z.a.createElement(V.g,{onAction:function(t){return e.changeOscillator("square")}},"Square"),z.a.createElement(V.g,{onAction:function(t){return e.changeOscillator("sawtooth")}},"Sawtooth"),z.a.createElement(V.g,{onAction:function(t){return e.changeOscillator("triangle")}},"Triangle"))}},{key:"renderMenuChangeMixer",value:function(){var e=this,t=this.props.config;return z.a.createElement(V.f,{min:0,max:100,value:"undefined"!==typeof t.mixer?t.mixer:100,onChange:function(t,n){return e.changeMixer(n)}})}},{key:"renderMenuChangeDetune",value:function(){var e=this,t=this.props.config;return z.a.createElement(V.f,{min:-1e3,max:1e3,value:"undefined"!==typeof t.detune?t.detune:100,onChange:function(t,n){return e.changeDetune(n)}})}},{key:"renderMenuChangeKeyRoot",value:function(){var e=this;return Q.a.renderMenuSelectCommand((function(t){e.changeRoot(t)}))}},{key:"renderMenuChangeKeyAlias",value:function(){var e=this;return Q.a.renderMenuSelectCommand((function(t){e.changeAlias(t)}))}},{key:"renderMenuChangeKeyRange",value:function(){return z.a.createElement(z.a.Fragment,null,"TODO")}},{key:"renderMenuChangeLoop",value:function(){return z.a.createElement(z.a.Fragment,null,"TODO")}}]),t}(z.a.Component)),J=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.config=t}return Object(u.a)(e,[{key:"loadVoice",value:function(e){if(!this.config.voices[e])throw new Error("Voice config is missing: "+e);var t=Object(i.a)(this.config.voices[e],2),n=t[0],r=t[1];return new(0,c.a.getProgramClassInfo(n).classProgram)(r)}},{key:"playFrequency",value:function(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=0;i<this.config.voices.length;i++){var s=this.loadVoice(i);s.playFrequency(e,t,n,r,a,o)}}},{key:"stopPlayback",value:function(){for(var e=0;e<this.config.voices.length;e++)try{this.loadVoice(e).stopPlayback()}catch(t){console.warn(t)}}},{key:"unloadAll",value:function(){}}]),e}(),X=(n(141),n(13)),$=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).cb={onRemove:function(e){return n.removeVoice(e)},onAction:function(e){return n.addVoice()}},n}return Object(g.a)(t,e),Object(u.a)(t,[{key:"setStatus",value:function(e){console.info(this.constructor.name,"setStatus",e)}},{key:"setError",value:function(e){console.error(this.constructor.name,"setStatus",e)}},{key:"wrapVoiceWithNewInstrument",value:function(e){}},{key:"addVoice",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s,u=arguments;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(u.length>1&&void 0!==u[1])||u[1],t){e.next=3;break}throw new Error("Invalid voice instrument class");case 3:if(r=c.a.getProgramClassInfo(t),o=r.title,i={},e.t0=!1===n,e.t0){e.next=10;break}return e.next=9,X.a.openConfirmDialog("Add voice class '".concat(o,"' to Instrument?"));case 9:e.t0=e.sent;case 10:if(!e.t0){e.next=16;break}s=this.props.config.voices.length,this.props.config.voices[s]=[t,i],this.setStatus("Instrument '".concat(t,"' added as voice ").concat(s)),e.next=17;break;case 16:this.setError("New voice canceled: ".concat(t));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renameVoice",value:function(e,t){}},{key:"removeVoice",value:function(e){var t=this.props.config.voices;if("undefined"===typeof t[e])throw new Error("Voice ID not found: "+e);t.splice(e,1)}},{key:"renderMenuAddVoice",value:function(){var e=this,t=H.a.loadDefault();return z.a.createElement(z.a.Fragment,null,z.a.createElement(V.g,{disabled:!0,action:function(){}},"Add new voice instrument"),z.a.createElement(V.h,null),t.songLengthAllPresets((function(t){var n=Object(i.a)(t,2),r=n[0],a=n[1];e.addVoice(r,a)})))}}]),t}(z.a.Component),Z=n(61),ee=function(e){function t(){return Object(s.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.config.voices;return z.a.createElement("div",{className:"polyphony-instrument-renderer"},z.a.createElement("div",{className:"voices"},t.map((function(t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1],s=Z.a.getProgramClassInfo(a).classRenderer;return z.a.createElement(s,{onRemove:e.cb.onRemove,key:n,instrumentID:n,config:o})}))),z.a.createElement(V.b,{title:"Add new voice",className:"add-voice",arrow:!1,options:function(){return e.renderMenuAddVoice()}},"+"))}}]),t}($),te=null,ne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.config=t,null===te&&(te=new O).init()}return Object(u.a)(e,[{key:"connect",value:function(e){}},{key:"loadBuffer",value:function(){var e=Object(o.a)(a.a.mark((function e(){var t,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.fileBuffer||(t=this.config.fileURL,n=new A,this.fileBuffer=n.loadBufferFromURL(t),console.info("SPC ASPlayer loaded")),!(this.fileBuffer instanceof Promise)){e.next=5;break}return e.next=4,this.spcBuffer;case 4:this.spcBuffer=e.sent;case 5:return e.abrupt("return",this.fileBuffer);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadGMEPlayer",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadBuffer();case 2:return n=e.sent,e.abrupt("return",te.loadPlayerFromBuffer(t.context,t,n,"file",{destination:t}));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioContext=t,!this.config.fileURL){e.next=4;break}return e.next=4,this.loadBuffer();case 4:console.info("SPC ASPlayer initialized");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"play",value:function(){var e=Object(o.a)(a.a.mark((function e(t,n,r,o,i){var s,u,c,l,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadGMEPlayer(t);case 2:if(s=e.sent,this.spcPlayers.push(s),u=t.context.currentTime,!((r=null!==r?r:u)>u)){e.next=10;break}return c=r-u,e.next=10,new Promise((function(e,t){return setTimeout(e,1e3*c)}));case 10:if(r<u&&(l=1e3*(u-r),s.seekPlaybackPosition(l)),s.play(t),!o){e.next=17;break}return f=r+o-t.context.currentTime,e.next=16,new Promise((function(e,t){return setTimeout(e,1e3*f)}));case 16:s.pause();case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}()},{key:"stopPlayback",value:function(){for(var e=0;e<this.spcPlayers.length;e++)this.spcPlayers[e].pause()}},{key:"getFrequencyFromAlias",value:function(e){return null}},{key:"getCommandFrequency",value:function(e){var t=this.getCommandKeyNumber(e);return 440*Math.pow(2,(t-49)/12)}},{key:"getCommandKeyNumber",value:function(e){if(Number(e)===e&&e%1!==0)return e;if(!e)return null;var t=this.noteFrequencies,n=3===e.length?e.charAt(2):e.charAt(1),r=t.indexOf(e.slice(0,-1));return r=r<3?r+12+12*(n-1)+1:r+12*(n-1)+1}},{key:"noteFrequencies",get:function(){return["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"]}}]),e}(),re=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,t),console.log(n),(e=Object(d.a)(this,Object(p.a)(t).call(this,n))).config=n.config||{},e.state={},e}return Object(g.a)(t,e),t}(z.a.Component),ae=function(){function e(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(s.a)(this,e),this.config={},this.audioContext=t}return Object(u.a)(e,[{key:"playFrequency",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;arguments.length>5&&void 0!==arguments[5]&&arguments[5];console.info("playFrequency(",t,n,r,a,")")}}]),e}(),oe=function(){c.a.addProgramClass("AudioBufferInstrument",B,G,"AudioBuffer Instrument"),c.a.addProgramClass("OscillatorInstrument",W,Y,"OscillatorNode Instrument"),c.a.addProgramClass("PolyphonyInstrument",J,ee,"Audio Source Synthesizer"),c.a.addProgramClass("GMEPlayerSynthesizer",ne,re,"Game Music ASPlayer Synthesizer"),c.a.addProgramClass("TestInstrument",ae,null,"Test Instrument")},ie=n(39),se=n(47);oe();var ue=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(s.a)(this,e),this.eventListeners=[],this.programLoader=new c.a(this),this.volume=null,this.lastVolumeGain=null,this.playback=null;var r={title:e.generateTitle(),uuid:Q.a.generateUUID(),version:"0.0.1",created:(new Date).getTime(),timeDivision:384,beatsPerMinute:120,beatsPerMeasure:4,startTrack:"root",programs:[["PolyphonyInstrument",{voices:[["OscillatorInstrument",{type:"sawtooth"}],["OscillatorInstrument",{type:"sawtooth"}]]}],["OscillatorInstrument",{type:"square"}]],tracks:{root:[["@track0",288],["@track1"],[2e3,"@track0",288],["@track1"],[2e3,"@track0",288],["@track1"],[2e3,"@track0",288],["@track1"]],track0:[["!p",0],[0,"C4",64],[64,"D4",64],[64,"E4",64],[64,"F4",64],[64,"G4",64],[64,"A4",64]],track1:[["!p",1],[64,"A3",64],[64,"A#q3",64],[64,"C4",64],[64,"C#q4",64],[64,"D#4",64],[64,"Eq4",64],[64,"F#4",64],[64,"Gq4",64],[64,"A4",64],[64,"A#q4",64],[64,"C5",64],[64,"C#q5",64],[64,"D#5",64],[64,"Eq5",64],[64,"F#5",64],[64,"Gq5",64],[64,"A5",64]]}};this.getProxiedData=function(){return r},this.data=new Proxy(r,new R(this)),this.history=[],this.values=new l.a(this),this.loadSongData(n),this.programLoadAll(),this.dispatchEventCallback=function(e){return t.dispatchEvent(e)}}return Object(u.a)(e,[{key:"connect",value:function(e){this.destination=e}},{key:"dispatchEvent",value:function(e){for(var t=0;t<this.eventListeners.length;t++){var n=Object(i.a)(this.eventListeners[t],2),r=n[0],a=n[1];e.name!==r&&"*"!==r||a(e)}}},{key:"addEventListener",value:function(e,t){this.eventListeners.push([e,t])}},{key:"removeEventListener",value:function(e,t){for(var n=0;n<this.eventListeners.length;n++){var r=Object(i.a)(this.eventListeners[n],2),a=r[0],o=r[1];if(e===a&&t===o){this.eventListeners.splice(n,1);break}}}},{key:"unloadAll",value:function(){this.programLoader.unloadAllPrograms(),this.eventListeners=[]}},{key:"loadSongData",value:function(e){var t=this.getProxiedData();if(this.playback&&this.stopPlayback(),Object.assign(t,e),this.playbackPosition=0,!t.tracks)throw new Error("No tracks found in song data");L.a.processInstructionTracks(t.tracks),this.dispatchEvent({type:"song:loaded",song:this})}},{key:"loadSongHistory",value:function(e){this.history=e}},{key:"getStartTrackName",value:function(){return"undefined"===typeof this.data.startTrack?this.data.startTrack:Object.keys(this.data.tracks)[0]}},{key:"hasTrack",value:function(e){return"undefined"!==typeof this.data.tracks[e]}},{key:"generateInstructionTrackName",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"track",t=this.data.tracks,n=0;n<=999;n++){var r=e+n;if(!t.hasOwnProperty(r))return r}throw new Error("Failed to generate group name")}},{key:"hasProgram",value:function(e){return!!this.data.programs[e]}},{key:"playProgram",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(null!==i){var u=e.context.currentTime;setTimeout(i,1e3*(r-u))}return"string"===typeof n&&(n=Q.a.parseFrequencyString(n)),t.playFrequency(e,n,r,a,o,s)}},{key:"programGetData",value:function(e){return this.programLoader.getData(e)}},{key:"programGetClassName",value:function(e){return this.programLoader.getClassName(e)}},{key:"programGetClass",value:function(e){return this.programLoader.getClass(e)}},{key:"programGetConfig",value:function(e){return this.programLoader.getConfig(e)}},{key:"programEach",value:function(e){return this.data.programs.map((function(t,n){var r=Object(i.a)(t,2),a=r[0],o=r[1];return e(n,a,o)}))}},{key:"programLoadAll",value:function(){for(var e=this.data.programs,t=0;t<e.length;t++)e[t]&&this.programLoadInstanceFromID(t)}},{key:"programLoadInstanceFromID",value:function(e){return this.programLoader.loadInstanceFromID(e)}},{key:"programLoadRenderer",value:function(e){return this.programLoader.programLoadRenderer(e)}},{key:"programAdd",value:function(e){if("object"!==typeof e)throw new Error("Invalid programs config object");if(!e.className)throw new Error("Invalid Program Class");var t=this.data.programs.length;return this.data.programs[t]=e,this.programLoadInstanceFromID(t),t}},{key:"programReplace",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.data.programs[e];return this.data.programs[e]=[t,n],this.programLoadInstanceFromID(e),r}},{key:"programRename",value:function(e,t){this.programGetConfig(e).title=t}},{key:"programRemove",value:function(e){var t=this.data.programs;if(!t[e])return console.error("Invalid programs ID: "+e);var n=e===t.length-1,r=t[e];return n?delete t[e]:t[e]=null,r}},{key:"instructionIndexOf",value:function(e,t){if(t instanceof L.a&&(t=t.data),!this.data.tracks[e])throw new Error("Invalid instruction track: "+e);var n=this.data.tracks[e];t=R.resolveProxiedObject(t);var r=n.indexOf(t);if(-1===r)throw new Error("Instruction not found in instruction list");return r}},{key:"instructionGetList",value:function(e){if(!this.data.tracks[e])throw new Error("Invalid instruction track: "+e);return this.data.tracks[e]}},{key:"instructionGetByIndex",value:function(e,t){if(!this.data.tracks[e])throw new Error("Invalid instruction track: "+e);var n=this.instructionGetList(e);if(t<0||t>n.length)throw new Error("Index is out or range: "+t);if(!n[t])throw new Error("Invalid instruction index: "+t);return L.a.getInstruction(n[t])}},{key:"instructionGetIterator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.data.tracks[e])throw new Error("Invalid instruction track: "+e);var r=this.data.tracks[e];return new L.b(r,t||this.data.timeDivision,n||this.data.beatsPerMinute)}},{key:"instructionGetQuantizedIterator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this.data.tracks[e])throw new Error("Invalid instruction track: "+e);var a=this.data.tracks[e];return new L.d(a,t,n||this.data.timeDivision,r||this.data.beatsPerMinute)}},{key:"instructionInsertAtPosition",value:function(e,t,n){if("string"===typeof t&&(t=Q.a.parseDurationAsTicks(t,this.data.timeDivision)),!Number.isInteger(t))throw new Error("Invalid integer: "+typeof t);if(!n)throw new Error("Invalid insert instruction");for(var r=L.a.parseInstruction(n),a=this.data.tracks[e],o=this.instructionGetIterator(e),i=o.nextInstruction();i;){var s=o.positionTicks;if(s>t){var u=[t-(s-i.deltaDurationTicks),s-t],c=o.currentIndex;return this.instructionReplaceDeltaDuration(e,c,u[1]),r.deltaDurationTicks=u[0],this.instructionInsertAtIndex(e,c,r),c}if(s===t){var l=void 0;for(l=o.currentIndex+1;l<a.length&&!(new L.a(a[l]).deltaDurationTicks>0);l++);return r.deltaDurationTicks=0,this.instructionInsertAtIndex(e,l,r),l}i=o.nextInstruction()}if(o.positionTicks>=t)throw new Error("Something went wrong");var f=a.length;return r.deltaDurationTicks=t-o.positionTicks,this.instructionInsertAtIndex(e,f,r),f}},{key:"instructionInsertAtIndex",value:function(e,t,n){if(!n)throw new Error("Invalid insert instruction");return n=L.a.parseInstruction(n).data,this.instructionGetList(e).splice(t,0,n),t}},{key:"instructionDeleteAtIndex",value:function(e,t){var n=this.instructionGetByIndex(e,t);if(n.deltaDurationTicks>0){var r=this.instructionGetByIndex(e,t+1,!1);r&&this.instructionReplaceDeltaDuration(e,t+1,r.deltaDurationTicks+n.deltaDurationTicks)}this.instructionGetList(e).splice(t,1)}},{key:"instructionReplaceDeltaDuration",value:function(e,t,n){this.instructionGetByIndex(e,t).deltaDurationTicks=n}},{key:"instructionReplaceCommand",value:function(e,t,n){this.instructionGetByIndex(e,t).command=n}},{key:"instructionReplaceProgram",value:function(e,t,n){this.instructionGetByIndex(e,t).program=n}},{key:"instructionReplaceDuration",value:function(e,t,n){"string"===typeof n&&(n=Q.a.parseDurationAsTicks(n,this.data.timeDivision)),this.instructionGetByIndex(e,t).durationTicks=n}},{key:"instructionReplaceVelocity",value:function(e,t,n){if(!Number.isInteger(n))throw new Error("Velocity must be an integer: "+n);if(n<0)throw new Error("Velocity must be a positive integer: "+n);this.instructionGetByIndex(e,t).velocity=n}},{key:"trackAdd",value:function(e,t){if(this.data.tracks.hasOwnProperty(e))throw new Error("New group already exists: "+e);this.data.tracks[e]=t||[]}},{key:"trackRemove",value:function(e){if("root"===e)throw new Error("Cannot remove root instruction track, n00b");if(!this.data.tracks.hasOwnProperty(e))throw new Error("Existing group not found: "+e);delete this.data.tracks[e]}},{key:"trackRename",value:function(e,t){if("root"===e)throw new Error("Cannot rename root instruction track, n00b");if(!this.data.tracks.hasOwnProperty(e))throw new Error("Existing group not found: "+e);if(this.data.tracks.hasOwnProperty(t))throw new Error("New group already exists: "+t);var n=this.data.tracks[e];delete this.data.tracks[e],this.data.tracks[t]=n}},{key:"getSongLengthInSeconds",value:function(){var e=new ie.a(this.data.tracks,this.getStartTrackName(),this.data.beatsPerMinute,this.data.timeDivision);return e.seekToEnd(),e.getEndPositionInSeconds()}},{key:"getSongPositionFromTicks",value:function(e){return this.getGroupPositionFromTicks(this.getStartTrackName(),e)}},{key:"getGroupPositionFromTicks",value:function(t,n){for(var r=this.instructionGetIterator(t);!(r.positionTicks>=n)&&r.nextInstruction(););var a=r.positionSeconds;if(n>r.positionTicks){var o=n-r.positionTicks;a+=e.ticksToSeconds(o,r.beatsPerMinute,r.timeDivision)}else if(n<r.positionTicks){var i=r.positionTicks-n;a-=e.ticksToSeconds(i,r.beatsPerMinute,r.timeDivision)}return a}},{key:"getSongPositionInTicks",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===e&&(e=this.getSongPlaybackPosition()),this.getGroupPositionInTicks(this.getStartTrackName(),e)}},{key:"getGroupPositionInTicks",value:function(t,n){for(var r=this.instructionGetIterator(t);!(r.positionSeconds>=n)&&r.nextInstruction(););var a=r.positionTicks;if(n>r.positionSeconds){var o=n-r.positionSeconds;a+=e.secondsToTicks(o,r.beatsPerMinute)}else if(n<r.positionSeconds){var i=r.positionSeconds-n;a-=e.secondsToTicks(i,r.beatsPerMinute)}return a}},{key:"setVolume",value:function(e){this.volume=e,this.lastVolumeGain&&(this.lastVolumeGain.gain.value=e)}},{key:"getSongPlaybackPosition",value:function(){return this.playback?this.playback.audioContext.currentTime-this.playback.startTime:this.playbackPosition}},{key:"setPlaybackPositionInTicks",value:function(e){if(!Number.isInteger(e))throw new Error("Invalid start position in ticks");var t=this.getSongPositionFromTicks(e);return this.setPlaybackPosition(t)}},{key:"setPlaybackPosition",value:function(e){if(e=parseFloat(e),Number.isNaN(e))throw new Error("Invalid start position");this.playback&&this.stopPlayback(),this.playbackPosition=e,this.dispatchEvent({type:"song:seek",position:this.playbackPosition,song:this}),console.log("setPlaybackPosition",e)}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.playback&&(this.stopPlayback(),this.setPlaybackPosition(0)),null===n&&(n=this.playbackPosition),console.log("Start playback:",n);var a=new se.a(this,this.getStartTrackName(),this.dispatchEventCallback);return this.playback=a,a.play(e,n),this.dispatchEvent({type:"song:play",playback:this.playback,song:this}),a.awaitPlaybackReachedEnd().then((function(){r&&r(),t.dispatchEvent({type:"song:end",playback:t.playback,song:t})})),a}},{key:"stopProgramPlayback",value:function(e){this.programLoader.stopProgramPlayback(e)}},{key:"stopPlayback",value:function(){if(!this.playback)return console.warn("Playback is already stopped");var e=this.playback;this.playback=null,this.playbackPosition=e.getPositionInSeconds(),e.stopPlayback(),this.programLoader.stopAllPlayback(),console.log("End playback:",this.playbackPosition),this.dispatchEvent({type:"song:end",playback:this.playback,song:this})}},{key:"pause",value:function(){if(this.isPaused)throw new Error("Song is already paused");this.isPaused=!0}},{key:"resume",value:function(){if(!this.isPaused)throw new Error("Song is not paused");this.isPaused=!1}},{key:"isPlaying",value:function(){return!!this.playback}},{key:"playSelectedInstructions",value:function(e,t,n){this.playback&&this.stopPlayback();var r=new se.a(this,t,this.dispatchEventCallback);this.playback=r,r.addInstructionFilter((function(e,r){if(r.trackName!==t)return null;for(var a=r.iterator.currentIndex,o=0;o<n.length;o++)if(n[o]===a)return e})),n.length>0&&r.playAtStartingTrackIndex(e,n[0])}},{key:"playInstruction",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,i=e.context;if(!t instanceof L.a)throw new Error("Invalid instruction");var s=null;if("undefined"!==typeof t.durationTicks){var u=this.data.beatsPerMinute,c=this.data.timeDivision,l=t.durationTicks;s=l/c/(u/60)}var f=i.currentTime;r||0===r||(r=f),this.playProgram(e,n,t.command,r,s,t.velocity,a,o)}},{key:"queueHistoryAction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Array.isArray(t)&&(t=t.join("."));var a=[e+":"+t];return null===n&&null===r||a.push(n),null!==r&&a.push(r),this.dispatchEvent({type:"song:modified",historyAction:a,song:this}),a}}],[{key:"ticksToSeconds",value:function(e,t,n){return e/n*(60/t)}},{key:"secondsToTicks",value:function(e,t,n){return Math.round(e*n/(60/t))}},{key:"loadSongFromData",value:function(t,n){var r=new e;return r.loadSongData(n),r}},{key:"loadSongFromMemory",value:function(t,n){var r=new f.a,a=r.loadSongFromMemory(n),o=r.loadSongHistoryFromMemory(n),i=new e(a);return i.loadSongData(a),i.loadSongHistory(o),i}},{key:"loadSongFromFileInput",value:function(t,n){var r=e.getFileSupportModule(n.name);if("function"!==typeof r.loadSongDataFromFileInput)throw new Error("Invalid library.loadSongDataFromFileInput method");var a=e.loadBufferFromFileInput(n),o=r.loadSongDataFromBuffer(a,n.name),i=new e;return i.loadSongData(o),i}},{key:"loadSongFromURL",value:function(){var t=Object(o.a)(a.a.mark((function t(n,r){var o,i,s,u,c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("function"===typeof(o=e.getFileSupportModule(r)).loadSongDataFromBuffer){t.next=3;break}throw new Error("Invalid library.loadSongDataFromURL method: "+r);case 3:return i=new A,t.next=6,i.loadBufferFromURL(r);case 6:return s=t.sent,u=o.loadSongDataFromBuffer(s,r),(c=new e).loadSongData(u),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"loadBufferFromFileInput",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(t){e(t.target.result)}}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getFileSupportModule",value:function(e){var t,n=e.split(".").pop().toLowerCase();switch(n){case"json":return t=new D;case"nsf":case"nsfe":case"spc":case"gym":case"vgm":case"vgz":case"ay":case"sgc":case"kss":return(t=new O).init(),t;default:throw new Error("Unknown file module for file type: "+n)}}},{key:"generateTitle",value:function(){return"Untitled (".concat((new Date).toJSON().slice(0,10).replace(/-/g,"/"),")")}}]),e}();ue.DEFAULT_VOLUME=.7;t.a=ue},,function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(0),c=n.n(u),l=n(22),f=(n(122),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).state={open:!1,stick:!1},n.divRef=c.a.createRef(),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getOverlay",value:function(){return this.context.overlay}},{key:"componentDidUpdate",value:function(e,t,n){this.getOverlay()&&(this.state.open?this.getOverlay().addCloseMenuCallback(this,this.closeMenu.bind(this)):this.getOverlay().removeCloseMenuCallback(this)),this.updateScreenPosition()}},{key:"componentWillUnmount",value:function(){this.getOverlay()&&this.getOverlay().removeCloseMenuCallback(this)}},{key:"render",value:function(){if(!this.state.open)return null;var e="asui-menu-dropdown";if(this.props.vertical&&(e+=" vertical"),this.state.stick&&(e+=" stick"),this.props.disabled)return"Disabled";var t=this.props.options;return"function"===typeof t&&(t=t(this)),t||console.warn("Empty options returned by ",this),c.a.createElement(l.a.Provider,{value:{overlay:this.getOverlay(),parentDropDown:this}},c.a.createElement("div",{className:e,children:t,ref:this.divRef}))}},{key:"hoverMenu",value:function(){!0!==this.state.open&&this.getOverlay()&&this.getOverlay().isHoverEnabled()&&this.openMenu()}},{key:"toggleMenu",value:function(){this.state.open?this.state.stick?this.closeMenu():this.stickMenu():this.openMenu()}},{key:"openMenu",value:function(){var e=this;if(this.props.disabled)return console.error("Menu is disabled");if(this.state.open)throw new Error("Menu was already open");if(this.getOverlay()&&!1!==this.getOverlay().openMenu(this.props.options))return;this.setState({open:!0}),setTimeout((function(){e.getOverlay().closeMenus(e.getAncestorMenus())}),100)}},{key:"stickMenu",value:function(){if(!this.state.open)throw new Error("Unable to stick. Menu was not yet open");this.getAncestorMenus().forEach((function(e){e.setState({stick:!0})}))}},{key:"closeMenu",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.state.stick&&!0===e||this.setState({open:!1,stick:!1,options:null})}},{key:"getAncestorMenus",value:function(){for(var e=[],t=this;t;)e.push(t),t=t.context.parentDropDown;return e}},{key:"closeAllDropDownMenus",value:function(){this.getOverlay()&&this.getOverlay().closeAllMenus()}},{key:"updateScreenPosition",value:function(){if(this.state.open&&this.divRef.current){var e=this.divRef.current,t=e.getBoundingClientRect();t.right>window.innerWidth&&e.classList.add("overflow-right"),t.bottom>window.innerHeight&&e.classList.add("overflow-bottom")}}}]),t}(c.a.Component));f.contextType=l.a,f.defaultProps={vertical:!1},t.a=f},function(e,t,n){"use strict";var r=n(2),a=n.n(r),o=n(6),i=n(12),s=n(3),u=n(4),c=n(9),l=n(0),f=n.n(l),h=n(14),d=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,[{key:"getTitle",value:function(){return this.constructor.name}},{key:"getLibraries",value:function(){return[]}},{key:"getPresets",value:function(){return[]}},{key:"supportsProgram",value:function(e){for(var t=this.getPresets(),n=0;n<t.length;n++){if(Object(i.a)(t[n],1)[0]===e)return!0}return!1}},{key:"renderMenuProgramAll",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return f.a.createElement(f.a.Fragment,null,f.a.createElement(c.d,{options:function(){return t.renderMenuProgramNew(e,n)}},"New Program"),f.a.createElement(c.c,null),f.a.createElement(c.d,{options:function(){return t.renderMenuProgramAllPresets(e,n,!0)}},"Using Preset"))}},{key:"renderMenuProgramNew",value:function(e){return f.a.createElement(f.a.Fragment,null,h.a.getRegisteredPrograms().map((function(t,n){return f.a.createElement(c.b,{key:n,onAction:function(n){return e(t.className)}},t.title||"Untitled Preset #"+n)})))}},{key:"renderMenuProgramAllPresets",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return f.a.createElement(f.a.Fragment,null,null,a&&e.lastSelectedLibrary?f.a.createElement(c.d,{disabled:0===e.lastSelectedLibrary.getPresets().length,options:function(){return e.lastSelectedLibrary.renderMenuProgramPresets(t,r)}},"Current Library"):null,f.a.createElement(c.d,{disabled:0===this.getPresets().length,options:function(){return n.renderMenuProgramPresets(t,r)}},"Presets"),f.a.createElement(c.d,{disabled:0===this.getLibraries().length,options:function(){return n.renderMenuLibraryOptions((function(e){return e.renderMenuProgramAllPresets(t,r,!1)}),r)}},"Other Libraries"))}},{key:"renderMenuProgramRecentPresets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return f.a.createElement(f.a.Fragment,null,f.a.createElement(c.b,{onAction:function(){},disabled:!0},this.getTitle()),f.a.createElement(c.c,null),this.getPresets().map((function(n,r){var a=Object(i.a)(n,2),o=a[0],s=a[1];return null===t||t===o?f.a.createElement(c.b,{key:r,onAction:function(t){return e(o,s)}},s.title||"Untitled Preset #"+r):null})))}},{key:"renderMenuProgramPresets",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return f.a.createElement(f.a.Fragment,null,f.a.createElement(c.b,{onAction:function(){},disabled:!0},this.getTitle()),f.a.createElement(c.c,null),this.getPresets().map((function(n,r){var a=Object(i.a)(n,2),o=a[0],s=a[1];return null===t||t===o?f.a.createElement(c.b,{key:r,onAction:function(t){return e(o,s)}},s.title||"Untitled Preset #"+r):null})))}},{key:"renderMenuLibraryOptions",value:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getLibraries().map((function(n,r){return f.a.createElement(c.d,{key:r++,options:function(){return e.lastSelectedLibrary=n,t(n)}},n.getTitle())}))}}],[{key:"historicLibraryCount",value:function(){return Object.values(e.cache).length}},{key:"eachHistoricLibrary",value:function(t){var n=[];for(var r in e.cache)if(e.cache.hasOwnProperty(r)){var a=e.cache[r];if(a instanceof Promise)continue;a.name=a.name||a.url.split("/").pop();var o=t(a);if(!1===o)break;null!==o&&n.push(o)}return n}},{key:"loadDefault",value:function(){return new(0,n(154).default)}},{key:"loadFromURL",value:function(){var t=Object(o.a)(a.a.mark((function t(n){var r,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new Error("Invalid url");case 2:return t.next=4,fetch(n);case 4:return r=t.sent,t.next=7,r.json();case 7:return"undefined"===typeof(o=t.sent).url&&(o.url=n.toString()),console.log("library",o),t.abrupt("return",new e(o));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadFromURL2",value:function(){var t=Object(o.a)(a.a.mark((function t(n){var r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n){t.next=2;break}throw new Error("Invalid url");case 2:if(n=new URL(n.toString().split("#")[0],document.location).toString(),e.cache[n]||(e.cache[n]=new Promise((function(t,r){var a=new XMLHttpRequest;a.open("GET",n.toString(),!0),a.responseType="json",a.onload=function(){if(200!==a.status)return r("Sample library not found: "+n);var o=a.response;o.url=n.toString(),Object.keys(e.cache).forEach((function(t){Object.values(e.cache)>5&&delete e.cache[t]})),e.cache[n]=o,console.info("Sample Library Loaded: ",n,e.cache),t(o)},a.send()}))),!((r=e.cache[n])instanceof Promise)){t.next=9;break}return t.next=8,r;case 8:r=t.sent;case 9:return t.abrupt("return",new e(r));case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}();d.lastSelectedLibrary=null,d.cache={},t.a=d},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(3),a=n(4),o=n(34),i=n(72),s=n(15),u=function(){function e(t,n,a,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(Object(r.a)(this,e),this.tracks=t,!this.tracks[n])throw new Error("Invalid instruction track: "+n);this.onEvent=i||function(){},this.positionSeconds=0,this.activeTracks=[],this.startingBeatsPerMinute=a,this.startingTimeDivision=o;var s={startPosition:0,trackName:n};this.startTrackIteration(s)}return Object(a.a)(e,[{key:"instructionGetIterator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this.tracks[e])throw new Error("Invalid instruction track: "+e);var r=this.tracks[e];return new s.b(r,t||this.startingTimeDivision,n||this.startingBeatsPerMinute)}},{key:"startTrackIteration",value:function(e){return e.iterator=this.instructionGetIterator(e.trackName,e.timeDivision,e.beatsPerMinute),this.activeTracks.push(e),e}},{key:"getPositionInSeconds",value:function(){for(var e=0,t=0;t<this.activeTracks.length;t++){var n=this.activeTracks[t],r=n.iterator,a=n.startPosition+r.positionSeconds;a>e&&(e=a)}return e}},{key:"getEndPositionInSeconds",value:function(){for(var e=0,t=0;t<this.activeTracks.length;t++){var n=this.activeTracks[t],r=n.iterator,a=n.startPosition+r.endPositionSeconds;a>e&&(e=a)}return e}},{key:"hasReachedEnd",value:function(){for(var e=0;e<this.activeTracks.length;e++){if(this.activeTracks[e].iterator.hasReachedEnd())return!0}return!1}},{key:"processTrackInstruction",value:function(e,t){var n={startPosition:t.iterator.positionSeconds,trackName:e.getTrackName(),beatsPerMinute:t.beatsPerMinute};"undefined"!==typeof t.program&&t.program&&(n.program=t.program),"undefined"!==typeof t.destination&&t.destination&&(n.destination=t.destination),this.startTrackIteration(n)}},{key:"processCommandInstruction",value:function(e,t){}},{key:"processInstruction",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e instanceof i.default?this.processCommandInstruction(e,t):e instanceof o.default&&this.processTrackInstruction(e,t),n&&n(e,t)}},{key:"seekToEnd",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=!1;!r;)n+=t,r=this.seekToPosition(n,e)}},{key:"seekToPosition",value:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=!0,a=function(a){var o=t.activeTracks[a],i=o.iterator,s=o.startPosition;e-=s,i.hasReachedEnd()||(i.seekToPosition(e,(function(e){t.processInstruction(e,o,n)})),i.hasReachedEnd()||(r=!1))},o=0;o<this.activeTracks.length;o++)a(o);return r}},{key:"seekToStartingTrackIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.activeTracks[0],r=this.instructionGetIterator(n.trackName,n.timeDivision,n.beatsPerMinute);r.seekToIndex(e,t);var a=r.positionSeconds;this.seekToPosition(a,t)}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(0),c=n.n(u),l=n(156),f=n(49),h=n(155),d=n(22),p=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).cb={onMouseInput:function(e){return n.onMouseInput(e)},onKeyDown:function(e){return n.onKeyDown(e)}},n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){return c.a.createElement(l.a,{onPress:this.cb.onMouseInput,onLongPress:this.cb.onMouseInput},c.a.createElement(f.a,{children:this.renderChildren()}))}},{key:"renderChildren",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.props.children;return"object"!==typeof t&&(t=c.a.createElement(h.a,Object.assign({children:t},e))),t}},{key:"onMouseInput",value:function(e){e.defaultPrevented||(e.preventDefault(),this.doAction(e))}},{key:"onKeyDown",value:function(e){if(!e.isDefaultPrevented())switch(e.key){case" ":case"Enter":this.doAction(e);break;default:console.info("Unhandled key: ",e.key)}}},{key:"doAction",value:function(e){throw new Error("Not implemented")}},{key:"getOverlay",value:function(){return this.context.overlay}},{key:"closeAllDropDownMenus",value:function(){this.getOverlay()&&this.getOverlay().closeAllMenus()}}]),t}(c.a.Component);p.contextType=d.a},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var r=n(2),a=n.n(r),o=n(6),i=n(3),s=n(4),u=n(7),c=n(28),l=n(5),f=n(27),h=n(8),d=n(39),p=n(15),m=function(e){function t(e){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return Object(i.a)(this,t),(n=Object(u.a)(this,Object(l.a)(t).call(this,e.data.tracks,r||e.getStartTrackName(),e.data.beatsPerMinute,e.data.timeDivision,a))).song=e,n.seekLength=10,n.active=!0,n.endPromise=new Promise((function(e,t){n.endResolve=e})),n.playInstructionCallback=n.playInstruction.bind(Object(c.a)(n)),n}return Object(h.a)(t,e),Object(s.a)(t,[{key:"startTrackIteration",value:function(e){Object(f.a)(Object(l.a)(t.prototype),"startTrackIteration",this).call(this,e),e.playingIndices||(e.playingIndices=[]),this.onEvent({type:"track:start",playback:this,trackStats:e})}},{key:"addInstructionFilter",value:function(e){var t=this.playInstructionCallback;this.playInstructionCallback=function(n,r){if(n=e(n,r)){if(!n instanceof p.a)throw new Error("Invalid Instruction");t(n,r)}}}},{key:"play",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||!e.context)throw new Error("Invalid destination");this.audioContext=e.context,this.destination=e,this.startTime=this.audioContext.currentTime,this.seekInterval=setInterval((function(){return t.renderPlayback()}),this.seekLength/10),null!==n&&(this.seekToPosition(n),this.startTime-=n),this.renderPlayback()}},{key:"playAtStartingTrackIndex",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.activeTracks[0],a=this.instructionGetIterator(r.trackName,r.timeDivision,r.beatsPerMinute);a.seekToIndex(t,n);var o=a.positionSeconds;this.play(e,o)}},{key:"getPlaybackPosition",value:function(){return this.audioContext.currentTime-this.startTime}},{key:"awaitPlaybackReachedEnd",value:function(){var e=Object(o.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.endPromise;case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderPlayback",value:function(){var e=this,t=this.getPlaybackPosition();if(!this.active||this.hasReachedEnd()){clearInterval(this.seekInterval);var n=this.getEndPositionInSeconds()-t;console.log("Song is ending in ".concat(n," seconds")),n>0?setTimeout((function(){return e.stopPlayback()}),1e3*n):this.stopPlayback()}else this.seekToPosition(t+this.seekLength,this.playInstructionCallback)}},{key:"stopPlayback",value:function(){this.active&&(this.active=!1,this.endResolve())}},{key:"playInstruction",value:function(e,t){var n=this;if(e instanceof p.c){if("undefined"===typeof t.program)return console.error("Track '".concat(t.trackName,"' has no program set"));var r=t.destination||this.destination,a=this.startTime+t.startPosition+t.iterator.positionSeconds;if(a>0){var o=t.iterator.currentIndex,i=t.playingIndices,s=this.onEvent;this.song.playInstruction(r,e,t.program,a,(function(){-1===i.indexOf(o)&&(i.push(o),s({type:"instruction:play",playback:n,playingIndices:i,trackStats:t}))}),(function(){i.splice(i.indexOf(o),1),s({type:"instruction:stop",playback:n,playingIndices:i,trackStats:t})}))}}}},{key:"processCommandInstruction",value:function(e,t){e.processCommandInstruction(this.song,t)}}]),t}(d.a)},,,,,,,,,,function(e,t,n){"use strict";var r=n(12),a=n(3),o=n(4),i=n(11),s=function(){function e(t){Object(a.a)(this,e),this.song=t}return Object(o.a)(e,[{key:"getSongPrograms",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]},t=this.song,n=[];if(t&&t.data.programs)for(var a=t.data.programs,o=0;o<a.length;o++){var i=Object(r.a)(a[o],2),s=i[0],c=i[1],l=e(o,s,c);if(!u(n,l))return n}return n}},{key:"getAllSongGroups",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=this.song,n=[],r=t.data.tracks;return Object.keys(r).forEach((function(t,r){var a=e(t);if(!u(n,a))return n})),n}},{key:"getAllNamedFrequencies",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return"TODO"}},{key:"formatSongDuration",value:function(e){return i.a.formatDuration(e,this.song.data.timeDivision)}},{key:"parseDurationAsTicks",value:function(e){return i.a.parseDurationAsTicks(e,this.song.data.timeDivision)}},{key:"formatDuration",value:function(e){return i.a.formatDuration(e,this.song.data.timeDivision)}},{key:"getNoteDurations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e,t){return[e,t]};return i.a.getNoteDurations(e,this.song.data.timeDivision)}}]),e}();function u(e,t){return null!==t&&"undefined"!==typeof t&&e.push(t),!1!==t||t}t.a=s},function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(40),c=(n(68),function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getClassName",value:function(){return"asui-menu-item"}}]),t}(u.a));t.a=c},,function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(0),c=n.n(u),l=(n(68),function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){return c.a.createElement("hr",{className:"asui-menu-break"})}}]),t}(c.a.Component));t.a=l},function(e,t,n){"use strict";var r=n(14);n.d(t,"a",(function(){return r.a}))},function(e,t,n){"use strict";var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(0),c=n.n(u),l=(n(123),n(60)),f=n(58),h=n(2),d=n.n(h),p=n(6),m=n(12),g=n(22),v=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).state={open:!1,openOverlay:!1},n.cb={closeAllMenus:function(){return n.closeAllMenus()}},n.openMenus=[],n.updateOverlayTimeout=null,n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"renderContent",value:function(){throw new Error("Not implemented")}},{key:"render",value:function(){return c.a.createElement(g.a.Provider,{value:{overlay:this,parentDropDown:null}},this.renderContent())}},{key:"updateOverlay",value:function(){var e=this.state.open||this.openMenus.length>0;this.state.openOverlay!==e&&this.setState({openOverlay:e})}},{key:"isHoverEnabled",value:function(){return!this.props.isActive&&(this.state.openOverlay||this.openMenus.length>0)}},{key:"addCloseMenuCallback",value:function(e,t){-1===this.openMenus.findIndex((function(t){return t[0]===e}))&&this.openMenus.push([e,t]),this.updateOverlay()}},{key:"removeCloseMenuCallback",value:function(e){var t=this.openMenus.findIndex((function(t){return t[0]===e}));-1!==t&&this.openMenus.splice(t,1)}},{key:"closeMenus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.openMenus.forEach((function(n){var r=Object(m.a)(n,2),a=r[0],o=r[1];-1===e.indexOf(a)&&o(t)}))}},{key:"closeAllMenus",value:function(e){this.closeMenus(e,[]),this.setState({open:!1,openOverlay:!1,options:null})}},{key:"openMenu",value:function(){var e=Object(p.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.props.isActive){e.next=2;break}return e.abrupt("return",!1);case 2:if("function"===typeof t&&(t=t(this)),!(t instanceof Promise)){e.next=7;break}return e.next=6,t;case 6:t=e.sent;case 7:return this.setState({open:!0,openOverlay:!0,options:t}),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(c.a.Component);n.d(t,"a",(function(){return y}));var y=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"render",value:function(){return this.state.openOverlay||this.state.open?c.a.createElement(c.a.Fragment,null,this.state.openOverlay?c.a.createElement("div",{className:"asui-menu-overlay-container",onClick:this.cb.closeAllMenus}):null,this.state.open?c.a.createElement("div",{className:"asui-menu-overlay-dropdown"},this.state.options,c.a.createElement(l.a,null),c.a.createElement(f.a,{onAction:this.cb.closeAllMenus},"- Close Menu -")):null,this.props.children):this.props.children}}]),t}(v)},,,,,,function(e,t,n){},,,function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"clone",value:function(){return new t(this.data.slice())}},{key:"durationTicks",get:function(){return"undefined"!==typeof this.data[2]?this.data[2]:void 0},set:function(e){if(e=parseFloat(e),Number.isNaN(e))throw new Error("Invalid Duration");this.data[2]=e}},{key:"velocity",get:function(){return"undefined"!==typeof this.data[3]?this.data[3]:void 0},set:function(e){if(e=parseFloat(e),Number.isNaN(e))throw new Error("Invalid Velocity");this.data[3]=e}}]),t}(n(21).a);t.default=u},function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(21),c=n(14),l=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getCommandName",value:function(){return"string"===typeof this.data[1]?this.data[1].substr(1):void 0}},{key:"setCommandName",value:function(e){this.data[1]="!".concat(e)}},{key:"getParams",value:function(){return this.data.slice(2)}},{key:"processCommandInstruction",value:function(e,t){var n=this.getCommandName().toLowerCase();switch(n){case"program":case"p":var r=t.program,a=t.destination,o=this.loadProgramFromParams(e);t.program=o,"function"===typeof o.useDestination&&(t.destination=o.useDestination(a)),"function"===typeof o.useProgram&&o.useProgram(r);break;default:return console.error("Unknown command instruction: "+n)}}},{key:"loadProgramFromParams",value:function(e){var t=this.getParams();return"string"===typeof t[0]?c.a.loadInstance(t[0],t[1]):e.programLoadInstanceFromID(t[0])}},{key:"clone",value:function(){return new t(this.data.slice())}},{key:"durationTicks",get:function(){}},{key:"velocity",get:function(){}}]),t}(u.a);t.default=l},,,,,,,function(e,t,n){},function(e){e.exports=JSON.parse('{"name":"audio-source-composer","version":"0.5.1","type":"module","description":"Audio Source Composer","author":"Ari Asulin","license":"GPL-3.0","main":"index.js","scripts":{"start":"node .scripts/server.js","test":"node .scripts/test.js","minify":"node .scripts/minify.js"},"repository":{"type":"git","customURL":"git+ssh://git@github.com/clevertree/audio-source-composer.git"},"keywords":["song","music","editor","player"],"bugs":{"customURL":"https://github.com/clevertree/audio-source-composer/issues"},"homepage":"https://github.com/clevertree/audio-source-composer#readme","dependencies":{"@types/jest":"^25.1.4","@types/node":"^13.9.1","@types/react":"^16.9.23","@types/react-dom":"^16.9.5","typescript":"^3.8.3"},"devDependencies":{"node-fetch":"^2.6.0"}}')},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){e.exports=n(153)},,,,,function(e,t,n){},function(e,t,n){},,,,,,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,,,,function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"instruction",get:function(){return this.data[2]},set:function(e){this.data[2]=e}},{key:"durationTicks",get:function(){return null},set:function(e){throw new Error("Unable to set duration on MIDI instruction")}}]),t}(n(21).a);t.default=u},function(e,t,n){},function(e,t,n){},function(e){e.exports=JSON.parse('{"title":"Mohayonao Wave-Table","url":"https://github.com/mohayonao/wave-tables","baseURL":"https://raw.githubusercontent.com/mohayonao/wave-tables/master/","default":"Brass.json","presets":[],"samples":["Bass.json","BassAmp360.json","BassFuzz.json","BassFuzz2.json","BassSubDub.json","BassSubDub2.json","Brass.json","BritBlues.json","BritBluesDriven.json","Buzzy1.json","Buzzy2.json","Celeste.json","ChorusStrings.json","Dissonant1.json","Dissonant2.json","DissonantPiano.json","DroppedSaw.json","DroppedSquare.json","DynaEPBright.json","DynaEPMed.json","Ethnic33.json","Full1.json","Full2.json","GuitarFuzz.json","Harsh.json","MklHard.json","Noise.json","Organ2.json","Organ3.json","PhonemeAh.json","PhonemeBah.json","PhonemeEe.json","PhonemeO.json","PhonemeOoh.json","PhonemePopAhhhs.json","Piano.json","Pulse.json","PutneyWavering.json","Saw.json","Square.json","TB303Square.json","Throaty.json","Triangle.json","Trombone.json","TwelveOpTines.json","TwelveStringGuitar1.json","WarmSaw.json","WarmSquare.json","WarmTriangle.json","Wurlitzer.json","Wurlitzer2.json"]}')},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,,function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(45),i=n.n(o),s=(n(110),n(3)),u=n(4),c=n(7),l=n(5),f=n(8),h=n(100),d=n(32),p=(n(111),n(2)),m=n.n(p),g=n(6),v=n(27),y=n(35),k=n(24),b=n(1),w=n(12),E=(n(79),function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(s.a)(this,t),!(e=Object(c.a)(this,Object(l.a)(t).call(this,n,{}))).props.data)throw new Error("Invalid Entry data");if(!e.props.playlist)throw new Error("Invalid Entry playlist");return e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t="undefined"!==typeof this.props.id?this.props.id:"-";Number.isInteger(t)&&t<=9&&t<=9&&(t="0"+t);var n=(this.props.data.length||0).toString().split(":"),r=Object(w.a)(n,2),o=r[0],i=r[1],s=function(){try{return new Date(1e3*o).toISOString().substr(14,5)}catch(e){return"N/A"}}();return a.a.createElement("div",{className:"asp-playlist-entry",onClick:function(t){return e.onInput(t)}},a.a.createElement("div",{className:"id"},t+":"),a.a.createElement("div",{className:"name"},this.props.data.name),a.a.createElement("div",{className:"length"},s,i?"[".concat(i,"]"):""))}},{key:"onInput",value:function(e){switch(e.type){case"click":console.log(e),this.props.onAction&&this.props.onAction(e);break;default:console.log("Unknown input: ",e.type)}}}]),t}(a.a.Component)),_=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(s.a)(this,t),!(e=Object(c.a)(this,Object(l.a)(t).call(this,n,{}))).props.player)throw new Error("Invalid player");return e.state=e.props.player.state.playlist,e.state.position=e.state.position||0,e.state.entries=e.state.entries||[],e.state.selectedPositions=e.state.selectedPositions||[],e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement("div",{className:"asp-playlist"},a.a.createElement("div",{className:"header"},a.a.createElement("div",{className:"id"},"ID"),a.a.createElement("div",{className:"name"},"Name"),a.a.createElement("div",{className:"length"},"Length")),a.a.createElement("div",{className:"container"},this.state.entries.length>0?this.props.player.eachEntry((function(t,n,r){return a.a.createElement(E,{id:n,key:n,data:t,playlist:e,depth:r,onAction:function(t){return e.props.player.toggleEntryAtPosition(n)}})})):a.a.createElement("div",{className:"empty-playlist"},"Empty Playlist")))}},{key:"onClick",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.target.closest("aspp-entry,div.asp-playlist-entry"))){e.next=13;break}if(!n.isPlaylist){e.next=7;break}return e.next=5,n.togglePlaylist();case 5:e.next=11;break;case 7:return e.next=9,this.props.player.playlistMoveToEntry(n);case 9:return e.next=11,this.props.player.playlistPlay();case 11:e.next=14;break;case 13:console.error(t,this);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){this.setState({entries:[]})}}]),t}(a.a.Component),S=(n(142),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),t}(a.a.Component)),P=n(9),x=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){if(this.props.portrait)return[a.a.createElement("div",{key:"title",className:"asp-title-text"},this.props.title),a.a.createElement(P.d,{key:"menu-button",arrow:!1,className:"asp-menu-button-toggle",options:this.props.menuContent},a.a.createElement(b.e,{source:"menu"}))];var e=this.props.menuContent;return"function"===typeof e&&(e=e()),[a.a.createElement("div",{key:"title",className:"asp-title-text"},this.props.title),a.a.createElement("div",{className:"asp-menu-container"},e)]}}]),t}(a.a.Component),O=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,t),(e=Object(c.a)(this,Object(l.a)(t).call(this,n))).onSongEventCallback=function(t){return e.onSongEvent(t)},e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"setCurrentSong",value:function(e){this.song&&(this.setStatus("Unloading song: "+this.song.data.title),this.song.isPlaying&&this.song.stopPlayback(),this.song.removeEventListener("*",this.onSongEventCallback)),this.song=e,this.song.addEventListener("*",this.onSongEventCallback),this.state.songLength=e.getSongLengthInSeconds(),e.playlistPosition=this.getCurrentEntryPosition();var t=this.getCurrentEntry();t.name=e.data.title,t.length=e.getSongLengthInSeconds(),this.forceUpdate(),this.setStatus("Initializing song: "+e.data.title),this.song.connect(this.getAudioContext()),this.setStatus("Loaded song: "+e.data.title)}},{key:"setStatus",value:function(e){console.info.apply(null,arguments),this.setState({status:e})}},{key:"setError",value:function(e){this.setStatus(a.a.createElement("div",{className:"error"},e))}},{key:"setVersion",value:function(e){this.setState({version:e})}},{key:"saveSongToFile",value:function(){var e=this.song.data;(new k.a).saveSongToFile(e),this.setStatus("Saved song to file")}},{key:"getAudioContext",value:function(){if(this.audioContext)return this.audioContext;var e=new(window.AudioContext||window.webkitAudioContext);return this.audioContext=e,e}},{key:"getVolumeGain",value:function(){if(!this.volumeGain){var e=this.getAudioContext(),t=e.createGain();t.gain.value=this.state.volume,t.connect(e.destination),this.volumeGain=t}return this.volumeGain}},{key:"getVolume",value:function(){return this.state.volume}},{key:"setVolume",value:function(e){console.info("Setting volume: ",e),this.song&&this.song.setVolume(e)}},{key:"updateSongPositionMaxLength",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fieldSongPosition.setState({max:Math.ceil(t)});case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateSongPositionValue",value:function(e){var t=Math.round(e);this.fieldSongTiming.value=this.values.formatPlaybackPosition(e),this.fieldSongPosition.value!==t&&(this.fieldSongPosition.value=t)}},{key:"getCurrentEntryPosition",value:function(){return this.state.playlist.position||0}},{key:"getCurrentEntry",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0===this.state.playlist.entries.length)throw new Error("Empty playlist");return this.getEntry(this.getCurrentEntryPosition(),e)}},{key:"getEntry",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=null;if(this.eachEntry((function(t,r){if(r===e&&(n=t),n)return!1})),!n&&t)throw new Error("Invalid playlist position: "+e);return n}},{key:"eachEntry",value:function(e){var t=[],n=0;return function r(a,o){for(var i=0;i<a.length;i++){var s=a[i],u=e(s,n,o);if(!1===u)return!1;if(null!==u&&t.push(u),n++,s.playlist&&!0===s.open)if(!1===r(s.playlist.entries,o+1))return!1}return!0}(this.state.playlist.entries,0),t}},{key:"toggleEntryAtPosition",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.getEntry(t),!this.isPlaylist(n.url)){e.next=6;break}return e.next=4,this.togglePlaylistEntry(n);case 4:e.next=7;break;case 6:this.state.playlist.position!==t?(this.state.playlist.position=t,this.playlistPlay()):console.warn("no action");case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"togglePlaylistEntry",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isPlaylist(t.url)){e.next=2;break}throw new Error("Invalid playlist entry");case 2:if(t.open=!t.open,!0!==t.open){e.next=11;break}if(t.playlist){e.next=11;break}return t.loading=!0,this.playlist&&this.playlist.forceUpdate(),e.next=9,this.loadPlaylistDataFromURL(t.url);case 9:t.playlist=e.sent,delete t.loading;case 11:this.playlist&&this.playlist.forceUpdate();case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playEntry",value:function(e){}},{key:"loadURLAsPlaylist",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.addEntryToPlaylist(t),this.toggleEntryAtPosition(0);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSongFromPlaylistEntry",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCurrentEntry();case 2:if(t=e.sent,!this.isPlaylist(t.url)){e.next=5;break}throw new Error("Invalid song (playlist): "+t.url);case 5:if(!t.file){e.next=12;break}return this.setStatus("Loading playlist song from file: "+t.file.name),e.next=9,y.a.loadSongFromFileInput(t.file);case 9:n=e.sent,e.next=20;break;case 12:if(!t.url){e.next=19;break}return this.setStatus("Loading playlist song from url: "+t.url),e.next=16,y.a.loadSongFromURL(t.url);case 16:n=e.sent,e.next=20;break;case 19:throw new Error("Invalid song entry: "+JSON.stringify(t));case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadPlaylistDataFromURL",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Loading playlist: ",t),t=new URL(t,document.location),e.next=4,new Promise((function(e,n){var r=new XMLHttpRequest;r.open("GET",t.toString(),!0),r.responseType="json",r.onload=function(){return e(r.response)},r.onerror=n,r.send()}));case 4:if((n=e.sent).entries){e.next=7;break}throw new Error("No playlist entries: "+t);case 7:if(Array.isArray(n.entries)){e.next=9;break}throw new Error("Invalid playlist entries: "+t);case 9:for((r=n.urlPrefix)&&"/"===r[0]||(r=t.pathname.split("/").slice(0,-1).join("/")+"/"+(r||"")),a=0;a<n.entries.length;a++)"object"===typeof(o=n.entries[a])?o.url=r+o.url:o=r+o,o=this.parseEntryData(o),n.entries[a]=o;return console.log("Loaded playlist: ",t,n),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addEntryToPlaylist",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=this.parseEntryData(e);var n=this.state.playlist;n.entries||(n.entries=[]);var r=n.entries;null===t?(t=r.length,r.push(e)):r.splice(t,0,e)}},{key:"openSongFromFileDialog",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,e.next=3,this.openFileDialog(n);case 3:r=e.sent,this.addInputFileToPlaylist(r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addInputFileToPlaylist",value:function(e){var t={file:e,name:"file://"+e.name,url:"file://"+e.name};this.addEntryToPlaylist(t),this.playlist.forceUpdate()}},{key:"scrollToEntry",value:function(e){console.log("TODO scrollToEntry",e)}},{key:"playlistPlay",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getCurrentEntryPosition(),!this.song||this.song.playlistPosition!==t){e.next=12;break}if(!this.song.isPaused){e.next=4;break}return e.abrupt("return",this.song.resume());case 4:if(!this.song.isPlaying){e.next=6;break}throw new Error("Song is already playing");case 6:return e.next=8,this.setCurrentSong(this.song);case 8:return this.setStatus("Playing: "+this.song.data.title),e.next=11,this.song.play(this.getAudioContext());case 11:return e.abrupt("return",e.sent);case 12:return this.setState({playing:!0}),e.next=15,this.getCurrentEntry();case 15:if(n=e.sent,!this.isPlaylist(n.url)){e.next=19;break}return e.next=19,this.playlistMoveToNextSongEntry();case 19:if(!this.state.playing){e.next=33;break}return this.scrollToEntry(this.getCurrentEntryPosition()),e.next=23,this.loadSongFromPlaylistEntry();case 23:return r=e.sent,e.next=26,this.setCurrentSong(r);case 26:return this.setStatus("Playing: "+r.data.title),e.next=29,r.play(this.getAudioContext());case 29:if(this.state.playing){e.next=31;break}return e.abrupt("break",33);case 31:e.next=19;break;case 33:this.setState({playing:!1});case 34:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playlistStop",value:function(){var e=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.isPlaylistActive=!1,this.song&&this.song.isPlaying&&(this.setStatus("Stopping: "+this.song.data.title),this.song.stopPlayback(),this.song.setPlaybackPositionInTicks(0),this.setStatus("Stopped: "+this.song.data.title));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playlistNext",value:function(){var e=Object(g.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.playlistStop(),e.next=3,this.playlistMoveToNextSongEntry();case 3:return e.next=5,this.playlistPlay();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"playlistMovePosition",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getEntry(t,!1);case 2:return e.sent||(t=0),e.next=6,this.setPlaylistPosition(t);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playlistMoveToEntry",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getEntryPosition(t);case 2:return n=e.sent,e.next=5,this.playlistMovePosition(n);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"playlistMoveToNextSongEntry",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getCurrentEntryPosition(),e.next=3,this.getEntry(t);case 3:if(n=e.sent,!this.isPlaylist(n.url)||!0===n.open){e.next=7;break}return e.next=7,this.togglePlaylistEntry(n);case 7:return e.next=9,this.getPlaylistCount();case 9:r=e.sent,a=0;case 11:if(!(a<r)){e.next=31;break}return t++,e.next=15,this.getEntry(t);case 15:if(o=e.sent,!this.isPlaylist(o.url)){e.next=24;break}return e.next=19,this.togglePlaylistEntry(o);case 19:return e.next=21,this.getPlaylistCount();case 21:r=e.sent,e.next=28;break;case 24:return t>=r&&(t=0),e.next=27,this.setPlaylistPosition(t);case 27:return e.abrupt("return");case 28:a++,e.next=11;break;case 31:throw new Error("Song entry not found");case 32:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getPlaylistCount",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=0,e.next=3,this.eachEntry((function(e,n){return t=n+1}));case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setPlaylistPosition",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t!==this.state.playlist.position&&(this.state.playlist.position=t,this.playlist.forceUpdate());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setPositionEntry",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findEntryPosition(t);case 2:return n=e.sent,e.next=5,this.setPlaylistPosition(n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isPlaylist",value:function(e){return e&&e.toString().toLowerCase().endsWith(".pl.json")}},{key:"parseEntryData",value:function(e){if("string"===typeof e){var t=e.split(";");e={url:t[0]},t[1]&&(e.name=t[1]),t[2]&&(e.length=t[2])}if(!e.url)throw new Error("Invalid ASPPlaylist Entry URL");return e.name||(e.name="../"+e.url.split("/").pop()),e}},{key:"setSongPositionPercentage",value:function(e){var t=e/100*this.state.songLength;return this.setSongPosition(t)}},{key:"setSongPosition",value:function(e){if(!this.song)throw new Error("No song loaded");this.song.setPlaybackPosition(e)}},{key:"playlistPlayTest",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.playlist.getCurrentEntry();case 2:t=e.sent;case 3:if(!t){e.next=12;break}return(t.scrollIntoViewIfNeeded||t.scrollIntoView).apply(t),e.next=7,new Promise((function(e,t){setTimeout(e,1e3)}));case 7:return e.next=9,this.playlistMoveToNextSongEntry();case 9:t=e.sent,e.next=3;break;case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"togglePanelPlaylist",value:function(e){this.classList.toggle("hide-panel-playlist")}},{key:"togglePanelSong",value:function(e){this.classList.toggle("hide-panel-song")}},{key:"toggleFullscreen",value:function(e){var t=!this.classList.contains("fullscreen");this.classList.toggle("fullscreen",t)}},{key:"openFileDialog",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,e.next=3,new Promise((function(e,n){var r=document.createElement("input");r.setAttribute("type","file"),t&&r.setAttribute("accept",t),r.addEventListener("change",(function(){var t=r.files[0];t?e(t):n()})),r.click()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"openMenu",value:function(e,t){if(!this.state.portrait){if("function"===typeof e.openMenu)return void e.openMenu(e,t);console.warn("Menu.openMenu was triggered from a non-Menu element class")}console.log(this.header),this.header.current.openMenu(e,t)}},{key:"renderRootMenu",value:function(){var e=this,t={vertical:!this.state.portrait};return this.state.portrait||(t.arrow=!1),a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,Object.assign({},t,{options:function(t){return e.renderFileMenu(t)}}),"File"),a.a.createElement(b.i,Object.assign({},t,{options:function(t){return e.renderPlaylistMenu(t)}}),"Playlist"),a.a.createElement(b.i,Object.assign({},t,{options:function(t){return e.renderViewMenu(t)}}),"View"))}},{key:"renderFileMenu",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{options:function(t){return e.renderFileMemoryMenu(t)}},"Load from Memory"),a.a.createElement(b.g,{onAction:function(t){return e.openSongFromFileDialog(t)}},"Load from File"),a.a.createElement(b.g,{onAction:function(e){},disabled:!0},"Load from URL"),a.a.createElement(b.g,{onAction:function(e){},disabled:!0},"Load from Library"))}},{key:"renderFileMemoryMenu",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new k.a,e.next=3,t.getRecentSongList();case 3:return n=e.sent,e.abrupt("return",n.length>0?n.map((function(e,t){return a.a.createElement(b.g,{key:t,onAction:function(t){return r.loadSongFromMemory(e.uuid)}},e.name||e.uuid)})):a.a.createElement(b.g,{key:"no-recent",disabled:!0,onAction:function(e){}},"No Songs Available"));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"renderPlaylistMenu",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{key:"next",onAction:function(t){return e.playlistNext(t)}},"Load from Memory"),a.a.createElement(b.g,{key:"clear",onAction:function(t){return e.clearPlaylist(t)}},"Load from File"))}},{key:"renderViewMenu",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{key:"fullscreen",onAction:function(t){return e.toggleFullscreen(t)}},this.state.fullscreen?"Disable":"Enable"," Fullscreen"),a.a.createElement(b.g,{key:"hide-panel-song",onAction:function(t){return e.togglePanelSong(t)}},this.state.showPanelSong?"Show":"Hide"," Song Forms"),a.a.createElement(b.g,{key:"hide-panel-playlist",onAction:function(t){return e.togglePanelPlaylist(t)}},this.state.showPanelPlaylist?"Show":"Hide"," Playlist"))}}]),t}(function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(s.a)(this,t),(e=Object(c.a)(this,Object(l.a)(t).call(this,r))).state={title:"Audio Source Player",status:"[No Song Loaded]",version:n(80).version,menuKey:"root",fullscreen:!1,portrait:!0,showPanelSong:!0,showPanelPlaylist:!0},e.playlist=null,e.footerVersionText=a.a.createRef(),e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this;return a.a.createElement(b.c,{className:["asp-container",this.state.portrait?"portrait":"landscape"].join(" ")},a.a.createElement(b.j,{isActive:this.state.portrait},a.a.createElement(b.c,{key:"header",className:"asp-title-container"},a.a.createElement(x,{title:this.state.title,portrait:this.state.portrait,menuContent:function(){return e.renderRootMenu()}})),a.a.createElement(b.c,{className:"asp-forms-container"},a.a.createElement(b.k,{className:"song",header:"Song"},a.a.createElement(b.d,{className:"playback",header:"Playback"},a.a.createElement(b.a,{className:"song-play",onAction:function(t){return e.playlistPlay(t)}},a.a.createElement(b.e,{source:"play"})),a.a.createElement(b.a,{className:"song-pause",onAction:function(t){return e.playlistPause(t)}},a.a.createElement(b.e,{source:"pause"})),a.a.createElement(b.a,{className:"song-stop",onAction:function(t){return e.playlistStop(t)}},a.a.createElement(b.e,{source:"stop"})),a.a.createElement(b.a,{className:"song-next",onAction:function(t){return e.playlistNext(t)}},a.a.createElement(b.e,{source:"next"}))),a.a.createElement(b.d,{className:"file",header:"File"},a.a.createElement(b.a,{className:"file-load",onAction:function(t){return e.loadSongFromFileInput(t)},accept:".json,.mid,.midi",ref:function(t){return e.fieldSongFileLoad=t},title:"Load Song from File"},a.a.createElement(b.e,{source:"file-load"})),a.a.createElement(b.a,{className:"file-save",onAction:function(t){return e.saveSongToFile(t)},title:"Save Song to File"},a.a.createElement(b.e,{source:"file-save"}))),a.a.createElement(b.d,{className:"volume",header:"Volume"},a.a.createElement(b.f,{className:"volume",onChange:function(t,n){return e.setVolume(n/100)},value:this.state.volume,min:1,max:100,ref:function(t){return e.fieldSongVolume=t},title:"Song Volume"})),a.a.createElement(b.d,{className:"position",header:"Position"},a.a.createElement(b.f,{className:"position",onChange:function(t,n){return e.setSongPosition(n)},value:0,min:0,max:Math.ceil(this.state.songLength)||1,ref:function(t){return e.fieldSongPosition=t},title:"Song Position"})),a.a.createElement(b.d,{className:"timing",header:"Timing"},a.a.createElement(b.a,{className:"timing",onAction:function(t){return e.setSongPositionPrompt()},ref:function(t){return e.fieldSongTiming=t},title:"Song Timing",children:"00:00:000"})),a.a.createElement(b.d,{className:"name",header:"Name"},a.a.createElement(b.a,{className:"name",onAction:function(t){return e.setSongNamePrompt()},title:"Song Name",children:this.song?this.song.data.title:"no song loaded"})),a.a.createElement(b.d,{className:"version",header:"Version"},a.a.createElement(b.a,{className:"version",onAction:function(t){return e.setSongVersionPrompt()},ref:function(t){return e.fieldSongVersion=t},title:"Song Version",children:this.song?this.song.data.version:"0.0.0"})),a.a.createElement(b.d,{className:"source",header:"Source"},a.a.createElement(b.a,{className:"source",onAction:function(t,n){return e.openSongSource(t,n)},title:"Song Source"},a.a.createElement(b.e,{source:"source"})))),a.a.createElement(b.k,{className:"playlist",header:"Playlist",styleContainer:{}},a.a.createElement(_,{player:this,ref:function(t){return e.playlist=t}}))),a.a.createElement(b.c,{key:"footer",className:"asp-footer-container"},a.a.createElement(b.c,{className:"asp-status-text"},this.state.status),a.a.createElement(b.c,{className:"asp-version-text",ref:this.footerVersionText},this.state.version))))}}]),t}(S))),D=n(10),I=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return Object(s.a)(this,t),(e=Object(c.a)(this,Object(l.a)(t).call(this,n))).state.playlist={entries:[],position:0},e.state.volume=D.f.DEFAULT_VOLUME,e.state.songLength=0,e.state.playlistActive=!1,e.state.playing=!1,e.state.paused=!1,e.audioContext=null,e.volumeGain=null,e.song=null,e.onResizeCallback=function(t){return e.onResize(t)},e}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(e){var t=this.props.src||this.props.url;t?this.loadURLAsPlaylist(t):this.loadState(),window&&window.addEventListener("resize",this.onResizeCallback)}},{key:"componentWillUnmount",value:function(){window&&window.removeEventListener("resize",this.onResizeCallback),this.saveState()}},{key:"onResize",value:function(){var e=window.innerWidth/window.innerHeight,t=e<.875;!this.state.portrait===t&&(console.log("Setting portrait mode to ",t,". Aspect ratio: ",e),this.setState({portrait:t}))}},{key:"disconnectedCallback",value:function(){Object(v.a)(Object(l.a)(t.prototype),"disconnectedCallback",this).call(this),this.saveState()}},{key:"loadState",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new k.a,e.next=3,t.loadState("audio-source-player-state");case 3:n=e.sent,console.log("loadState",n),n&&this.setState(n);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveState",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state,n=new k.a,e.next=4,n.saveState(t,"audio-source-player-state");case 4:console.log("saveState",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggleFullscreen",value:function(e){var t=!this.classList.contains("fullscreen");this.containerElm.classList.toggle("fullscreen",t),this.classList.toggle("fullscreen",t)}},{key:"onSongEvent",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="log"===e.t0?3:"song:seek"===e.t0?5:"song:volume"===e.t0?7:"song:play"===e.t0?9:"song:pause"===e.t0?18:"song:end"===e.t0?20:22;break;case 3:return this.setStatus(t.detail),e.abrupt("break",24);case 5:return this.updateSongPositionValue(t.detail.position),e.abrupt("break",24);case 7:return this.fieldSongVolume.value=t.detail.volume,e.abrupt("break",24);case 9:if(this.containerElm.classList.add("playing"),!t.playback){e.next=14;break}return e.next=13,t.playback.waitForPlaybackToEnd();case 13:this.containerElm.classList.remove("playing");case 14:return this.setState({playing:!0,paused:!1}),this.updateSongPositionMaxLength(this.song.getSongLengthInSeconds()),n=setInterval((function(e){r.song.isPlaying||(clearInterval(n),r.setState({playing:!1,paused:!1})),r.updateSongPositionValue(r.song.getSongPlaybackPosition())}),10),e.abrupt("break",24);case 18:return this.setState({paused:!0}),e.abrupt("break",24);case 20:return this.setState({playing:!1,paused:!1}),e.abrupt("break",24);case 22:return console.log("Unknown song event: ",t.type),e.abrupt("break",24);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onInput",value:function(e){if(!e.defaultPrevented)switch(e.type){case"click":break;case"dragover":e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy";break;case"drop":e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;this.loadSongFromFileInput(t[0]),console.log(t);break;default:console.log("Unknown input event: ",e.type)}}},{key:"values",get:function(){return new D.g(this.song)}}]),t}(O);I.DEFAULT_VOLUME=.3;var C=I,M=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(Object(s.a)(this,e),null===n&&(n=t.state.selectedTrack),!t.state.activeTracks.hasOwnProperty(n))throw new Error("Invalid track: ".concat(n));this.composer=t,this.trackName=n,this.state=t.state.activeTracks[n]}return Object(u.a)(e,[{key:"update",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.composer.updateState((function(e){return"function"===typeof t&&t(e.activeTracks[n.trackName]),e}));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"timeDivision",get:function(){return this.state.timeDivision||this.composer.song.data.timeDivision}},{key:"quantizationTicks",get:function(){return this.state.quantizationTicks||this.timeDivision}},{key:"beatsPerMinute",get:function(){return this.state.beatsPerMinute||this.composer.song.data.beatsPerMinute}},{key:"beatsPerMeasure",get:function(){return this.state.beatsPerMeasure||this.composer.song.data.beatsPerMeasure||e.DEFAULT_BEATS_PER_MEASURE}},{key:"programID",get:function(){return this.state.programID}},{key:"selectedIndices",get:function(){return this.state.selectedIndices||[]}},{key:"cursorOffset",get:function(){return this.state.cursorOffset||0}},{key:"playingIndices",get:function(){return this.state.playingIndices||[]}},{key:"currentCommand",get:function(){return this.state.currentCommand||"C4"}},{key:"currentDuration",get:function(){return this.state.currentDuration||"1B"}},{key:"currentVelocity",get:function(){return this.state.currentVelocity||null}},{key:"destinationList",get:function(){return this.state.destinationList||[]}},{key:"rowLength",get:function(){return this.state.rowLength||e.DEFAULT_ROW_LENGTH}},{key:"rowOffset",get:function(){return this.state.rowOffset||0}},{key:"trackLengthTicks",get:function(){return this.state.trackLengthTicks||null}},{key:"segmentLengthTicks",get:function(){return this.state.segmentLengthTicks||this.timeDivision*e.DEFAULT_BEATS_PER_SEGMENT}},{key:"segmentPositions",get:function(){return this.state.segmentPositions||[0]}},{key:"startPosition",get:function(){return this.state.startPosition||0}}]),e}();M.DEFAULT_ROW_LENGTH=16,M.DEFAULT_BEATS_PER_SEGMENT=16,M.DEFAULT_BEATS_PER_MEASURE=4;n(143),n(144);var j=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).dropdown=r.createRef(),n.cb={onContextMenu:function(e){return n.onContextMenu(e)},onKeyDown:function(e){return n.onKeyDown(e)}},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e="asct-parameter";return this.props.className&&(e+=" "+this.props.className),r.createElement("div",{onKeyDown:this.cb.onKeyDown,onContextMenu:this.cb.onContextMenu,className:e,title:this.props.title},this.props.children,r.createElement(P.a,{ref:this.dropdown,options:this.props.options,vertical:this.props.vertical}))}},{key:"toggleMenu",value:function(){return this.dropdown.current.toggleMenu()}},{key:"onKeyDown",value:function(e){if(!e.isDefaultPrevented())switch(e.key){case"ContextMenu":e.preventDefault(),this.toggleMenu();break;default:console.info("Unhandled key: ",e.key)}}},{key:"onContextMenu",value:function(e){e.defaultPrevented||e.shiftKey||(e.preventDefault(),this.toggleMenu())}},{key:"onMouseEnter",value:function(e){this.toggleMenu()}},{key:"selectInstruction",value:function(){this.props.trackerInstruction.selectInstruction()}}]),t}(r.Component);j.defaultProps={vertical:!0};var T=j,A=n(34),F=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"getTracker",value:function(){return this.props.tracker}},{key:"getComposer",value:function(){return this.getTracker().props.composer}},{key:"getSong",value:function(){return this.getComposer().getSong()}},{key:"getInstruction",value:function(){return this.props.instruction}},{key:"getInstructionIndex",value:function(){return this.props.index}},{key:"render",value:function(){return null}},{key:"renderParameters",value:function(){var e=this,t=this.props.instruction,n=this.props.cursor||this.props.selected,a=[];if(a.push(r.createElement(T,{key:"command",title:"Command: ".concat(t.command),trackerInstruction:this,className:"command",options:function(){return e.renderMenuSelectCommand()},ref:this.commandParam},t.command)),n){var o=null===t.durationTicks?"N/A":this.getComposer().values.formatSongDuration(t.durationTicks);"undefined"!==typeof t.velocity&&a.push(r.createElement(T,{key:"velocity",title:"Velocity: ".concat(t.velocity),trackerInstruction:this,className:"velocity",options:function(){return e.renderMenuSelectVelocity(t.velocity)}},t.velocity)),"undefined"!==typeof t.durationTicks&&a.push(r.createElement(T,{key:"duration",title:"Duration: ".concat(o),trackerInstruction:this,className:"duration",options:function(){return e.renderMenuSelectDuration(t.durationTicks)}},o||"-"))}return a}},{key:"playInstruction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getTracker().getTrackInfo().updateCurrentInstruction(),this.getTracker().playInstructions(this.getInstructionIndex(),e)}},{key:"selectInstruction",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],n=o.length>1&&void 0!==o[1]?o[1]:null,r=t?[]:this.getTracker().getTrackState().selectedIndices,a=r.indexOf(this.props.index),!0===n||-1===a?-1===a&&r.push(this.props.index):-1!==a&&r.splice(a,1),e.next=7,this.getTracker().setCursorOffset(this.props.cursorPosition,r);case 7:return e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"selectInstructionWithAction",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(o.length>0&&void 0!==o[0])||o[0],n=o.length>1&&void 0!==o[1]?o[1]:null,e.next=4,this.selectInstruction(t,n);case 4:r=e.sent,(a=this.getInstruction())instanceof A.default?this.getComposer().trackerToggleTrack(a.getTrackName(),null,{destinationList:this.getTracker().getTrackState().destinationList.concat(this.getTracker().getTrackName())}):this.getTracker().playInstructions(r);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onMouseInput",value:function(e){if(!e.defaultPrevented)switch(e.preventDefault(),e.type){case"mousedown":case"click":if(0!==e.button)throw 1===e.button?new Error("Unimplemented middle button"):2===e.button?new Error("Unimplemented right button"):new Error("Unknown mouse button");this.selectInstructionWithAction(!e.ctrlKey);break;default:throw new Error("Unknown Mouse event: "+e.type)}}},{key:"renderMenuSelectCommand",value:function(e){var t=this;return this.getComposer().renderMenuSelectCommand((function(e){t.instructionReplaceCommand(e)}))}},{key:"renderMenuSelectVelocity",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getComposer().renderMenuSelectVelocity((function(t){e.instructionReplaceVelocity(t)}),t)}},{key:"renderMenuSelectDuration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getComposer().renderMenuSelectDuration((function(t){e.instructionReplaceDuration(t)}),t)}},{key:"instructionReplaceCommand",value:function(e){this.getComposer().instructionReplaceCommandSelected(e,this.getComposer().state.selectedTrack,this.props.index)}},{key:"instructionReplaceVelocity",value:function(e){this.getSong().instructionReplaceVelocity(this.getComposer().state.selectedTrack,this.props.index,e),this.playInstruction()}},{key:"instructionReplaceDuration",value:function(e){this.getSong().instructionReplaceDuration(this.getComposer().state.selectedTrack,this.props.index,e),this.playInstruction()}}]),t}(r.Component);F.defaultProps={};n(145);var N=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).cb={onMouseInput:function(e){return n.onMouseInput(e)}},n.commandParam=r.createRef(),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t="asct-instruction";this.props.cursor&&(t+=" cursor"),this.props.selected&&(t+=" selected"),this.props.playing&&(t+=" playing");var n=this.renderParameters();return r.createElement("div",{ref:function(t){return e.props.cursor&&e.getTracker().props.selected&&t&&t.focus()},tabIndex:0,className:t,onKeyDown:this.cb.onKeyDown,onMouseDown:this.cb.onMouseInput},n)}}]),t}(F),R=(n(146),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"asct-position"},this.props.positionTicks)}}]),t}(r.Component)),L=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"asct-instruction-add"},"+")}}]),t}(r.Component),B=(n(147),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.createElement("div",{className:"asct-delta"},this.props.duration)}}]),t}(r.Component)),U=n(37),z=(n(148),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).dropdown=r.createRef(),n.cb={onContextMenu:function(e){return n.onContextMenu(e)},onKeyDown:function(e){return n.onKeyDown(e)},onMouseInput:function(e){return n.onMouseInput(e)}},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"getTracker",value:function(){return this.props.tracker}},{key:"getComposer",value:function(){return this.getTracker().getComposer()}},{key:"render",value:function(){var e=this,t="asct-row";this.props.highlight&&(t+=" ".concat(this.props.highlight));var n=this.props.tracker.getComposer().values.formatSongDuration(this.props.deltaDuration);return r.createElement("div",{ref:function(t){return e.props.cursor&&e.getTracker().props.selected&&t&&t.focus()},tabIndex:0,className:t,onMouseDown:this.cb.onMouseInput,onKeyDown:this.cb.onKeyDown},r.createElement(R,{positionTicks:this.props.positionTicks}),this.props.children,this.props.cursor?r.createElement(L,{cursorPosition:this.props.cursorPosition}):null,r.createElement(B,{duration:n}),r.createElement(U.a,{ref:this.dropdown,options:this.props.options,vertical:this.props.vertical}))}},{key:"toggleMenu",value:function(){return this.dropdown.current.toggleMenu()}},{key:"selectRow",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!(n.length>0&&void 0!==n[0])||n[0],e.next=3,this.getTracker().setCursorOffset(this.props.cursorPosition,t?[]:null);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onMouseInput",value:function(e){if(!e.defaultPrevented)switch(e.preventDefault(),e.type){case"mousedown":case"click":if(0===e.button)this.selectRow(!e.ctrlKey);else{if(1===e.button)throw new Error("Unimplemented middle button");if(2!==e.button)throw new Error("Unknown mouse button");this.toggleMenu()}break;default:throw new Error("Unknown Mouse event: "+e.type)}}},{key:"onContextMenu",value:function(e){e.defaultPrevented||e.shiftKey||(e.preventDefault(),this.toggleMenu())}},{key:"onKeyDown",value:function(e){if(!e.isDefaultPrevented())switch(e.key){case"ContextMenu":e.preventDefault(),this.toggleMenu()}}}]),t}(r.Component));z.defaultProps={};var V=z,G=function(e){function t(e){var n;if(Object(s.a)(this,t),n=Object(c.a)(this,Object(l.a)(t).call(this,e)),!e.composer)throw new Error("Invalid composer");return n.cb={onKeyDown:function(e){return n.onKeyDown(e)},onWheel:function(e){return n.onWheel(e)}},n.destination=null,n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"getDestination",value:function(){return this.destination?this.destination:(console.warn("TODO: calculate correct destination"),this.destination=this.getComposer().getAudioContext())}},{key:"getComposer",value:function(){return this.props.composer}},{key:"getSong",value:function(){return this.props.composer.song}},{key:"getTrackName",value:function(){return this.props.trackName}},{key:"getTrackState",value:function(){return new M(this.props.composer,this.props.trackName)}},{key:"trackerGetCursorInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.getComposer().trackerGetCursorInfo(this.getTrackName(),e)}},{key:"instructionGetQuantizedIterator",value:function(){var e=this.getTrackState();return this.getSong().instructionGetQuantizedIterator(this.getTrackName(),e.quantizationTicks,e.timeDivision,e.beatsPerMinute)}},{key:"getSegmentInfo",value:function(){}},{key:"setCursorOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null===t){var r=this.trackerGetCursorInfo(e),a=r.cursorIndex;t=[],null!==a&&(t=[a])}return this.selectIndices(t,e,n)}},{key:"selectIndices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this.getComposer().trackerSelectIndices(this.getTrackName(),e,t,n)}},{key:"renderRowContent",value:function(){for(var e=this,t=this.getTrackState(),n=this.getComposer().state.songPosition-t.startPosition,a=!1,o=t.selectedIndices,i=t.playingIndices,s=t.beatsPerMeasure*t.timeDivision,u=t.quantizationTicks,c=this.getSong().instructionGetQuantizedIterator(this.getTrackName(),u,t.timeDivision,t.beatsPerMinute),l=[],f=[];c.nextQuantizedInstructionRow((function(){var o=!1;if(c.positionTicks%s===0&&(o="measure-start"),!a&&n<=c.positionSeconds&&(a=!0,o="position"),!(c.rowCount<t.rowOffset)){var i=c.getNextRowPositionTicks()-c.positionTicks;(i<=0||i>u)&&console.warn("rowDeltaDuration is ",i);var h=r.createElement(V,{key:c.rowCount,tracker:e,positionTicks:c.positionTicks,positionSeconds:c.positionSeconds,deltaDuration:i,cursorPosition:c.cursorPosition,cursor:c.cursorPosition===t.cursorOffset,highlight:o},f);l.push(h),f=[]}}),(function(n){if(!(c.rowCount<t.rowOffset)){var a=c.currentIndex;f.push(r.createElement(N,{key:a,index:a,instruction:n,tracker:e,cursorPosition:c.cursorPosition,cursor:c.cursorPosition===t.cursorOffset,selected:-1!==o.indexOf(a),playing:-1!==i.indexOf(a)}))}}))&&!(l.length>=t.rowLength););return l}},{key:"renderRowSegments",value:function(){for(var e=this,n=this.props.composer,a=this.getTrackState(),o=a.rowOffset,i=a.rowLength,s=[],u=null,c=a.segmentPositions,l=function(a){if(a>t.DEFAULT_MAX_SEGMENTS)return"break";var l=c[a],f={onAction:function(t){return n.trackerSetRowOffset(e.props.trackName,l)},children:a};null===u&&o-i<l&&(u=a,f.selected=!0),s.push(r.createElement(b.a,Object.assign({key:a},f)))},f=0;f<c.length;f++){if("break"===l(f))break}var h=n.values.formatSongDuration(a.quantizationTicks);return s.push(r.createElement(b.b,{className:"row-quantization",title:"Quantization (Duration = ".concat(h,")"),arrow:"\u25bc",key:"row-quantization",options:function(){return e.getComposer().renderMenuTrackerSetQuantization(e.getTrackName())},children:h})),s}},{key:"renderRowOptions",value:function(){var e=this,t=[],n=this.getTrackState().rowLength;return t.push(r.createElement(b.b,{className:"row-length",title:"Segment Length (".concat(n," Rows)"),arrow:"\u25bc",key:"row-length",options:function(){return e.getComposer().renderMenuTrackerSetSegmentLength(e.getTrackName())},children:"".concat(n," Rows")})),t}},{key:"playSelectedInstructions",value:function(){return this.playInstructions(this.getTrackState().selectedIndices)}},{key:"playInstructions",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getComposer().trackerPlay(this.getTrackName(),e,t)}},{key:"onWheel",value:function(e){e.preventDefault();var t=this.getTrackState().rowOffset;(t+=e.deltaY>0?1:-1)<0&&(t=0),this.getComposer().trackerSetRowOffset(this.getTrackName(),t)}},{key:"onKeyDown",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o,i,s,u,c,l,f;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isDefaultPrevented()){e.next=2;break}return e.abrupt("return");case 2:e.t0=t.key,e.next="Delete"===e.t0?5:"Enter"===e.t0?7:" "===e.t0?9:"Play"===e.t0?9:"ArrowRight"===e.t0?11:"ArrowLeft"===e.t0?16:"ArrowUp"===e.t0?20:"ArrowDown"===e.t0?24:"ContextMenu"===e.t0?29:32;break;case 5:return this.getComposer().instructionDeleteSelected(),e.abrupt("break",45);case 7:return this.getComposer().instructionInsert(),e.abrupt("break",45);case 9:return this.getComposer().songPlay(),e.abrupt("break",45);case 11:return r=this.trackerGetCursorInfo(),a=r.nextOffset,t.preventDefault(),n=this.setCursorOffset(a),this.playInstructions(n),e.abrupt("break",45);case 16:return t.preventDefault(),o=this.trackerGetCursorInfo(),(i=o.previousOffset)>=0&&(n=this.setCursorOffset(i),this.playInstructions(n)),e.abrupt("break",45);case 20:return t.preventDefault(),s=this.trackerGetCursorInfo(),(u=s.previousRowOffset)>=0&&(n=this.setCursorOffset(u),this.playInstructions(n)),e.abrupt("break",45);case 24:return t.preventDefault(),c=this.trackerGetCursorInfo(),l=c.nextRowOffset,n=this.setCursorOffset(l),this.playInstructions(n),e.abrupt("break",45);case 29:return t.preventDefault(),this.cursorInstruction.current.toggleMenu(),e.abrupt("break",45);case 32:if(!(f=this.getComposer().keyboard.getKeyboardCommand(t.key,this.getComposer().state.keyboardOctave))){e.next=43;break}if(!(this.getTrackState().selectedIndices.length>0)){e.next=40;break}return e.next=38,this.getComposer().instructionReplaceCommandSelected(f);case 38:e.next=42;break;case 40:return e.next=42,this.getComposer().instructionInsert(f);case 42:return e.abrupt("return");case 43:return console.info("Unhandled key: ",t.key),e.abrupt("break",45);case 45:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(r.Component);G.defaultProps={},G.DEFAULT_MAX_SEGMENTS=8,G.DEFAULT_MIN_SEGMENTS=3;var q=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).container=r.createRef(),n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){this.container.current.addEventListener("wheel",this.cb.onWheel,{passive:!1})}},{key:"componentWillUnmount",value:function(){this.container.current.removeEventListener("wheel",this.cb.onWheel)}},{key:"render",value:function(){var e="asc-track";return this.props.selected&&(e+=" selected"),r.createElement(b.k,{className:e,header:this.getTrackName(),title:"Track: ".concat(this.getTrackName())},r.createElement("div",{className:"asct-segments",children:this.renderRowSegments()}),r.createElement("div",{className:"asct-container",ref:this.container,tabIndex:0,onKeyDown:this.cb.onKeyDown},this.renderRowContent()),r.createElement("div",{className:"asct-options",children:this.renderRowOptions()}))}}]),t}(G),K=n(11),W=n(13),H=(n(149),function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.getSong(),n=this.props.programID,r=t.programGetData(n),o=(n<10?"0":"")+n,i="";return i=t.hasProgram(n)?r.title||"No Title":"Empty",a.a.createElement(b.c,{className:"asc-instrument-renderer-empty"},a.a.createElement(b.c,{className:"header"},a.a.createElement(b.a,{className:"toggle-container",onAction:function(t){return e.toggleContainer()}},o,": ",i),a.a.createElement(b.b,{arrow:!1,className:"program-config",options:function(){return e.renderMenuRoot()}},a.a.createElement(b.e,{source:"config"}))),this.state.open?a.a.createElement(b.c,{className:"content"},this.renderProgramContent()):null)}}]),t}(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).state={open:!0},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"getComposer",value:function(){return this.props.composer}},{key:"getSong",value:function(){return this.getComposer().getSong()}},{key:"renderProgramContent",value:function(){try{return this.getSong().programLoadRenderer(this.props.programID)}catch(e){return e.message}}},{key:"toggleContainer",value:function(){this.setState({open:!this.state.open})}},{key:"loadPreset",value:function(e,t){console.log("Loading preset: ",e,t);var n=this.getSong(),r=this.props.programID;n.programReplace(r,e,t)}},{key:"renderMenuRoot",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{options:function(){return e.renderMenuChangePreset()}},"Change Preset"),a.a.createElement(b.h,null),a.a.createElement(b.i,{options:function(){return e.renderMenuChangeProgram()}},"Change Program"),a.a.createElement(b.g,{onAction:function(t){return e.programRename()}},"Rename Program"),a.a.createElement(b.g,{onAction:function(t){return e.programRemove()}},"Remove Program"))}},{key:"renderMenuChangeProgram",value:function(){var e=this;return D.c.loadDefault().renderMenuProgramAll((function(t){var n=Object(w.a)(t,2),r=n[0],a=n[1];e.loadPreset(r,a)}))}},{key:"renderMenuChangePreset",value:function(){var e=this,t=D.c.loadDefault(),n=this.props.programID,r=this.getSong().programGetClassName(n);return t.renderMenuProgramAllPresets((function(t,n){e.loadPreset(t,n)}),r)}},{key:"programReplace",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.props.programID;this.getSong().programReplace(r,t,n)}},{key:"programRename",value:function(){var e=this.props.programID;this.getComposer().programRename(e)}},{key:"programRemove",value:function(){var e=this.props.programID;this.getSong().programRemove(e)}}]),t}(a.a.Component))),Q=n(62),Y=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.props.composer.state;return a.a.createElement("div",{className:["asc-container",e.portrait?"portrait":"landscape"].join(" ")},a.a.createElement(Q.a,{isActive:this.props.portrait},this.renderHeader(),this.props.children,this.renderFooter()))}},{key:"renderHeader",value:function(){if(this.props.portrait)return[a.a.createElement("div",{key:"title",className:"asp-title-text"},this.props.title),a.a.createElement(P.d,{key:"menu-button",arrow:!1,className:"asp-menu-button-toggle",options:this.props.menuContent},a.a.createElement(b.e,{source:"menu"})),this.props.children];var e=this.props.menuContent;return"function"===typeof e&&(e=e()),[a.a.createElement("div",{key:"title",className:"asp-title-text"},this.props.title),a.a.createElement("div",{className:"asp-menu-container"},e)]}},{key:"renderFooter",value:function(){var e=this.props.composer.state;return a.a.createElement("div",{key:"footer",className:"asp-footer-container"},a.a.createElement("div",{className:"asp-status-text"},e.status),a.a.createElement("div",{className:"asp-version-text",ref:this.footerVersionText},e.version))}}]),t}(a.a.Component),J=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).state={title:"Audio Source Composer",status:"[No Song Loaded]",version:n(80).version,menuKey:"root",portrait:!0,fullscreen:!1,showPanelSong:!0,showPanelPlaylist:!0,volume:D.f.DEFAULT_VOLUME,playing:!1,paused:!1,songUUID:null,songLength:0,songPosition:0,selectedTrack:"root",activeTracks:{root:{currentCommand:"C4",currentVelocity:null,currentDuration:"1B"}},keyboardOctave:4},r.timeouts={saveSongToMemory:null,renderPrograms:null},r.autoSaveTimeout=4e3,r.keyboard=new D.b,r.library=D.c.loadDefault(),console.log("library",r.library),r.song=new D.f,r.audioContext=null,r.lastVolumeGain=null,r.onSongEventCallback=function(e){return r.onSongEvent(e)},r}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){Object(v.a)(Object(l.a)(t.prototype),"componentDidMount",this).call(this),this.loadState()}},{key:"onSongEvent",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="log"===e.t0?3:"track:start"===e.t0?5:"track:end"===e.t0?5:"instruction:play"===e.t0?6:"instruction:stop"===e.t0?6:"song:seek"===e.t0?10:"song:volume"===e.t0?12:"song:loaded"===e.t0?14:"song:play"===e.t0?15:"song:pause"===e.t0?18:"song:end"===e.t0?20:"programs:instance"===e.t0?22:"programs:added"===e.t0?22:"programs:removed"===e.t0?22:"programs:modified"===e.t0?24:"song:modified"===e.t0?28:"programs:library"===e.t0?32:34;break;case 3:return this.setStatus(t.detail),e.abrupt("break",35);case 5:return e.abrupt("break",35);case 6:return n=new M(this,t.trackStats.trackName),e.next=9,n.update((function(e){e.playingIndices=t.playingIndices}));case 9:return e.abrupt("break",35);case 10:return this.updateSongPositionValue(t.position),e.abrupt("break",35);case 12:return this.fieldSongVolume.value=t.detail.volume,e.abrupt("break",35);case 14:return e.abrupt("break",35);case 15:return this.setState({playing:!0}),r=setInterval((function(e){a.song.isPlaying()||(clearInterval(r),a.setState({playing:!1,paused:!1})),a.updateSongPositionValue(a.song.getSongPlaybackPosition())}),10),e.abrupt("break",35);case 18:return this.setState({paused:!0}),e.abrupt("break",35);case 20:return this.setState({playing:!1,paused:!1}),e.abrupt("break",35);case 22:return this.panelPrograms&&this.panelPrograms.forceUpdate(),e.abrupt("break",35);case 24:return this.panelPrograms&&this.panelPrograms.forceUpdate(),clearTimeout(this.timeouts.saveSongToMemory),this.timeouts.saveSongToMemory=setTimeout((function(e){return a.saveSongToMemory(e)}),this.autoSaveTimeout),e.abrupt("break",35);case 28:return this.forceUpdate(),clearTimeout(this.timeouts.saveSongToMemory),this.timeouts.saveSongToMemory=setTimeout((function(e){return a.saveSongToMemory(e)}),this.autoSaveTimeout),e.abrupt("break",35);case 32:return this.updateForms(),e.abrupt("break",35);case 34:console.warn("Unknown song event: ",t.type);case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"values",get:function(){return new D.g(this.song)}}]),t}(function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).onResizeCallback=function(e){return n.onResize(e)},n.onUnloadCallback=function(e){return n.saveState(e)},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"onInput",value:function(e){if(!e.defaultPrevented)switch(e.type){case"focus":break;case"dragover":e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy";break;case"drop":e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;this.loadSongFromFileInput(t[0]);break;case"midimessage":switch(e.data[0]){case 144:throw e.preventDefault(),new Error("TODO: Implement")}break;default:throw new Error("Unhandled type: "+e.type)}}}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"loadMIDIInterface",value:function(e){navigator.requestMIDIAccess&&navigator.requestMIDIAccess().then((function(t){console.info("MIDI initialized",t);var n=[];t.inputs.forEach((function(t){n.push(t),t.addEventListener("midimessage",e)})),console.log("MIDI input devices detected: "+n.map((function(e){return e.name})).join(", "))}),(function(e){throw new Error("error initializing MIDI: "+e)}))}},{key:"setCurrentSong",value:function(e){if(!e instanceof D.f)throw new Error("Invalid Song object");return Object(v.a)(Object(l.a)(t.prototype),"setCurrentSong",this).call(this,e)}},{key:"getVolumeGain",value:function(e){if(!e||!e.context)throw new Error("Invalid destination");var t=e.context.createGain();return t.gain.value=null===this.volume?1:this.volume,t.connect(e),this.lastVolumeGain=t,t}},{key:"getAudioDestination",value:function(){return this.getAudioContext().destination}},{key:"getAudioContext",value:function(){if(this.audioContext)return this.audioContext;var e=new window.AudioContext;return this.audioContext=e,e}}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"setStatus",value:function(e){console.info.apply(null,arguments),this.setState({status:e})}},{key:"setError",value:function(e){this.setStatus(a.a.createElement(b.c,{className:"error"},e))}},{key:"setVersion",value:function(e){this.setState({version:e})}},{key:"getSong",value:function(){return this.song}},{key:"setCurrentSong",value:function(e){if(!e instanceof D.f)throw new Error("Invalid current song");this.song&&(this.setStatus("Unloading song: "+this.song.data.title),this.song.isPlaying()&&this.song.stopPlayback(),this.song.removeEventListener("*",this.onSongEventCallback),this.song.unloadAll()),this.song=e;this.song.addEventListener("*",this.onSongEventCallback),this.setState({status:"Loaded song: "+e.data.title,title:e.data.title,songUUID:e.data.uuid,songLength:e.getSongLengthInSeconds(),selectedTrack:e.getStartTrackName()||"root",activeTracks:{root:{}}}),this.trackerToggleTrack("track0",!0),this.trackerToggleTrack("track1",!0)}},{key:"updateCurrentSong",value:function(){this.setState({songLength:this.song.getSongLengthInSeconds()})}},{key:"onResize",value:function(){var e=window.innerWidth/window.innerHeight,t=e<.875;!this.state.portrait===t&&(console.log("Setting portrait mode to ",t,". Aspect ratio: ",e),this.setState({portrait:t}))}},{key:"loadState",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new D.h,e.next=3,t.loadState("audio-source-composer-state");case 3:n=e.sent,console.log("Loading State: ",n),n?("undefined"!==typeof n.volume&&this.setVolume(n.volume),delete n.volume,this.loadDefaultSong(n.songUUID),delete n.songUUID,this.setState(n),this.updateCurrentSong()):this.loadDefaultSong();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveState",value:function(e){(new D.h).saveState(this.state,"audio-source-composer-state"),console.log("Saving State: ",this.state)}},{key:"getVolume",value:function(){return this.state.volume}},{key:"setVolume",value:function(e){console.info("Setting volume: ",e),this.setState({volume:e}),this.lastVolumeGain&&(this.lastVolumeGain.gain.value=e)}},{key:"setSongNamePrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.a.openPromptDialog("Enter a new song name",this.song.data.title);case 2:t=e.sent,this.setSongName(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSongName",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if("string"!==typeof e)throw new Error("Invalid song title: "+e);this.song.data.title=e,this.setStatus("Song title updated: ".concat(e))}},{key:"setSongVersionPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.a.openPromptDialog("Enter a new song version",this.song.data.version);case 2:t=e.sent,this.setSongVersion(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSongVersion",value:function(e){if("string"!==typeof e)throw new Error("Invalid song version: "+e);this.song.data.version=e,this.setStatus("Song version updated: ".concat(e))}},{key:"songChangeStartingBeatsPerMinute",value:function(e){this.song.data.beatsPerMinute=e,this.setStatus("Song beats per minute updated: ".concat(e))}},{key:"openSongFromFileDialog",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:null,e.next=3,this.openFileDialog(n);case 3:r=e.sent,this.loadSongFromFileInput(t,r);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSongFromFileInput",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:null,r=o.length>2&&void 0!==o[2]?o[2]:null,null!==n){e.next=6;break}return e.next=5,this.openFileDialog(r);case 5:n=e.sent;case 6:if(n){e.next=8;break}throw new Error("Invalid file input");case 8:return e.next=10,D.f.loadSongFromFileInput(n);case 10:a=e.sent,this.setCurrentSong(a);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadDefaultSong",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=this.props.src||this.props.url;if(t)return this.loadSongFromURL(t),!0;if(e)try{return void this.loadSongFromMemory(e)}catch(n){console.error(n),this.setError("Error: "+n.message)}return this.loadNewSongData(),!1}},{key:"loadNewSongData",value:function(){var e=new D.f(this.audioContext);this.setCurrentSong(e),this.setStatus("Loaded new song",e.getProxiedData())}},{key:"loadRecentSongData",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new D.h,e.next=3,t.getRecentSongList();case 3:if(!(n=e.sent)[0]||!n[0].uuid){e.next=8;break}return this.setStatus("Loading recent song: "+n[0].uuid),this.loadSongFromMemory(n[0].uuid),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadSongFromMemory",value:function(e){var t=D.f.loadSongFromMemory(this.audioContext,e);this.setCurrentSong(t),this.setStatus("Song loaded from memory: "+e,this.song,this.state)}},{key:"loadSongFromURL",value:function(e){var t=D.f.loadSongFromURL(this.audioContext,e);this.setCurrentSong(t),this.setStatus("Loaded from url: "+e)}},{key:"saveSongToMemory",value:function(){var e=this.song,t=e.data,n=e.history,r=new D.h;this.setStatus("Saving song to memory..."),r.saveSongToMemory(t,n),this.setStatus("Saved song to memory: "+t.uuid)}},{key:"saveSongToFile",value:function(){var e=this.song.data,t=new D.h;this.setStatus("Saving song to file"),t.saveSongToFile(e)}},{key:"setSongPositionPercentage",value:function(e){var t=e/100*this.state.songLength;return this.setSongPosition(t)}},{key:"setSongPosition",value:function(e){if("string"===typeof e&&(e=K.a.parsePlaybackPosition(e)),isNaN(e))throw new Error("Invalid song position: "+e);this.setState({songPosition:e})}},{key:"setSongPositionPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=K.a.formatPlaybackPosition(this.state.songPosition||0),e.next=3,W.a.openPromptDialog("Set playback position:",t);case 3:t=e.sent,this.setSongPosition(t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateSongPositionValue",value:function(e){this.setState({songPosition:e})}},{key:"instructionInsertPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:null,n=a.length>1&&void 0!==a[1]?a[1]:null,a.length>2&&void 0!==a[2]&&a[2],r=new M(this,n),null===t&&(t=r.currentCommand),e.next=7,W.a.openPromptDialog("Set custom command:",t||"");case 7:return t=e.sent,e.abrupt("return",this.instructionInsert(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"instructionInsert",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t=t||this.state.selectedTrack;var n=new M(this,t),r=this.song;if(null===e&&(e=n.currentCommand),!e)throw new Error("Invalid Instruction command");var a=D.a.parseInstruction([0,e]);n.update((function(e){return e.currentCommand=a.command})).then(),n.currentDuration&&(a.durationTicks=r.values.parseDurationAsTicks(n.currentDuration)),n.currentVelocity&&(a.velocity=n.currentVelocity);var o=n.cursorPositionTicks,i=r.instructionInsertAtPosition(t,o,a);this.trackerSelectIndices(t,[i]),this.trackerPlay(t,[i])}},{key:"instructionReplaceCommandSelectedPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:null,n=r.length>1&&void 0!==r[1]?r[1]:null,null===t&&(t=this.state.activeTracks[this.state.selectedTrack].currentCommand),e.next=5,W.a.openPromptDialog("Set custom command:",t||"");case 5:return t=e.sent,e.abrupt("return",this.instructionReplaceCommandSelected(t,n));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"instructionReplaceCommandSelected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.song;t=t||this.state.selectedTrack;var a=new M(this,t);if(null===n&&(n=a.selectedIndices),0===n.length)throw new Error("No selection");if(!e)throw new Error("Invalid Instruction command");for(var o=0;o<n.length;o++)r.instructionReplaceCommand(t,n[o],e);this.trackerPlay(t,n)}},{key:"instructionReplaceDurationSelected",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o,i,s,u=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:null,n=u.length>1&&void 0!==u[1]?u[1]:null,r=u.length>2&&void 0!==u[2]?u[2]:null,a=u.length>3&&void 0!==u[3]&&u[3],o=this.song,n=n||this.state.selectedTrack,i=new M(this,n),null===r&&(r=i.selectedIndices),null!==t||!a){e.next=14;break}return e.t0=parseInt,e.next=12,W.a.openPromptDialog("Set custom duration in ticks:",t);case 12:e.t1=e.sent,t=(0,e.t0)(e.t1,10);case 14:if(t="string"===typeof t?K.a.parseDurationAsTicks(t,this.song.data.timeDivision):parseInt(t),!isNaN(t)){e.next=17;break}throw new Error("Invalid duration: "+typeof t);case 17:for(s=0;s<r.length;s++)o.instructionReplaceDuration(n,r[s],t);this.trackerPlay(n,r),this.setState((function(e){e.activeTracks[n].currentDuration=t}));case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"instructionReplaceVelocityPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:null,n=o.length>1&&void 0!==o[1]?o[1]:null,r=o.length>2&&void 0!==o[2]?o[2]:null,n=n||this.state.selectedTrack,a=new M(this,n),e.t0=parseInt,e.next=8,W.a.openPromptDialog("Set custom velocity (0-127):",a.currentVelocity);case 8:return e.t1=e.sent,t=(0,e.t0)(e.t1),e.abrupt("return",this.instructionReplaceVelocitySelected(t,n,r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"instructionReplaceVelocitySelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.song;t=t||this.state.selectedTrack;var a=new M(this,t);if(null===n&&(n=a.selectedIndices||[]),null===(e=parseFloat(e))||isNaN(e))throw new Error("Invalid velocity: "+typeof e);for(var o=0;o<n.length;o++)r.instructionReplaceVelocity(t,n[o],e);this.trackerPlay(t,n),this.setState((function(n){return n.activeTracks[t].currentVelocity=e,n}))}},{key:"instructionDeleteSelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e||this.state.selectedTrack;var n=new M(this,e);null===t&&(t=n.selectedIndices||[]);for(var r=0;r<t.length;r++)this.song.instructionDeleteAtIndex(e,t[r])}},{key:"keyboardChangeOctave",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!Number.isInteger(e))throw new Error("Invalid segment ID");this.setState({keyboardOctave:e})}},{key:"updateState",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:new Promise((function(e){n.setState((function(e){return"function"===typeof t&&(t=t(e)||e),t}),e)}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDestination",value:function(){var e=this.getAudioContext();return this.getVolumeGain(e.destination)}},{key:"songPlay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.song.play(this.getDestination(),null===e?this.state.songPosition:e,t)}},{key:"songPause",value:function(){this.song.stopPlayback()}},{key:"songStop",value:function(){this.song.playback&&this.song.stopPlayback(),this.song.setPlaybackPositionInTicks(0)}},{key:"trackerPlaySelected",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=new M(this,e);return this.trackerPlay(e,n.selectedIndices,t)}},{key:"trackerPlay",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=this.getSong();n&&r.isPlaying()&&r.stopPlayback();var a=this.getDestination();Array.isArray(t)||(t=[t]),r.playSelectedInstructions(a,e,t)}},{key:"trackAdd",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:null,n=!(a.length>1&&void 0!==a[1])||a[1],r=this.song,t=t||r.generateInstructionTrackName(),!n){e.next=8;break}return e.next=7,W.a.openPromptDialog("Create new instruction group?",t);case 7:t=e.sent;case 8:if(!t){e.next=14;break}return r.trackAdd(t,[]),e.next=12,this.trackerToggleTrack(t,!0);case 12:e.next=15;break;case 14:this.setStatus("<span class='error'>Create instruction group canceled</span>");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"trackRename",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:null,r=!(o.length>2&&void 0!==o[2])||o[2],a=this.song,!r){e.next=7;break}return e.next=6,W.a.openPromptDialog("Rename instruction group (".concat(t,")?"),t);case 6:n=e.sent;case 7:if(n===t){e.next=15;break}return a.trackRename(t,n),e.next=11,this.trackerToggleTrack(n,!0);case 11:return e.next=13,this.trackerToggleTrack(t,!1);case 13:e.next=16;break;case 15:this.setStatus("<span class='error'>Rename instruction group canceled</span>");case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trackRemove",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(a.length>1&&void 0!==a[1])||a[1],r=this.song,!n){e.next=8;break}return e.next=5,W.a.openPromptDialog("Remove instruction group (".concat(t,")?"));case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=!0;case 9:if(!e.t0){e.next=16;break}return r.trackRemove(t),e.next=14,this.trackerToggleTrack(t,!0);case 14:e.next=17;break;case 16:this.setStatus("<span class='error'>Remove instruction group canceled</span>");case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trackerToggleTrack",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a,o=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:null,n=o.length>1&&void 0!==o[1]?o[1]:null,r=o.length>2&&void 0!==o[2]?o[2]:{},a=t,!0!==n&&"undefined"!==typeof this.state.activeTracks[t]){e.next=11;break}return e.next=7,this.updateState((function(e){e.selectedTrack=a,e.activeTracks[t]=r}));case 7:return e.next=9,this.trackerUpdateSegmentInfo(t);case 9:e.next=15;break;case 11:return r=this.state.activeTracks[t],a=r.destinationList?r.destinationList.slice(-1)[0]:this.getSong().getStartTrackName(),e.next=15,this.updateState((function(e){e.selectedTrack=a,delete e.activeTracks[t]}));case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"trackerChangeQuantization",value:function(){var e=Object(g.a)(m.a.mark((function e(t,n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&Number.isInteger(n)){e.next=2;break}throw new Error("Invalid quantization value");case 2:return e.next=4,this.updateState((function(e){e.selectedTrack=t,e.activeTracks[t].quantizationTicks=n}));case 4:return e.next=6,this.trackerUpdateSegmentInfo(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trackerChangeQuantizationPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W.a.openPromptDialog("Enter custom tracker quantization in ticks:",this.track.quantizationTicks);case 2:return n=e.sent,e.next=5,this.trackerChangeQuantization(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trackerChangeSegmentLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t||!Number.isInteger(t))throw new Error("Invalid track row length value");this.setState((function(n){return n.activeTracks[e].rowLength=t,n}))}},{key:"trackerChangeSegmentLengthPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=parseInt,e.next=3,W.a.openPromptDialog("Enter custom tracker segment length in rows:",this.track.rowLength);case 3:e.t1=e.sent,n=(0,e.t0)(e.t1),this.trackerChangeSegmentLength(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trackerUpdateSegmentInfo",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o,i,s,u;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=t||this.state.selectedTrack,n=new M(this,t),(r=this.trackerGetIterator(t)).seekToEnd(),a=r.positionTicks,o=this.trackerGetQuantizedIterator(t),i=n.segmentLengthTicks,s=[],u=0;o.positionTicks<a||s.length<q.DEFAULT_MIN_SEGMENTS;)u<=o.positionTicks&&(s.push(o.rowCount),u+=i),o.nextQuantizedInstructionRow();return e.next=12,n.update((function(e){e.trackLengthTicks=a,e.segmentPositions=s}));case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"trackerGetIterator",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=new M(this,e);return this.getSong().instructionGetIterator(e,t.timeDivision,t.beatsPerMinute)}},{key:"trackerGetQuantizedIterator",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=new M(this,e);return this.getSong().instructionGetQuantizedIterator(e,t.quantizationTicks,t.timeDivision,t.beatsPerMinute)}},{key:"trackerGetCursorInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e=e||this.state.selectedTrack;var n=new M(this,e);t=null===t?n.cursorOffset:t;for(var r=this.trackerGetQuantizedIterator(e),a=null,o=0,i=0;r.cursorPosition<=t;)i=o,o=r.cursorPosition,r.nextQuantizedInstructionRow(null,(function(){r.cursorPosition===t&&(a=r.currentIndex)}));var s=t-o,u=r.rowCount,c=n.rowOffset||0,l=n.rowLength||16,f=null;c+l<=u&&(f=u-l),c>=u&&(f=u-1);var h=r.cursorPosition+s,d=i+s,p={positionTicks:r.positionTicks,positionSeconds:r.positionSeconds,cursorIndex:a,cursorRow:u,adjustedCursorRow:f,previousOffset:t>0?t-1:0,nextOffset:t+1,previousRowOffset:d,nextRowOffset:h};return p}},{key:"trackerSelectIndicesPrompt",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=a.length>0&&void 0!==a[0]?a[0]:null)&&(t=this.state.selectedTrack),n=new M(this,t),r=(n.selectedIndices||[]).join(", "),e.next=6,W.a.openPromptDialog("Select indices for track ".concat(t,": "),r);case 6:r=e.sent,this.trackerSelectIndices(t,r);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"trackerSelectIndices",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"===typeof t)switch(t){case"all":t=[];for(var a=this.song.instructionFindGroupLength(this.trackName),o=0;o<a;o++)t.push(o);break;case"segment":t=[].map.call(this.querySelectorAll("asct-instruction"),(function(e){return e.index}));break;case"row":throw new Error("TODO");case"none":t=[];break;default:t=t.split(/[^0-9]/).map((function(e){return parseInt(e)}))}if("number"===typeof t&&(t=[t]),!Array.isArray(t))throw new Error("Invalid selection: "+t);return t.forEach((function(e,t){if("number"!==typeof e)throw new Error("Invalid selection index (".concat(t,"): ").concat(e))})),(t=t.filter((function(e,t,n){return n.indexOf(e)===t&&null!==e}))).sort((function(e,t){return e-t})),this.setState((function(a){a.selectedTrack=e;var o=a.activeTracks[e];if(o.selectedIndices=t,null!==r){var i=n.trackerGetCursorInfo(e,r);o.cursorOffset=r,null!==i.adjustedCursorRow&&(o.rowOffset=i.adjustedCursorRow),o.cursorPositionTicks=i.positionTicks,a.songPosition=i.positionSeconds+(o.startPosition||0)}if(t.length>0){var s=n.getSong().instructionGetByIndex(e,t[0]);o.currentCommand=s.command,s instanceof D.d&&("undefined"!==typeof s.durationTicks&&(o.currentDuration=s.getDurationString(o.timeDivision||n.getSong().data.timeDivision)),"undefined"!==typeof s.velocity&&(o.currentVelocity=s.velocity))}return a})),t}},{key:"trackerSetCursorOffset",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!Number.isInteger(t))throw new Error("Invalid cursor offset");if(t<0)throw new Error("Cursor offset must be >= 0");return this.trackerSelectIndices(e,n,t)}},{key:"trackerSetScrollPosition",value:function(e,t){if(!Number.isInteger(t))throw new Error("Invalid row offset");this.setState((function(n){return n.activeTracks[e].scrollPositionTicks=t,n}))}},{key:"trackerSetRowOffset",value:function(e,t){if(!Number.isInteger(t))throw new Error("Invalid row offset");this.setState((function(n){return n.selectedTrack=e,n.activeTracks[e].rowOffset=t,n}))}},{key:"trackerCalculateRowOffset",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.trackerGetTrackInfo(e).calculateRowOffset(e,t)}},{key:"trackerFindCursorRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.trackerGetTrackInfo(e).findCursorRow(e,t)}},{key:"programAdd",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o,i,s=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},r=s.length>2&&void 0!==s[2]&&s[2],t){e.next=4;break}throw new Error("Invalid program class");case 4:if(a=D.e.getProgramClassInfo(t),o=a.title,e.t0=!1===r,e.t0){e.next=10;break}return e.next=9,this.openConfirmDialog("Add '".concat(o,"' to Song?"));case 9:e.t0=e.sent;case 10:if(!e.t0){e.next=15;break}i=this.song.programAdd(n),this.setStatus("New program class '".concat(t,"' added to song at position ").concat(i)),e.next=16;break;case 15:this.setError("New program canceled: ".concat(t));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"programReplace",value:function(){var e=Object(g.a)(m.a.mark((function e(t,n){var r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},Number.isInteger(t)){e.next=3;break}throw new Error("Invalid Program ID: Not an integer");case 3:if(n){e.next=5;break}throw new Error("Invalid Program class");case 5:return e.next=7,W.a.openPromptDialog("Change Program (".concat(t,") to ").concat(n));case 7:if(!e.sent){e.next=13;break}return e.next=10,this.song.programReplace(t,n,r);case 10:this.setStatus("Program (".concat(t,") changed to: ").concat(n)),e.next=14;break;case 13:this.setError("Change program canceled: ".concat(n));case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"programRename",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:null,console.log(this.song.programGetConfig(t).title,t),r=this.song.programGetConfig(t).title,n){e.next=7;break}return e.next=6,W.a.openPromptDialog("Change name for programs ".concat(t,": "),r);case 6:n=e.sent;case 7:if(n){e.next=9;break}return e.abrupt("return",console.error("Program name change canceled"));case 9:this.song.programRename(t,n),this.setStatus("Program title updated: ".concat(n));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"programRemove",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,e.next=3,this.openConfirmDialog("Remove Program ID: ".concat(t));case 3:if(!e.sent){e.next=8;break}this.song.programRemove(t),this.setStatus("Program (".concat(t,") removed")),e.next=9;break;case 8:this.setError("Remove program canceled");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"batchSelect",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:null,!(r.length>2&&void 0!==r[2]&&r[2])&&n){e.next=6;break}return e.next=5,W.a.openPromptDialog("Run custom search:",n||'/** Example Search **/ i.command === "C3"   &&   i.program === 0');case 5:n=e.sent;case 6:if(n){e.next=8;break}throw new Error("Batch command canceled: Invalid search");case 8:throw(new D.h).addBatchRecentSearches(n),new Error("TODO Implement");case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"batchRunCommand",value:function(){var e=Object(g.a)(m.a.mark((function e(t){var n,r,a,o,i=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=i.length>1&&void 0!==i[1]?i[1]:null,r=i.length>2&&void 0!==i[2]?i[2]:null,a=i.length>3&&void 0!==i[3]&&i[3],o=new D.h,!a&&r){e.next=8;break}return e.next=7,W.a.openPromptDialog("Run custom search:",r||'/** Example Search **/ i.command === "C3"   &&   i.program === 0');case 7:r=e.sent;case 8:if(r){e.next=10;break}throw new Error("Batch command canceled: Invalid search");case 10:if(o.addBatchRecentSearches(r),!a&&n){e.next=15;break}return e.next=14,W.a.openPromptDialog("Run custom command:",n||"/** Example Command **/ i.command='C4';");case 14:n=e.sent;case 15:if(n){e.next=17;break}throw new Error("Batch command canceled: Invalid command");case 17:throw o.addBatchRecentCommands(n),new Error("TODO Implement");case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"openPromptDialog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return window.prompt(e,t)}},{key:"openFileDialog",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n=arguments;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:null,e.next=3,new Promise((function(e,n){var r=document.createElement("input");r.setAttribute("type","file"),t&&r.setAttribute("accept",t),r.addEventListener("change",(function(){var t=r.files[0];t?e(t):n()})),r.click()}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"renderRootMenu",value:function(){var e=this,t={vertical:!this.state.portrait,openOnHover:!1};return this.state.portrait||(t.arrow=!1),a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,Object.assign({},t,{options:function(){return e.renderMenuFile()}}),"File"),a.a.createElement(b.i,Object.assign({},t,{options:function(){return e.renderMenuEdit()}}),"Edit"),a.a.createElement(b.i,Object.assign({},t,{options:function(){return e.renderMenuTrack()}}),"Track"),a.a.createElement(b.i,Object.assign({},t,{options:function(){return e.renderMenuProgram()}}),"Program"),a.a.createElement(b.i,Object.assign({},t,{options:function(){return e.renderMenuView()}}),"View"))}},{key:"renderMenuFile",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.loadNewSongData(t)}},"New song"),a.a.createElement(b.i,{options:function(){return e.renderMenuFileOpen()}},"Open song"),a.a.createElement(b.i,{options:function(){return e.renderMenuFileSave()}},"Save song"),a.a.createElement(b.i,{options:function(){return e.renderMenuFileImport()}},"Import song"),a.a.createElement(b.i,{options:function(){return e.renderMenuFileExport()}},"Export song"))}},{key:"renderMenuFileOpen",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{options:function(){return e.renderMenuFileOpenMemory()}},"from Memory"),a.a.createElement(b.g,{onAction:function(t){return e.openSongFromFileDialog(t)}},"from File"),a.a.createElement(b.g,{onAction:function(t){return e.loadSongFromURL(t)}},"from URL"))}},{key:"renderMenuFileSave",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.saveSongToMemory(t)}},"to Memory"),a.a.createElement(b.g,{onAction:function(t){return e.saveSongToFile(t)}},"to File"))}},{key:"renderMenuFileImport",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.openSongFromFileDialog(".mid,.midi")}},"from MIDI File"))}},{key:"renderMenuFileExport",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(){},disabled:!0},"to MIDI File"))}},{key:"renderMenuFileOpenMemory",value:function(){var e=Object(g.a)(m.a.mark((function e(){var t,n,r=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new D.h,e.next=3,t.getRecentSongList();case 3:return n=e.sent,console.log("songRecentUUIDs",n),e.abrupt("return",n.length>0?n.map((function(e,t){return a.a.createElement(b.g,{key:t,onAction:function(t){return r.loadSongFromMemory(e.uuid)}},e.title||e.uuid)})):a.a.createElement(b.g,{key:"no-recent",disabled:!0},"No Songs Available"));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"renderMenuSelectCommand",value:function(e){return K.a.renderMenuSelectCommand(e,this.state.keyboardOctave)}},{key:"renderMenuSelectCommandByFrequency",value:function(e){return K.a.renderMenuSelectCommandByFrequency(e,this.state.keyboardOctave)}},{key:"renderMenuSelectCommandByOctave",value:function(e){return K.a.renderMenuSelectCommandByOctave(e,this.state.keyboardOctave)}},{key:"renderMenuSelectSongProgram",value:function(e){return this.values.getSongPrograms((function(t,n,r){return a.a.createElement(b.g,{key:t,onAction:function(){return e(t)}},t,": ",r.title||n)}))}},{key:"renderMenuSelectDuration",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return K.a.renderMenuSelectDuration(e,t,n||this.song.data.timeDivision)}},{key:"renderMenuSelectVelocity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return K.a.renderMenuSelectVelocity(e,t)}},{key:"renderMenuSelectAvailableProgram",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return K.a.renderMenuSelectAvailableProgram(e,t)}},{key:"renderMenuEdit",value:function(){var e=this,t=this.trackGetState().selectedIndices||[];return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{options:function(){return e.renderMenuEditInsert()},children:"Insert Command"}),a.a.createElement(b.i,{disabled:0===t.length,options:function(){return e.renderMenuEditSetCommand()},hasBreak:!0,children:"Set Command"}),a.a.createElement(b.i,{disabled:0===t.length,options:function(){return e.renderMenuEditSetDuration()},hasBreak:!0,children:"Set Duration"}),a.a.createElement(b.i,{disabled:0===t.length,options:function(){return e.renderMenuEditSetVelocity()},hasBreak:!0,children:"Set Velocity"}),a.a.createElement(b.h,null),a.a.createElement(b.i,{options:function(){return e.renderMenuEditSelect()},hasBreak:!0},"Select"),a.a.createElement(b.h,null),a.a.createElement(b.i,{options:function(){return e.renderMenuEditBatch()},hasBreak:!0},"Batch"))}},{key:"renderMenuEditInsert",value:function(){var e=this;return K.a.renderMenuSelectCommand(function(){var t=Object(g.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==n){t.next=5;break}return t.next=3,e.instructionInsertPrompt();case 3:t.next=6;break;case 5:e.instructionInsert(n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.state.keyboardOctave)}},{key:"renderMenuEditInsertCommandFrequency",value:function(){var e=this;return this.renderMenuSelectCommandByFrequency((function(t){return e.instructionInsert(t,!1)}))}},{key:"renderMenuEditInsertCommandOctave",value:function(){var e=this;return this.renderMenuSelectCommandByOctave((function(t){return e.instructionInsert(t,!1)}))}},{key:"renderMenuEditSetCommand",value:function(){var e=this;return K.a.renderMenuSelectCommand(function(){var t=Object(g.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!==n){t.next=5;break}return t.next=3,e.instructionReplaceCommandSelectedPrompt();case 3:t.next=6;break;case 5:e.instructionReplaceCommandSelected(n);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.state.keyboardOctave)}},{key:"renderMenuEditSetDuration",value:function(){var e=this;return this.renderMenuSelectDuration((function(t){e.instructionReplaceDuration(t)}))}},{key:"renderMenuEditSetVelocity",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,K.a.getNoteVelocities((function(t){return a.a.createElement(b.g,{key:t,onAction:function(n){return e.instructionReplaceVelocity(t)}},t)})),a.a.createElement(b.g,{onAction:function(t){return e.instructionReplaceVelocity(null,!0)},hasBreak:!0},"Custom Velocity"))}},{key:"renderMenuEditSetCommandFrequency",value:function(){var e=this;return this.renderMenuSelectCommandByFrequency((function(t){return e.instructionReplaceCommandSelected(t)}))}},{key:"renderMenuEditSetCommandOctave",value:function(){var e=this;return this.renderMenuSelectCommandByOctave((function(t){return e.instructionReplaceCommandSelected(t)}))}},{key:"renderMenuEditSelect",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.trackerSelectIndices("segment")}},"Select Segment Instructions"),a.a.createElement(b.g,{onAction:function(t){return e.trackerSelectIndices("all")}},"Select All Song Instructions"),a.a.createElement(b.g,{onAction:function(t){return e.trackerSelectIndices("none")}},"Select No Instructions"),a.a.createElement(b.h,null),a.a.createElement(b.i,{options:function(){return e.renderMenuEditSelectBatch()},hasBreak:!0},"Batch Select"))}},{key:"renderMenuEditSelectBatch",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,(new D.h).getBatchRecentSearches().map((function(t,n){return a.a.createElement(b.g,{onAction:function(n){return e.batchSelect(t,!0)}},"New Selection Command")})),a.a.createElement(b.g,{onAction:function(t){return e.batchSelect(t)},hasBreak:!0},"New Selection Command"))}},{key:"renderMenuEditBatch",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,(new D.h).getBatchRecentCommands().map((function(t,n){return a.a.createElement(b.i,{options:function(){return e.renderMenuEditBatchRecent(t)}},t)})),a.a.createElement(b.g,{onAction:function(t){return e.batchRunCommand(t)},hasBreak:!0},"New Batch Command"))}},{key:"renderMenuEditBatchRecent",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(n){return t.batchRunCommand(e,!0)}},"Execute on Group"),a.a.createElement(b.i,{options:function(){return t.renderMenuEditBatchRecentExecuteSearch(e)}},"Execute using Search"))}},{key:"renderMenuEditBatchRecentExecuteSearch",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(n){return t.batchRunCommand(e,null,!0)}},"New Search"),(new D.h).getBatchRecentSearches().map((function(n,r){return a.a.createElement(b.g,{onAction:function(r){return t.batchRunCommand(e,n)}},n)})))}},{key:"renderMenuTrackerSetQuantization",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,this.renderMenuSelectDuration((function(n){t.trackerChangeQuantization(e,n)})),a.a.createElement(b.g,{onAction:function(n){return t.trackerChangeQuantization(e)},hasBreak:!0},"Custom Quantization"))}},{key:"renderMenuTrackerSetSegmentLength",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,K.a.getTrackerSegmentLengthInRows((function(n,r){return a.a.createElement(b.g,{key:n,onAction:function(r){return t.trackerChangeSegmentLength(e,n)}},r)})),a.a.createElement(b.g,{onAction:function(n){return t.trackerChangeSegmentLength(e)},hasBreak:!0},"Custom Length"))}},{key:"renderMenuKeyboardSetOctave",value:function(){var e=this;return K.a.getNoteOctaves((function(t){return a.a.createElement(b.g,{key:t,onAction:function(n){return e.keyboardChangeOctave(t)}},t)}))}},{key:"renderMenuView",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.toggleFullscreen(t)}},this.props.fullscreen?"Disable":"Enable"," Fullscreen"),a.a.createElement(b.g,{onAction:function(t){return e.togglePanelSong(t)}},this.props.hidePanelSongs?"Disable":"Enable"," Song Forms"),a.a.createElement(b.g,{onAction:function(t){return e.togglePanelTracker(t)}},this.props.hidePanelTracker?"Disable":"Enable"," Tracker Forms"),a.a.createElement(b.g,{onAction:function(t){return e.togglePanelPrograms(t)}},this.props.hidePanelProgram?"Disable":"Enable"," Program Forms"))}},{key:"renderMenuProgram",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{key:"add",options:function(){return e.renderMenuProgramAdd()}},"Add program to song"),a.a.createElement(b.h,null),this.values.getSongPrograms((function(t,n,r){return a.a.createElement(b.i,{key:t,options:function(){return e.renderMenuProgramEdit(t)}},t,": ",r.title||n)})))}},{key:"renderMenuProgramAdd",value:function(){var e=this;return D.e.getRegisteredPrograms().map((function(t,n){return a.a.createElement(b.g,{key:n,onAction:function(n){return e.programAdd(t.className)}},t.title)}))}},{key:"renderMenuProgramEdit",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.i,{key:"replace",options:function(){return t.renderMenuProgramEditReplace(e)}},"Replace"),a.a.createElement(b.g,{key:"remove",onAction:function(n){return t.programRemove(e)},disabled:!this.song.hasProgram(e)},"Remove from song"))}},{key:"renderMenuProgramEditReplace",value:function(e){var t=this;return D.e.getRegisteredPrograms().map((function(n,r){return a.a.createElement(b.g,{key:r,onAction:function(r){return t.programReplace(e,n.className)}},n.name)}))}},{key:"renderMenuTrack",value:function(){var e=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(t){return e.trackAdd(t)},hasBreak:!0},"Add new group"),a.a.createElement(b.h,null),this.values.getAllSongGroups((function(t){return a.a.createElement(b.i,{key:t,options:function(){return e.renderMenuTrackEdit(t)}},t)})))}},{key:"renderMenuTrackEdit",value:function(e){var t=this;return a.a.createElement(a.a.Fragment,null,a.a.createElement(b.g,{onAction:function(n){return t.trackRename(e)},hasBreak:!0},"Rename group ",e),a.a.createElement(b.g,{onAction:function(n){return t.trackRemove(e)},hasBreak:!0},"Delete group ",e))}}]),t}(function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.state.selectedTrack,n=this.state.activeTracks[t],r=n.selectedIndices||[];return a.a.createElement(Y,{composer:this},a.a.createElement(b.k,{className:"song",header:"Song"},a.a.createElement(b.d,{className:"playback",header:"Playback"},a.a.createElement(b.a,{className:"song-play",onAction:function(t){return e.songPlay()}},a.a.createElement(b.e,{source:"play"})),a.a.createElement(b.a,{className:"song-pause",onAction:function(t){return e.songPause()}},a.a.createElement(b.e,{source:"pause"})),a.a.createElement(b.a,{className:"song-stop",onAction:function(t){return e.songStop()}},a.a.createElement(b.e,{source:"stop"}))),this.state.portrait?null:a.a.createElement(b.d,{className:"file",header:"File"},a.a.createElement(b.a,{className:"file-load",onAction:function(t){return e.loadSongFromFileInput(t)},accept:".json,.mid,.midi",ref:function(t){return e.fieldSongFileLoad=t},title:"Load Song from File"},a.a.createElement(b.e,{source:"file-load"})),a.a.createElement(b.a,{className:"file-save",onAction:function(t){return e.saveSongToFile(t)},title:"Save Song to File"},a.a.createElement(b.e,{source:"file-save"}))),a.a.createElement(b.d,{className:"volume",header:"Volume"},a.a.createElement(b.f,{className:"volume",onChange:function(t,n){return e.setVolume(n)},value:this.state.volume,min:0,max:1,step:.02,title:"Song Volume"})),a.a.createElement(b.d,{className:"position",header:"Position"},a.a.createElement(b.f,{className:"position",onChange:function(t,n){return e.setSongPositionPercentage(n)},value:Math.floor(this.state.songPosition/(this.state.songLength||1)*100),min:0,max:100,title:"Song Position"})),a.a.createElement(b.d,{className:"timing",header:"Timing"},a.a.createElement(b.a,{className:"timing",onAction:function(t,n){return e.setSongPositionPrompt(n)},title:"Song Timing",children:K.a.formatPlaybackPosition(this.state.songPosition)})),this.state.portrait?null:a.a.createElement(b.d,{className:"name",header:"Name"},a.a.createElement(b.a,{className:"name",onAction:function(t){return e.setSongNamePrompt()},title:"Song Name",children:this.song?this.song.data.title:"no song loaded"})),a.a.createElement(b.d,{className:"version",header:"Version"},a.a.createElement(b.a,{className:"version",onAction:function(t){return e.setSongVersionPrompt()},title:"Song Version",children:this.song?this.song.data.version:"0.0.0"}))),a.a.createElement(b.k,{className:"programs",header:"Programs"},this.song.programEach((function(t,n,r){return a.a.createElement(H,{key:t,composer:e,programID:t})})),a.a.createElement(b.d,{className:"program-add",header:"Add Program"},a.a.createElement(b.i,{arrow:"\u25bc",className:"program-add",options:function(){return e.renderMenuSelectAvailableProgram((function(t){return e.programAdd(t)}),"Add New Program")},title:"Add Program"},"Select..."))),a.a.createElement(b.k,{className:"instructions",header:"Instruction".concat(1!==r.length?"s":"")},a.a.createElement(b.d,{className:"instruction-command",header:"Command"},a.a.createElement(b.b,{arrow:"\u25bc",options:function(){return r.length>0?e.renderMenuEditSetCommand():e.renderMenuEditInsert()}},n.currentCommand)),a.a.createElement(b.d,{className:"instruction-insert",header:"Add"},a.a.createElement(b.a,{onAction:function(t){return e.instructionInsert()},title:"Insert Instruction",disabled:r.length>0},a.a.createElement(b.e,{source:"insert"}))),a.a.createElement(b.d,{className:"instruction-delete",header:"Rem"},a.a.createElement(b.a,{onAction:function(t){return e.instructionDeleteSelected(t)},title:"Delete Instruction",disabled:0===r.length},a.a.createElement(b.e,{source:"remove"}))),a.a.createElement(b.d,{className:"instruction-velocity",header:"Velocity"},a.a.createElement(b.f,{onChange:function(t,n){return e.instructionReplaceVelocity(n)},value:n.currentVelocity||0,min:1,max:127,title:"Program Velocity",disabled:0===r.length})),a.a.createElement(b.d,{className:"instruction-duration",header:"Duration"},a.a.createElement(b.b,{arrow:"\u25bc",options:function(){return e.renderMenuEditSetDuration()},title:"Program Duration",disabled:0===r.length},n.currentDuration)),a.a.createElement(b.d,{className:"tracker-selection",header:"Selection"},a.a.createElement(b.a,{onAction:function(t){return e.trackerSelectIndicesPrompt()},title:"Tracker Note Selection",children:r.length>0?r.join(","):"None"})),a.a.createElement(b.d,{className:"keyboard-octave",header:"Octave"},a.a.createElement(b.b,{arrow:"\u25bc",className:"keyboard-octave",options:function(){return e.renderMenuKeyboardSetOctave()},title:"Change Keyboard Octave"},this.state.keyboardOctave))),Object.keys(this.state.activeTracks).map((function(n){return a.a.createElement(q,{key:n,trackName:n,trackState:e.state.activeTracks[n],selected:n===t,composer:e})})),this.renderWebViewProxy())}},{key:"renderWebViewProxy",value:function(){return null}}]),t}(a.a.Component)))))),X=n(49),$=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).song=null,n.webView=a.a.createRef(),n.cb={onMessage:function(e){return n.onMessage(e)}},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"postMessage",value:function(e){if("string"!==typeof e&&(e=JSON.stringify(e)),!window.ReactNativeWebView)return console.warn("SongProxyWebViewClient.postMessage: window.ReactNativeWebView is "+typeof window.ReactNativeWebView);window.ReactNativeWebView.postMessage(e)}},{key:"render",value:function(){var e=this;return this.song||(this.song=new y.a,document._SONG=this.song,document.addEventListener("error",(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.postMessage(["error"].concat(n))})),document.addEventListener("message",(function(t){e.onMessage(t.data)}),!1),this.postMessage(["song:load",this.song.data.title])),a.a.createElement(X.a,null)}},{key:"onMessage",value:function(e){"["===e[0]?(e=JSON.parse(e),this.handleCommand.apply(this,e)):console.warn("Unhandled message: "+e)}},{key:"handleCommand",value:function(e){for(var t,n,r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];switch(e){case"song:load":var i=a[0];i=JSON.parse(i),this.song.loadSongData(i),console.log("song",this.song);break;case"song":var s=a.shift();switch(s){case"play":case"playSelectedInstructions":null===a[0]&&(a[0]=this.getAudioContext().destination)}(t=console).log.apply(t,["song.".concat(s,"(")].concat(a,[")"])),(n=this.song)[s].apply(n,a);break;default:console.error("Unknown command: "+e)}}},{key:"getAudioContext",value:function(){if(this.audioContext)return this.audioContext;var e=new(window.AudioContext||window.webkitAudioContext);return this.audioContext=e,e}}]),t}(a.a.Component),Z=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(c.a)(this,Object(l.a)(t).call(this,e))).toggleMenu=function(){n.setState({menuOpen:!n.state.menuOpen}),n.state.menuOpen||n.playerElm.switchToMenu(null)},n.updateMenu=function(){n.forceUpdate()},n.state={},n}return Object(f.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){}},{key:"renderDrawerContent",value:function(){}},{key:"render",value:function(){var e=this;return a.a.createElement(h.a,null,a.a.createElement(d.c,null,a.a.createElement(d.a,{path:["/blank","/proxy"]},a.a.createElement($,null)),a.a.createElement(d.a,{path:["/player","/p"]},this.renderPlayer()),a.a.createElement(d.a,{path:["/composer","/c"]},this.renderComposer()),a.a.createElement(d.a,{path:["/both","/b"]},this.renderComposer(),this.renderPlayer()),a.a.createElement(d.a,{path:"/",render:function(t){switch(t.location.search){case"?blank":case"?proxy":return a.a.createElement($,null);default:return e.renderComposer()}}})))}},{key:"renderPlayer",value:function(){var e=this;return a.a.createElement(C,{src:"files/test.pl.json",ref:function(t){return e.playerElm=t},onToggleMenu:this.toggleMenu,onUpdateMenu:this.updateMenu})}},{key:"renderComposer",value:function(){var e=this;return a.a.createElement(J,{ref:function(t){return e.composer=t},onToggleMenu:this.toggleMenu,onRenderMenu:function(t){return e.menu.onRenderMenu}})}}]),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(a.a.createElement(Z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},function(e,t,n){"use strict";n.r(t);var r=n(3),a=n(4),o=n(7),i=n(5),s=n(8),u=n(10),c=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTitle",value:function(){return"Mohayonao Wave Library Index"}},{key:"getPresets",value:function(){var e=n(140)||[];return e.samples.map((function(t){return"object"!==typeof t&&(t={url:t,type:"custom"}),t.title||(t.title=t.url.split("/").pop()),e.baseURL&&(t.url=e.baseURL+t.url),["OscillatorInstrument",t]}))}}]),t}(u.c),l=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTitle",value:function(){return"Periodic Wave Library Index"}},{key:"getLibraries",value:function(){return[new c]}}]),t}(u.c),f=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTitle",value:function(){return"FreeWaveSamples.com"}}]),t}(u.c),h=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTitle",value:function(){return"Sample Library Index"}},{key:"getLibraries",value:function(){return[new f]}},{key:"getPlaylists",value:function(){return["assets/files/test.pl.json;Test Playlist"]}}]),t}(u.c);n.d(t,"default",(function(){return d}));var d=function(e){function t(){return Object(r.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getTitle",value:function(){return"Audio Source Index"}},{key:"getLibraries",value:function(){return[new h,new l,new c]}},{key:"getPlaylists",value:function(){return["assets/files/test.pl.json;Test ASPPlaylist"]}}]),t}(u.c)}],[[105,1,2]]]);
//# sourceMappingURL=main.e2d54465.chunk.js.map